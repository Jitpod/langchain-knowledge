<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="LangChain 1.0 å·¥å…·ç³»ç»Ÿè¯¦è§£ - @tool è£…é¥°å™¨å’Œ ToolRuntime ä¸Šä¸‹æ–‡">
    <title>å·¥å…·ç³»ç»Ÿ | LangChain 1.0 Python çŸ¥è¯†æ–‡æ¡£</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <button class="mobile-menu-button" aria-label="æ‰“å¼€èœå•">â˜°</button>

    <div class="container">
        <!-- ä¾§è¾¹æ å¯¼èˆª -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1 class="sidebar-title">ğŸ¦œ LangChain 1.0</h1>
                <p class="sidebar-subtitle">Python å®Œæ•´å­¦ä¹ æŒ‡å—</p>
            </div>

                        <ul class="nav-menu">
                <li class="nav-section">
                    <div class="nav-section-title">å¼€å§‹</div>
                    <ul>
                        <li class="nav-item">
                            <a href="index.html" class="nav-link">
                                <span class="nav-icon">ğŸ </span>
                                ä¸»é¡µ
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">åŸºç¡€ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="01-introduction.html" class="nav-link">
                                <span class="nav-icon">ğŸ“–</span>
                                LangChain ç®€ä»‹
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="02-architecture.html" class="nav-link">
                                <span class="nav-icon">ğŸ—ï¸</span>
                                æ ¸å¿ƒæ¶æ„
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="03-models.html" class="nav-link">
                                <span class="nav-icon">ğŸ¤–</span>
                                æ¨¡å‹æ¥å£
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="04-messages.html" class="nav-link">
                                <span class="nav-icon">ğŸ’¬</span>
                                æ¶ˆæ¯ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item active">
                            <a href="05-tools.html" class="nav-link">
                                <span class="nav-icon">ğŸ”§</span>
                                å·¥å…·ç³»ç»Ÿ
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">è¿›é˜¶ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="06-agents.html" class="nav-link">
                                <span class="nav-icon">ğŸ¯</span>
                                Agent åŸºç¡€
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="07-middleware.html" class="nav-link">
                                <span class="nav-icon">âš™ï¸</span>
                                ä¸­é—´ä»¶ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="08-rag.html" class="nav-link">
                                <span class="nav-icon">ğŸ”</span>
                                RAG è¯¦è§£
                                <span class="nav-badge">é‡ç‚¹</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="09-lcel.html" class="nav-link">
                                <span class="nav-icon">ğŸ”—</span>
                                LCEL è¡¨è¾¾å¼
                            </a>
                        </li>
                    </ul>
                </li>

                                <li class="nav-section">
                    <div class="nav-section-title">é«˜çº§åº”ç”¨</div>
                    <ul>
                        <li class="nav-item">
                            <a href="10-runtime.html" class="nav-link">
                                <span class="nav-icon">ğŸ”Œ</span>
                                Runtime ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="11-checkpointer.html" class="nav-link">
                                <span class="nav-icon">ğŸ’¾</span>
                                æŒä¹…åŒ–ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="12-streaming.html" class="nav-link">
                                <span class="nav-icon">ğŸŒŠ</span>
                                æµå¼è¾“å‡º
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="13-human-in-loop.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¤</span>
                                äººå·¥ä»‹å…¥
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="14-long-term-memory.html" class="nav-link">
                                <span class="nav-icon">ğŸ—„ï¸</span>
                                é•¿æœŸè®°å¿†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="15-langgraph.html" class="nav-link">
                                <span class="nav-icon">ğŸ“Š</span>
                                LangGraph
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="16-context-engineering.html" class="nav-link">
                                <span class="nav-icon">ğŸ¯</span>
                                ä¸Šä¸‹æ–‡å·¥ç¨‹
                                <span class="nav-badge">é‡ç‚¹</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="17-mcp.html" class="nav-link">
                                <span class="nav-icon">ğŸ”Œ</span>
                                MCP åè®®
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">å®æˆ˜ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="18-customer-service.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¥</span>
                                å®¢æœæœºå™¨äºº
                                <span class="nav-badge">é‡ç‚¹</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="19-best-practices.html" class="nav-link">
                                <span class="nav-icon">âœ¨</span>
                                æœ€ä½³å®è·µ
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">å‚è€ƒç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="20-api-reference.html" class="nav-link">
                                <span class="nav-icon">ğŸ“š</span>
                                API é€ŸæŸ¥è¡¨
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="21-troubleshooting.html" class="nav-link">
                                <span class="nav-icon">ğŸ›</span>
                                æ•…éšœæ’é™¤
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="22-migration.html" class="nav-link">
                                <span class="nav-icon">ğŸ”„</span>
                                è¿ç§»æŒ‡å—
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">æ‰©å±•ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="23-structured-output.html" class="nav-link">
                                <span class="nav-icon">ğŸ“Š</span>
                                ç»“æ„åŒ–è¾“å‡º
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">DeepAgents ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="24-deepagents-quickstart.html" class="nav-link">
                                <span class="nav-icon">ğŸš€</span>
                                å¿«é€Ÿå¼€å§‹
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="25-deepagents-customization.html" class="nav-link">
                                <span class="nav-icon">ğŸ¨</span>
                                å®šåˆ¶åŒ–
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="26-deepagents-harness.html" class="nav-link">
                                <span class="nav-icon">ğŸ›ï¸</span>
                                Harness ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="27-deepagents-backends.html" class="nav-link">
                                <span class="nav-icon">ğŸ”§</span>
                                åç«¯é…ç½®
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="28-deepagents-subagents.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¥</span>
                                å­ä»£ç†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="29-deepagents-hitl.html" class="nav-link">
                                <span class="nav-icon">ğŸ¤</span>
                                äººå·¥ä»‹å…¥
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="30-deepagents-memory.html" class="nav-link">
                                <span class="nav-icon">ğŸ§ </span>
                                é•¿æœŸè®°å¿†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="31-deepagents-middleware.html" class="nav-link">
                                <span class="nav-icon">âš™ï¸</span>
                                ä¸­é—´ä»¶
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">Multi-Agent ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="32-multi-agent-index.html" class="nav-link">
                                <span class="nav-icon">ğŸŒ</span>
                                æ¦‚è¿°
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="33-multi-agent-subagents.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¥</span>
                                å­ä»£ç†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="34-multi-agent-handoffs.html" class="nav-link">
                                <span class="nav-icon">ğŸ”„</span>
                                äº¤æ¥æœºåˆ¶
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="35-multi-agent-skills.html" class="nav-link">
                                <span class="nav-icon">ğŸ¯</span>
                                æŠ€èƒ½ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="36-multi-agent-router.html" class="nav-link">
                                <span class="nav-icon">ğŸ§­</span>
                                è·¯ç”±æœºåˆ¶
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="37-multi-agent-workflow.html" class="nav-link">
                                <span class="nav-icon">ğŸ”€</span>
                                è‡ªå®šä¹‰å·¥ä½œæµ
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <div class="content-wrapper">
                <!-- é¢åŒ…å±‘å¯¼èˆª -->
                <nav class="breadcrumb">
                    <span class="breadcrumb-item">
                        <a href="index.html" class="breadcrumb-link">ä¸»é¡µ</a>
                    </span>
                    <span class="breadcrumb-item">
                        åŸºç¡€ç¯‡
                    </span>
                    <span class="breadcrumb-item">
                        å·¥å…·ç³»ç»Ÿ
                    </span>
                </nav>

                <!-- é¡µé¢æ ‡é¢˜ -->
                <header class="page-header">
                    <h1 class="page-title">ğŸ”§ å·¥å…·ç³»ç»Ÿè¯¦è§£</h1>
                    <p class="page-subtitle">
                        æŒæ¡ LangChain 1.0 çš„ @tool è£…é¥°å™¨å’Œ ToolRuntime ä¸Šä¸‹æ–‡æ³¨å…¥ï¼Œ
                        ä¸º Agent æ„å»ºå¼ºå¤§çš„å¤–éƒ¨äº¤äº’èƒ½åŠ›ã€‚
                    </p>
                </header>

                <!-- ä»€ä¹ˆæ˜¯å·¥å…·ç³»ç»Ÿ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ“š ä»€ä¹ˆæ˜¯å·¥å…·ï¼ˆToolsï¼‰ï¼Ÿ</h2>
                    <p>
                        <strong>å·¥å…·ï¼ˆToolsï¼‰</strong>æ˜¯ Agent ä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’çš„æ¡¥æ¢ã€‚
                        é€šè¿‡å·¥å…·ï¼ŒAgent å¯ä»¥ï¼š
                    </p>
                    <ul>
                        <li><strong>è·å–å®æ—¶æ•°æ®</strong>ï¼šæŸ¥è¯¢æ•°æ®åº“ã€è°ƒç”¨ APIã€æœç´¢ç½‘ç»œ</li>
                        <li><strong>æ‰§è¡Œæ“ä½œ</strong>ï¼šå‘é€é‚®ä»¶ã€æ›´æ–°è®°å½•ã€æ§åˆ¶è®¾å¤‡</li>
                        <li><strong>è®¿é—®ä¸Šä¸‹æ–‡</strong>ï¼šè¯»å–ç”¨æˆ·ä¿¡æ¯ã€è®¿é—®å¯¹è¯çŠ¶æ€</li>
                        <li><strong>å¤„ç†å¤æ‚é€»è¾‘</strong>ï¼šæ‰§è¡Œè®¡ç®—ã€æ•°æ®è½¬æ¢ã€ä¸šåŠ¡è§„åˆ™</li>
                    </ul>

                    <div class="info-box note">
                        <div class="info-box-title">ğŸ’¡ æ ¸å¿ƒä¼˜åŠ¿</div>
                        <p>
                            ä½¿ç”¨ <code>@tool</code> è£…é¥°å™¨ï¼Œä½ åªéœ€ç¼–å†™æ™®é€šçš„ Python å‡½æ•°ï¼Œ
                            LangChain ä¼šè‡ªåŠ¨ï¼š
                        </p>
                        <ul>
                            <li>ä»ç±»å‹æ³¨è§£ç”Ÿæˆå·¥å…· Schema</li>
                            <li>ä»æ–‡æ¡£å­—ç¬¦ä¸²æå–å·¥å…·æè¿°</li>
                            <li>å¤„ç†å‚æ•°éªŒè¯å’Œé”™è¯¯</li>
                            <li>æ³¨å…¥è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ã€å¯¹è¯çŠ¶æ€ï¼‰</li>
                        </ul>
                    </div>
                </section>

                <!-- å·¥å…·è°ƒç”¨æµç¨‹ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ”„ å·¥å…·è°ƒç”¨æµç¨‹</h2>

                    <div class="mermaid-wrapper">
                        <div class="mermaid">
graph LR
    A[ç”¨æˆ·æé—®] --> B[Agent æ¨ç†]
    B --> C{éœ€è¦å·¥å…·ï¼Ÿ}

    C -->|æ˜¯| D[é€‰æ‹©å·¥å…·]
    D --> E[ç”Ÿæˆå·¥å…·è°ƒç”¨]
    E --> F[æ‰§è¡Œå·¥å…·å‡½æ•°]
    F --> G[è·å–ç»“æœ]
    G --> H[è¿”å› ToolMessage]
    H --> B

    C -->|å¦| I[ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ]
    I --> J[è¿”å›ç»™ç”¨æˆ·]

    style B fill:#3b82f6,color:#fff
    style D fill:#10b981,color:#fff
    style F fill:#f59e0b,color:#fff
    style I fill:#8b5cf6,color:#fff
    style J fill:#ec4899,color:#fff
                        </div>
                    </div>
                </section>

                <!-- @tool è£…é¥°å™¨åŸºç¡€ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ¯ @tool è£…é¥°å™¨åŸºç¡€</h2>
                    <p>
                        <code>@tool</code> æ˜¯åˆ›å»ºå·¥å…·çš„æœ€ç®€å•æ–¹å¼ã€‚
                    </p>

                    <h3 class="subsection-title">åŸºç¡€ç”¨æ³•</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty basic">ğŸŸ¢ åŸºç¡€</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
@tool è£…é¥°å™¨åŸºç¡€ç¤ºä¾‹
åŠŸèƒ½ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„æ•°æ®åº“æœç´¢å·¥å…·
"""
from langchain.tools import tool

@tool
def search_database(query: str, limit: int = 10) -> str:
    """åœ¨å®¢æˆ·æ•°æ®åº“ä¸­æœç´¢åŒ¹é…æŸ¥è¯¢çš„è®°å½•ã€‚

    Args:
        query: è¦æŸ¥æ‰¾çš„æœç´¢è¯
        limit: è¿”å›çš„æœ€å¤§ç»“æœæ•°é‡

    Returns:
        æœç´¢ç»“æœçš„æè¿°
    """
    # æ¨¡æ‹Ÿæ•°æ®åº“æœç´¢
    results = [
        f"å®¢æˆ· {i+1}: åŒ¹é… '{query}'"
        for i in range(min(limit, 5))
    ]
    return f"æ‰¾åˆ° {len(results)} æ¡ç»“æœï¼š\n" + "\n".join(results)

# æŸ¥çœ‹å·¥å…·å±æ€§
print(f"å·¥å…·åç§°: {search_database.name}")
print(f"å·¥å…·æè¿°: {search_database.description}")
print(f"å·¥å…·å‚æ•°: {search_database.args}")</code></pre>
                    </div>

                    <div class="info-box tip">
                        <div class="info-box-title">âœ… å…³é”®è¦æ±‚</div>
                        <ul>
                            <li><strong>ç±»å‹æ³¨è§£æ˜¯å¿…éœ€çš„</strong>ï¼šå®šä¹‰å·¥å…·çš„è¾“å…¥ Schema</li>
                            <li><strong>æ–‡æ¡£å­—ç¬¦ä¸²å¾ˆé‡è¦</strong>ï¼šå¸®åŠ©æ¨¡å‹ç†è§£ä½•æ—¶ä½¿ç”¨å·¥å…·</li>
                            <li><strong>å‡½æ•°åå³å·¥å…·å</strong>ï¼šé™¤éæ˜¾å¼æŒ‡å®š</li>
                        </ul>
                    </div>

                    <h3 class="subsection-title">è‡ªå®šä¹‰å·¥å…·åç§°</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty basic">ğŸŸ¢ åŸºç¡€</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
è‡ªå®šä¹‰å·¥å…·åç§°å’Œæè¿°
"""
from langchain.tools import tool

# è‡ªå®šä¹‰å·¥å…·åç§°
@tool("web_search")
def search(query: str) -> str:
    """åœ¨ç½‘ç»œä¸Šæœç´¢ä¿¡æ¯ã€‚"""
    return f"'{query}' çš„æœç´¢ç»“æœ..."

print(search.name)  # è¾“å‡º: web_search


# è‡ªå®šä¹‰åç§°å’Œæè¿°
@tool(
    "calculator",
    description="æ‰§è¡Œç®—æœ¯è®¡ç®—ã€‚ç”¨äºä»»ä½•æ•°å­¦é—®é¢˜ã€‚"
)
def calc(expression: str) -> str:
    """è®¡ç®—æ•°å­¦è¡¨è¾¾å¼ã€‚"""
    try:
        result = eval(expression)  # ä»…ç”¨äºæ¼”ç¤º
        return f"ç»“æœ: {result}"
    except Exception as e:
        return f"è®¡ç®—é”™è¯¯: {str(e)}"

print(calc.name)         # è¾“å‡º: calculator
print(calc.description)  # è¾“å‡º: æ‰§è¡Œç®—æœ¯è®¡ç®—ã€‚ç”¨äºä»»ä½•æ•°å­¦é—®é¢˜ã€‚</code></pre>
                    </div>
                </section>

                <!-- é«˜çº§ Schema å®šä¹‰ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ“‹ é«˜çº§ Schema å®šä¹‰</h2>
                    <p>
                        ä½¿ç”¨ Pydantic æ¨¡å‹å¯ä»¥å®šä¹‰æ›´å¤æ‚çš„è¾“å…¥ Schemaï¼Œ
                        åŒ…æ‹¬æšä¸¾ç±»å‹ã€åµŒå¥—ç»“æ„ã€å­—æ®µæè¿°ç­‰ã€‚
                    </p>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
ä½¿ç”¨ Pydantic å®šä¹‰å¤æ‚å·¥å…· Schema
åŠŸèƒ½ï¼šåˆ›å»ºä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„å¤©æ°”æŸ¥è¯¢å·¥å…·
"""
from pydantic import BaseModel, Field
from typing import Literal
from langchain.tools import tool

class WeatherInput(BaseModel):
    """å¤©æ°”æŸ¥è¯¢çš„è¾“å…¥å‚æ•°ã€‚"""
    location: str = Field(
        description="åŸå¸‚åç§°æˆ–åæ ‡"
    )
    units: Literal["celsius", "fahrenheit"] = Field(
        default="celsius",
        description="æ¸©åº¦å•ä½åå¥½"
    )
    include_forecast: bool = Field(
        default=False,
        description="æ˜¯å¦åŒ…å« 5 å¤©é¢„æŠ¥"
    )

@tool(args_schema=WeatherInput)
def get_weather(
    location: str,
    units: str = "celsius",
    include_forecast: bool = False
) -> str:
    """è·å–å½“å‰å¤©æ°”å’Œå¯é€‰çš„å¤©æ°”é¢„æŠ¥ã€‚

    Args:
        location: åŸå¸‚åç§°
        units: æ¸©åº¦å•ä½
        include_forecast: æ˜¯å¦åŒ…å«é¢„æŠ¥

    Returns:
        å¤©æ°”ä¿¡æ¯æè¿°
    """
    # æ¨¡æ‹Ÿå¤©æ°”æ•°æ®
    temp = 22 if units == "celsius" else 72
    result = f"{location} çš„å½“å‰å¤©æ°”ï¼š{temp}Â° {units[0].upper()}"

    if include_forecast:
        result += "\næœªæ¥ 5 å¤©ï¼šæ™´æœ—"

    return result

# æµ‹è¯•å·¥å…·
print(get_weather.invoke({
    "location": "åŒ—äº¬",
    "units": "celsius",
    "include_forecast": True
}))</code></pre>
                    </div>

                    <div class="info-box note">
                        <div class="info-box-title">ğŸ’¡ Pydantic Schema çš„ä¼˜åŠ¿</div>
                        <ul>
                            <li><strong>ç±»å‹çº¦æŸ</strong>ï¼šä½¿ç”¨ Literal é™åˆ¶å¯é€‰å€¼</li>
                            <li><strong>è¯¦ç»†æè¿°</strong>ï¼šæ¯ä¸ªå­—æ®µéƒ½å¯ä»¥æœ‰ç‹¬ç«‹çš„æè¿°</li>
                            <li><strong>éªŒè¯é€»è¾‘</strong>ï¼šè‡ªåŠ¨éªŒè¯è¾“å…¥å‚æ•°</li>
                            <li><strong>é»˜è®¤å€¼</strong>ï¼šæ”¯æŒå¯é€‰å‚æ•°å’Œé»˜è®¤å€¼</li>
                        </ul>
                    </div>
                </section>

                <!-- ToolRuntime ä¸Šä¸‹æ–‡æ³¨å…¥ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ”Œ ToolRuntime ä¸Šä¸‹æ–‡æ³¨å…¥</h2>
                    <p>
                        <code>ToolRuntime</code> å‚æ•°å…è®¸å·¥å…·è®¿é—®è¿è¡Œæ—¶ä¿¡æ¯ï¼Œ
                        å¦‚å¯¹è¯çŠ¶æ€ã€ç”¨æˆ·ä¸Šä¸‹æ–‡ã€å­˜å‚¨ç­‰ã€‚
                    </p>

                    <div class="info-box warning">
                        <div class="info-box-title">âš ï¸ é‡è¦ç‰¹æ€§</div>
                        <p>
                            <code>runtime</code> å‚æ•°å¯¹æ¨¡å‹ä¸å¯è§ã€‚
                            æ¨¡å‹åªèƒ½çœ‹åˆ°å…¶ä»–å‚æ•°ï¼Œè€Œ runtime ç”± LangChain è‡ªåŠ¨æ³¨å…¥ã€‚
                        </p>
                    </div>

                    <h3 class="subsection-title">è®¿é—®å¯¹è¯çŠ¶æ€</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
è®¿é—®å¯¹è¯çŠ¶æ€ç¤ºä¾‹
åŠŸèƒ½ï¼šå·¥å…·å¯ä»¥è¯»å–å¯¹è¯å†å²
"""
from langchain.tools import tool, ToolRuntime

@tool
def summarize_conversation(runtime: ToolRuntime) -> str:
    """æ€»ç»“åˆ°ç›®å‰ä¸ºæ­¢çš„å¯¹è¯ã€‚

    Returns:
        å¯¹è¯ç»Ÿè®¡æ‘˜è¦
    """
    # è®¿é—®å¯¹è¯çŠ¶æ€ä¸­çš„æ¶ˆæ¯åˆ—è¡¨
    messages = runtime.state["messages"]

    # ç»Ÿè®¡ä¸åŒç±»å‹çš„æ¶ˆæ¯
    human_msgs = sum(
        1 for m in messages
        if m.__class__.__name__ == "HumanMessage"
    )
    ai_msgs = sum(
        1 for m in messages
        if m.__class__.__name__ == "AIMessage"
    )
    tool_msgs = sum(
        1 for m in messages
        if m.__class__.__name__ == "ToolMessage"
    )

    return (
        f"å¯¹è¯åŒ…å« {human_msgs} æ¡ç”¨æˆ·æ¶ˆæ¯ã€"
        f"{ai_msgs} æ¡ AI å“åº”å’Œ "
        f"{tool_msgs} æ¡å·¥å…·ç»“æœ"
    )

@tool
def get_user_preference(pref_name: str, runtime: ToolRuntime) -> str:
    """è·å–ç”¨æˆ·åå¥½è®¾ç½®çš„å€¼ã€‚

    Args:
        pref_name: åå¥½è®¾ç½®åç§°

    Returns:
        åå¥½è®¾ç½®çš„å€¼
    """
    # ä»çŠ¶æ€ä¸­è¯»å–ç”¨æˆ·åå¥½
    preferences = runtime.state.get("user_preferences", {})
    return preferences.get(pref_name, "æœªè®¾ç½®")</code></pre>
                    </div>

                    <h3 class="subsection-title">è®¿é—®è‡ªå®šä¹‰ä¸Šä¸‹æ–‡</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty advanced">ğŸ”´ é«˜çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
è‡ªå®šä¹‰ä¸Šä¸‹æ–‡è®¿é—®ç¤ºä¾‹
åŠŸèƒ½ï¼šå·¥å…·å¯ä»¥è®¿é—®ç”¨æˆ·ç‰¹å®šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
"""
from dataclasses import dataclass
from langchain.tools import tool, ToolRuntime
from langchain.chat_models import init_chat_model
from langchain.agents import create_agent

# æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®åº“
USER_DATABASE = {
    "user123": {
        "name": "å¼ ä¸‰",
        "account_type": "VIP",
        "balance": 5000,
        "email": "[email protected]"
    },
    "user456": {
        "name": "æå››",
        "account_type": "æ™®é€š",
        "balance": 1200,
        "email": "[email protected]"
    }
}

# å®šä¹‰ç”¨æˆ·ä¸Šä¸‹æ–‡ç»“æ„
@dataclass
class UserContext:
    """ç”¨æˆ·ä¸Šä¸‹æ–‡ä¿¡æ¯"""
    user_id: str

# åˆ›å»ºä½¿ç”¨ä¸Šä¸‹æ–‡çš„å·¥å…·
@tool
def get_account_info(runtime: ToolRuntime[UserContext]) -> str:
    """è·å–å½“å‰ç”¨æˆ·çš„è´¦æˆ·ä¿¡æ¯ã€‚

    Returns:
        ç”¨æˆ·è´¦æˆ·è¯¦æƒ…
    """
    # ä»ä¸Šä¸‹æ–‡è·å–ç”¨æˆ· ID
    user_id = runtime.context.user_id

    # æŸ¥è¯¢ç”¨æˆ·æ•°æ®
    if user_id in USER_DATABASE:
        user = USER_DATABASE[user_id]
        return (
            f"è´¦æˆ·æŒæœ‰äººï¼š{user['name']}\n"
            f"è´¦æˆ·ç±»å‹ï¼š{user['account_type']}\n"
            f"ä½™é¢ï¼šÂ¥{user['balance']}"
        )
    return "ç”¨æˆ·æœªæ‰¾åˆ°"

@tool
def check_vip_status(runtime: ToolRuntime[UserContext]) -> str:
    """æ£€æŸ¥å½“å‰ç”¨æˆ·çš„ VIP çŠ¶æ€ã€‚

    Returns:
        VIP çŠ¶æ€ä¿¡æ¯
    """
    user_id = runtime.context.user_id

    if user_id in USER_DATABASE:
        user = USER_DATABASE[user_id]
        is_vip = user["account_type"] == "VIP"
        return f"VIP çŠ¶æ€ï¼š{'æ˜¯' if is_vip else 'å¦'}"
    return "ç”¨æˆ·æœªæ‰¾åˆ°"

# åˆ›å»º Agent
model = init_chat_model("gpt-4o")
agent = create_agent(
    model,
    tools=[get_account_info, check_vip_status],
    context_schema=UserContext,
    system_prompt="ä½ æ˜¯ä¸€ä¸ªé‡‘èåŠ©æ‰‹ã€‚"
)

# è°ƒç”¨ Agentï¼ˆä¼ å…¥ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼‰
result = agent.invoke(
    {"messages": [{"role": "user", "content": "æˆ‘çš„å½“å‰ä½™é¢æ˜¯å¤šå°‘ï¼Ÿ"}]},
    context=UserContext(user_id="user123")  # æ³¨å…¥ç”¨æˆ·ä¸Šä¸‹æ–‡
)

print(result["messages"][-1].content)</code></pre>
                    </div>
                </section>

                <!-- æ›´æ–°çŠ¶æ€ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ”„ æ›´æ–° Agent çŠ¶æ€</h2>
                    <p>
                        å·¥å…·å¯ä»¥ä½¿ç”¨ <code>Command</code> å¯¹è±¡ä¿®æ”¹ Agent çš„çŠ¶æ€ï¼Œ
                        å¦‚æ¸…é™¤å¯¹è¯å†å²ã€æ›´æ–°ç”¨æˆ·ä¿¡æ¯ç­‰ã€‚
                    </p>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty advanced">ğŸ”´ é«˜çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
çŠ¶æ€æ›´æ–°ç¤ºä¾‹
åŠŸèƒ½ï¼šå·¥å…·å¯ä»¥ä¿®æ”¹ Agent çš„è¿è¡Œæ—¶çŠ¶æ€
"""
from langchain.tools import tool, ToolRuntime
from langgraph.types import Command
from langchain.messages import RemoveMessage
from langgraph.graph.message import REMOVE_ALL_MESSAGES

@tool
def clear_conversation() -> Command:
    """æ¸…é™¤å¯¹è¯å†å²ã€‚

    Returns:
        çŠ¶æ€æ›´æ–°å‘½ä»¤
    """
    return Command(
        update={
            "messages": [RemoveMessage(id=REMOVE_ALL_MESSAGES)],
        }
    )

@tool
def update_user_name(new_name: str, runtime: ToolRuntime) -> Command:
    """æ›´æ–°ç”¨æˆ·å§“åã€‚

    Args:
        new_name: æ–°çš„ç”¨æˆ·å§“å

    Returns:
        çŠ¶æ€æ›´æ–°å‘½ä»¤
    """
    return Command(
        update={"user_name": new_name}
    )

@tool
def set_language_preference(language: str) -> Command:
    """è®¾ç½®è¯­è¨€åå¥½ã€‚

    Args:
        language: è¯­è¨€ä»£ç ï¼ˆå¦‚ 'zh', 'en'ï¼‰

    Returns:
        çŠ¶æ€æ›´æ–°å‘½ä»¤
    """
    return Command(
        update={"language": language}
    )</code></pre>
                    </div>
                </section>

                <!-- Memory/Store è®¿é—® -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ’¾ Memory/Store è®¿é—®</h2>
                    <p>
                        å·¥å…·å¯ä»¥è®¿é—®æŒä¹…åŒ–å­˜å‚¨ï¼Œå®ç°è·¨ä¼šè¯çš„æ•°æ®ä¿å­˜å’Œæ£€ç´¢ã€‚
                    </p>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty advanced">ğŸ”´ é«˜çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
Memory/Store è®¿é—®ç¤ºä¾‹
åŠŸèƒ½ï¼šæŒä¹…åŒ–ç”¨æˆ·æ•°æ®
"""
from typing import Any
from langchain.tools import tool, ToolRuntime
from langgraph.store.memory import InMemoryStore
from langchain.agents import create_agent
from langchain.chat_models import init_chat_model

@tool
def get_user_info(user_id: str, runtime: ToolRuntime) -> str:
    """æŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯ã€‚

    Args:
        user_id: ç”¨æˆ· ID

    Returns:
        ç”¨æˆ·ä¿¡æ¯
    """
    store = runtime.store
    user_info = store.get(("users",), user_id)
    return str(user_info.value) if user_info else "æœªçŸ¥ç”¨æˆ·"

@tool
def save_user_info(
    user_id: str,
    user_info: dict[str, Any],
    runtime: ToolRuntime
) -> str:
    """ä¿å­˜ç”¨æˆ·ä¿¡æ¯ã€‚

    Args:
        user_id: ç”¨æˆ· ID
        user_info: ç”¨æˆ·ä¿¡æ¯å­—å…¸

    Returns:
        æˆåŠŸæ¶ˆæ¯
    """
    store = runtime.store
    store.put(("users",), user_id, user_info)
    return "æˆåŠŸä¿å­˜ç”¨æˆ·ä¿¡æ¯ã€‚"

# åˆ›å»ºå­˜å‚¨
store = InMemoryStore()

# åˆ›å»º Agent
model = init_chat_model("gpt-4o")
agent = create_agent(
    model,
    tools=[get_user_info, save_user_info],
    store=store
)

# ç¬¬ä¸€æ¬¡ä¼šè¯ï¼šä¿å­˜ç”¨æˆ·ä¿¡æ¯
agent.invoke({
    "messages": [{
        "role": "user",
        "content": "ä¿å­˜ä»¥ä¸‹ç”¨æˆ·ï¼šuserid: abc123, name: ç‹äº”, age: 25, email: [email protected]"
    }]
})

# ç¬¬äºŒæ¬¡ä¼šè¯ï¼šæ£€ç´¢æŒä¹…åŒ–æ•°æ®
result = agent.invoke({
    "messages": [{
        "role": "user",
        "content": "è·å–ç”¨æˆ· ID ä¸º 'abc123' çš„ç”¨æˆ·ä¿¡æ¯"
    }]
})

print(result["messages"][-1].content)</code></pre>
                    </div>
                </section>

                <!-- Stream Writer -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ“¡ Stream Writer å®æ—¶åé¦ˆ</h2>
                    <p>
                        ä½¿ç”¨ <code>runtime.stream_writer</code> å¯ä»¥åœ¨å·¥å…·æ‰§è¡ŒæœŸé—´
                        å‘ç”¨æˆ·å‘é€å®æ—¶è¿›åº¦æ›´æ–°ã€‚
                    </p>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
Stream Writer å®æ—¶åé¦ˆç¤ºä¾‹
åŠŸèƒ½ï¼šåœ¨å·¥å…·æ‰§è¡Œè¿‡ç¨‹ä¸­å‘é€è¿›åº¦æ›´æ–°
"""
from langchain.tools import tool, ToolRuntime
import time

@tool
def get_weather(city: str, runtime: ToolRuntime) -> str:
    """è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ã€‚

    Args:
        city: åŸå¸‚åç§°

    Returns:
        å¤©æ°”ä¿¡æ¯
    """
    writer = runtime.stream_writer

    # å‘é€è¿›åº¦æ›´æ–°
    writer(f"æ­£åœ¨æŸ¥æ‰¾ {city} çš„æ•°æ®...")
    time.sleep(1)  # æ¨¡æ‹Ÿ API è°ƒç”¨

    writer(f"å·²è·å– {city} çš„æ•°æ®")
    time.sleep(0.5)

    writer(f"æ­£åœ¨è§£æå¤©æ°”ä¿¡æ¯...")
    time.sleep(0.5)

    # è¿”å›æœ€ç»ˆç»“æœ
    return f"{city} ä»Šå¤©æ€»æ˜¯æ™´æœ—çš„ï¼"

@tool
def search_documents(query: str, runtime: ToolRuntime) -> str:
    """æœç´¢æ–‡æ¡£åº“ã€‚

    Args:
        query: æœç´¢æŸ¥è¯¢

    Returns:
        æœç´¢ç»“æœ
    """
    writer = runtime.stream_writer

    writer(f"å¼€å§‹æœç´¢ï¼š'{query}'")
    time.sleep(0.5)

    writer(f"æ­£åœ¨ç´¢å¼•ä¸­æŸ¥æ‰¾...")
    time.sleep(1)

    writer(f"æ‰¾åˆ° 3 ä¸ªç›¸å…³æ–‡æ¡£")
    time.sleep(0.5)

    writer(f"æ­£åœ¨æå–å†…å®¹...")

    return f"å…³äº '{query}' çš„æœç´¢ç»“æœï¼š[æ–‡æ¡£æ‘˜è¦]"</code></pre>
                    </div>

                    <div class="info-box warning">
                        <div class="info-box-title">âš ï¸ é‡è¦æç¤º</div>
                        <p>
                            å¦‚æœä½¿ç”¨ <code>runtime.stream_writer</code>ï¼Œ
                            å·¥å…·å¿…é¡»åœ¨ LangGraph æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ã€‚
                            åœ¨ç‹¬ç«‹è°ƒç”¨å·¥å…·æ—¶ä¸å¯ç”¨ã€‚
                        </p>
                    </div>
                </section>

                <!-- ä¿ç•™å‚æ•°å -->
                <section class="content-section">
                    <h2 class="section-title">ğŸš« ä¿ç•™å‚æ•°å</h2>
                    <p>
                        ä»¥ä¸‹å‚æ•°åä¸èƒ½ç”¨ä½œå·¥å…·å‚æ•°ï¼Œå®ƒä»¬ç”± LangChain ä¿ç•™ï¼š
                    </p>

                    <table>
                        <thead>
                            <tr>
                                <th>å‚æ•°å</th>
                                <th>ç”¨é€”</th>
                                <th>è¯´æ˜</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>config</code></td>
                                <td>é…ç½®å¯¹è±¡</td>
                                <td>ä¿ç•™ç»™ RunnableConfig</td>
                            </tr>
                            <tr>
                                <td><code>runtime</code></td>
                                <td>è¿è¡Œæ—¶ä¸Šä¸‹æ–‡</td>
                                <td>ä¿ç•™ç»™ ToolRuntime å‚æ•°</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python"># âŒ é”™è¯¯ï¼šä¸èƒ½ä½¿ç”¨ä¿ç•™å‚æ•°å
@tool
def bad_tool(query: str, config: dict) -> str:
    """è¿™ä¼šå¯¼è‡´é”™è¯¯ï¼"""
    return "..."

# âœ… æ­£ç¡®ï¼šä½¿ç”¨ runtime è®¿é—®é…ç½®
@tool
def good_tool(query: str, runtime: ToolRuntime) -> str:
    """ä½¿ç”¨ runtime è®¿é—®æ‰€éœ€ä¿¡æ¯"""
    # å¯ä»¥é€šè¿‡ runtime è®¿é—®é…ç½®å’ŒçŠ¶æ€
    return "..."</code></pre>
                    </div>
                </section>

                <!-- æœ€ä½³å®è·µ -->
                <section class="content-section">
                    <h2 class="section-title">âœ¨ æœ€ä½³å®è·µ</h2>

                    <h3 class="subsection-title">1. ç¼–å†™æ¸…æ™°çš„æ–‡æ¡£å­—ç¬¦ä¸²</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python"># âŒ ä¸å¥½ï¼šæ–‡æ¡£å­—ç¬¦ä¸²ä¸æ¸…æ™°
@tool
def search(q: str) -> str:
    """æœç´¢"""
    return "..."

# âœ… å¥½ï¼šæ¸…æ™°çš„æ–‡æ¡£å­—ç¬¦ä¸²
@tool
def search_database(query: str, limit: int = 10) -> str:
    """åœ¨å®¢æˆ·æ•°æ®åº“ä¸­æœç´¢è®°å½•ã€‚

    ä½¿ç”¨æ­¤å·¥å…·æŸ¥æ‰¾å®¢æˆ·ä¿¡æ¯ã€è®¢å•å†å²æˆ–äº§å“è¯¦æƒ…ã€‚
    æ”¯æŒæ¨¡ç³ŠåŒ¹é…å’Œå¤šå…³é”®è¯æœç´¢ã€‚

    Args:
        query: æœç´¢å…³é”®è¯ï¼ˆå®¢æˆ·åç§°ã€è®¢å•å·ã€äº§å“åç§°ç­‰ï¼‰
        limit: è¿”å›çš„æœ€å¤§ç»“æœæ•°é‡ï¼ˆé»˜è®¤ 10ï¼‰

    Returns:
        æœç´¢ç»“æœçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²
    """
    return "..."</code></pre>
                    </div>

                    <h3 class="subsection-title">2. è¿”å›æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python"># âŒ ä¸å¥½ï¼šæŠ›å‡ºå¼‚å¸¸
@tool
def divide(a: float, b: float) -> float:
    """é™¤æ³•è¿ç®—"""
    return a / b  # å¦‚æœ b=0 ä¼šæŠ›å‡ºå¼‚å¸¸

# âœ… å¥½ï¼šè¿”å›æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯
@tool
def divide(a: float, b: float) -> str:
    """æ‰§è¡Œé™¤æ³•è¿ç®—ã€‚

    Args:
        a: è¢«é™¤æ•°
        b: é™¤æ•°

    Returns:
        è®¡ç®—ç»“æœæˆ–é”™è¯¯æ¶ˆæ¯
    """
    if b == 0:
        return "é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸ºé›¶ã€‚è¯·æä¾›éé›¶çš„é™¤æ•°ã€‚"

    try:
        result = a / b
        return f"è®¡ç®—ç»“æœï¼š{a} Ã· {b} = {result}"
    except Exception as e:
        return f"è®¡ç®—å¤±è´¥ï¼š{str(e)}"</code></pre>
                    </div>

                    <h3 class="subsection-title">3. ä½¿ç”¨ç±»å‹æ³¨è§£å’ŒéªŒè¯</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">from pydantic import BaseModel, Field, validator
from typing import Literal

class EmailInput(BaseModel):
    """å‘é€é‚®ä»¶çš„è¾“å…¥å‚æ•°ã€‚"""
    to: str = Field(description="æ”¶ä»¶äººé‚®ç®±åœ°å€")
    subject: str = Field(description="é‚®ä»¶ä¸»é¢˜")
    body: str = Field(description="é‚®ä»¶æ­£æ–‡")
    priority: Literal["low", "normal", "high"] = Field(
        default="normal",
        description="é‚®ä»¶ä¼˜å…ˆçº§"
    )

    @validator("to")
    def validate_email(cls, v):
        """éªŒè¯é‚®ç®±æ ¼å¼"""
        if "@" not in v:
            raise ValueError("æ— æ•ˆçš„é‚®ç®±åœ°å€")
        return v

@tool(args_schema=EmailInput)
def send_email(to: str, subject: str, body: str, priority: str = "normal") -> str:
    """å‘é€é‚®ä»¶ã€‚"""
    return f"å·²å‘é€é‚®ä»¶åˆ° {to}"</code></pre>
                    </div>

                    <h3 class="subsection-title">4. å·¥å…·å‘½åè§„èŒƒ</h3>
                    <ul>
                        <li><strong>ä½¿ç”¨åŠ¨è¯å¼€å¤´</strong>ï¼šget_weatherã€search_databaseã€send_email</li>
                        <li><strong>æè¿°æ€§å‘½å</strong>ï¼šé¿å…è¿‡äºç®€çŸ­æˆ–æ¨¡ç³Šçš„åç§°</li>
                        <li><strong>ä¸€è‡´æ€§</strong>ï¼šä½¿ç”¨ç»Ÿä¸€çš„å‘½åé£æ ¼ï¼ˆsnake_caseï¼‰</li>
                    </ul>

                    <h3 class="subsection-title">5. å®‰å…¨æ€§è€ƒè™‘</h3>
                    <div class="info-box warning">
                        <div class="info-box-title">âš ï¸ å®‰å…¨æç¤º</div>
                        <ul>
                            <li><strong>è¾“å…¥éªŒè¯</strong>ï¼šå§‹ç»ˆéªŒè¯å’Œæ¸…ç†ç”¨æˆ·è¾“å…¥</li>
                            <li><strong>æƒé™æ£€æŸ¥</strong>ï¼šä½¿ç”¨ runtime.context éªŒè¯ç”¨æˆ·æƒé™</li>
                            <li><strong>é¿å…å±é™©æ“ä½œ</strong>ï¼šä¸è¦ä½¿ç”¨ eval()ã€exec() ç­‰</li>
                            <li><strong>æ•æ„Ÿæ•°æ®</strong>ï¼šä¸è¦åœ¨å·¥å…·æè¿°ä¸­æš´éœ²æ•æ„Ÿä¿¡æ¯</li>
                        </ul>
                    </div>
                </section>

                <!-- å®Œæ•´ç¤ºä¾‹ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ¯ å®Œæ•´ç¤ºä¾‹ï¼šè®¢å•ç®¡ç†å·¥å…·é›†</h2>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty advanced">ğŸ”´ é«˜çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
è®¢å•ç®¡ç†å·¥å…·é›†å®Œæ•´ç¤ºä¾‹
åŠŸèƒ½ï¼šä¸€ç»„å®Œæ•´çš„è®¢å•ç®¡ç†å·¥å…·
"""
from dataclasses import dataclass
from typing import Literal
from pydantic import BaseModel, Field
from langchain.tools import tool, ToolRuntime
from langchain.agents import create_agent
from langchain.chat_models import init_chat_model

# æ¨¡æ‹Ÿè®¢å•æ•°æ®åº“
ORDERS = {
    "ORD001": {"product": "ç¬”è®°æœ¬ç”µè„‘", "status": "å·²å‘è´§", "amount": 5999},
    "ORD002": {"product": "é¼ æ ‡", "status": "å¤„ç†ä¸­", "amount": 99},
}

# ç”¨æˆ·ä¸Šä¸‹æ–‡
@dataclass
class UserContext:
    user_id: str
    role: str  # 'customer' æˆ– 'admin'

# æŸ¥è¯¢è®¢å•å·¥å…·
@tool
def query_order(order_id: str) -> str:
    """æŸ¥è¯¢è®¢å•çŠ¶æ€ã€‚

    Args:
        order_id: è®¢å•ç¼–å·

    Returns:
        è®¢å•è¯¦æƒ…æˆ–é”™è¯¯æ¶ˆæ¯
    """
    if order_id in ORDERS:
        order = ORDERS[order_id]
        return (
            f"è®¢å• {order_id}ï¼š\n"
            f"  äº§å“ï¼š{order['product']}\n"
            f"  çŠ¶æ€ï¼š{order['status']}\n"
            f"  é‡‘é¢ï¼šÂ¥{order['amount']}"
        )
    return f"æœªæ‰¾åˆ°è®¢å• {order_id}"

# å–æ¶ˆè®¢å•å·¥å…·ï¼ˆéœ€è¦æƒé™æ£€æŸ¥ï¼‰
@tool
def cancel_order(order_id: str, runtime: ToolRuntime[UserContext]) -> str:
    """å–æ¶ˆè®¢å•ã€‚

    Args:
        order_id: è¦å–æ¶ˆçš„è®¢å•ç¼–å·

    Returns:
        æ“ä½œç»“æœ
    """
    # æƒé™æ£€æŸ¥
    user_role = runtime.context.role
    if user_role not in ["customer", "admin"]:
        return "æƒé™ä¸è¶³ï¼šæ— æ³•å–æ¶ˆè®¢å•"

    if order_id not in ORDERS:
        return f"æœªæ‰¾åˆ°è®¢å• {order_id}"

    order = ORDERS[order_id]
    if order["status"] == "å·²å‘è´§":
        return f"è®¢å• {order_id} å·²å‘è´§ï¼Œæ— æ³•å–æ¶ˆã€‚è¯·è”ç³»å®¢æœå¤„ç†é€€è´§ã€‚"

    # å–æ¶ˆè®¢å•
    order["status"] = "å·²å–æ¶ˆ"
    return f"è®¢å• {order_id} å·²æˆåŠŸå–æ¶ˆã€‚"

# æ›´æ–°è®¢å•çŠ¶æ€å·¥å…·ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
class OrderStatusInput(BaseModel):
    """æ›´æ–°è®¢å•çŠ¶æ€çš„è¾“å…¥å‚æ•°ã€‚"""
    order_id: str = Field(description="è®¢å•ç¼–å·")
    new_status: Literal["å¤„ç†ä¸­", "å·²å‘è´§", "å·²å®Œæˆ", "å·²å–æ¶ˆ"] = Field(
        description="æ–°çš„è®¢å•çŠ¶æ€"
    )

@tool(args_schema=OrderStatusInput)
def update_order_status(
    order_id: str,
    new_status: str,
    runtime: ToolRuntime[UserContext]
) -> str:
    """æ›´æ–°è®¢å•çŠ¶æ€ï¼ˆä»…ç®¡ç†å‘˜ï¼‰ã€‚

    Args:
        order_id: è®¢å•ç¼–å·
        new_status: æ–°çŠ¶æ€

    Returns:
        æ“ä½œç»“æœ
    """
    # ä»…ç®¡ç†å‘˜å¯ç”¨
    if runtime.context.role != "admin":
        return "æƒé™ä¸è¶³ï¼šæ­¤æ“ä½œä»…é™ç®¡ç†å‘˜"

    if order_id not in ORDERS:
        return f"æœªæ‰¾åˆ°è®¢å• {order_id}"

    ORDERS[order_id]["status"] = new_status
    return f"è®¢å• {order_id} çŠ¶æ€å·²æ›´æ–°ä¸ºï¼š{new_status}"

# åˆ›å»º Agent
model = init_chat_model("gpt-4o")

customer_agent = create_agent(
    model,
    tools=[query_order, cancel_order],
    context_schema=UserContext,
    system_prompt="ä½ æ˜¯å®¢æœåŠ©æ‰‹ï¼Œå¸®åŠ©ç”¨æˆ·ç®¡ç†è®¢å•ã€‚"
)

admin_agent = create_agent(
    model,
    tools=[query_order, cancel_order, update_order_status],
    context_schema=UserContext,
    system_prompt="ä½ æ˜¯ç®¡ç†å‘˜åŠ©æ‰‹ï¼Œå¯ä»¥ç®¡ç†æ‰€æœ‰è®¢å•ã€‚"
)

# å®¢æˆ·åœºæ™¯
print("=== å®¢æˆ·åœºæ™¯ ===")
result1 = customer_agent.invoke(
    {"messages": [{"role": "user", "content": "æŸ¥è¯¢è®¢å• ORD001 çš„çŠ¶æ€"}]},
    context=UserContext(user_id="customer1", role="customer")
)
print(result1["messages"][-1].content)

# ç®¡ç†å‘˜åœºæ™¯
print("\n=== ç®¡ç†å‘˜åœºæ™¯ ===")
result2 = admin_agent.invoke(
    {"messages": [{"role": "user", "content": "å°†è®¢å• ORD002 çŠ¶æ€æ›´æ–°ä¸ºå·²å‘è´§"}]},
    context=UserContext(user_id="admin1", role="admin")
)
print(result2["messages"][-1].content)</code></pre>
                    </div>
                </section>

                <!-- å¸¸è§é—®é¢˜ -->
                <section class="content-section">
                    <h2 class="section-title">â“ å¸¸è§é—®é¢˜</h2>

                    <h3 class="subsection-subtitle">Q1: å·¥å…·å¿…é¡»è¿”å›å­—ç¬¦ä¸²å—ï¼Ÿ</h3>
                    <p>
                        ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†<strong>å¼ºçƒˆæ¨è</strong>ã€‚è¿”å›å­—ç¬¦ä¸²èƒ½ç¡®ä¿ï¼š
                    </p>
                    <ul>
                        <li>æ¨¡å‹èƒ½æ­£ç¡®ç†è§£å·¥å…·ç»“æœ</li>
                        <li>ä¾¿äºè°ƒè¯•å’Œæ—¥å¿—è®°å½•</li>
                        <li>è·¨æ¨¡å‹æä¾›å•†çš„å…¼å®¹æ€§</li>
                    </ul>
                    <p>
                        å¦‚æœéœ€è¦è¿”å›ç»“æ„åŒ–æ•°æ®ä¾›åº”ç”¨ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>response_format="content_and_artifact"</code>ã€‚
                    </p>

                    <h3 class="subsection-subtitle">Q2: å¦‚ä½•æµ‹è¯•å·¥å…·ï¼Ÿ</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python"># ç›´æ¥è°ƒç”¨å·¥å…·æµ‹è¯•
result = search_database.invoke({"query": "æµ‹è¯•", "limit": 5})
print(result)

# ä½¿ç”¨ pytest ç¼–å†™å•å…ƒæµ‹è¯•
def test_search_database():
    result = search_database.invoke({"query": "å®¢æˆ·", "limit": 3})
    assert "æ‰¾åˆ°" in result
    assert "å®¢æˆ·" in result</code></pre>
                    </div>

                    <h3 class="subsection-subtitle">Q3: runtime å‚æ•°ä½•æ—¶å¯ç”¨ï¼Ÿ</h3>
                    <p>
                        <code>runtime</code> å‚æ•°ä»…åœ¨ä»¥ä¸‹æƒ…å†µå¯ç”¨ï¼š
                    </p>
                    <ul>
                        <li>å·¥å…·åœ¨ <code>create_agent()</code> åˆ›å»ºçš„ Agent ä¸­ä½¿ç”¨</li>
                        <li>å·¥å…·åœ¨ LangGraph æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è°ƒç”¨</li>
                    </ul>
                    <p>
                        å¦‚æœå•ç‹¬æµ‹è¯•å·¥å…·ï¼Œruntime å‚æ•°ä¼šæ˜¯ None æˆ–ä¸å¯ç”¨ã€‚
                    </p>

                    <h3 class="subsection-subtitle">Q4: å¦‚ä½•å¤„ç†å·¥å…·æ‰§è¡Œè¶…æ—¶ï¼Ÿ</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">import asyncio
from langchain.tools import tool

@tool
async def slow_operation(query: str) -> str:
    """æ‰§è¡Œè€—æ—¶æ“ä½œ"""
    try:
        # è®¾ç½®è¶…æ—¶
        result = await asyncio.wait_for(
            some_async_function(query),
            timeout=10.0  # 10 ç§’è¶…æ—¶
        )
        return result
    except asyncio.TimeoutError:
        return "æ“ä½œè¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•"</code></pre>
                    </div>

                    <h3 class="subsection-subtitle">Q5: å·¥å…·å¯ä»¥è°ƒç”¨å…¶ä»–å·¥å…·å—ï¼Ÿ</h3>
                    <p>
                        å·¥å…·ä¸åº”è¯¥ç›´æ¥è°ƒç”¨å…¶ä»–å·¥å…·ã€‚å¦‚æœéœ€è¦ç»„åˆå¤šä¸ªæ“ä½œï¼Œåº”è¯¥ï¼š
                    </p>
                    <ul>
                        <li>è®© Agent å†³å®šè°ƒç”¨é¡ºåº</li>
                        <li>åˆ›å»ºä¸€ä¸ªæ–°çš„å¤åˆå·¥å…·</li>
                        <li>ä½¿ç”¨ä¸­é—´ä»¶å¤„ç†å·¥å…·é“¾</li>
                    </ul>
                </section>

                <!-- å‚è€ƒèµ„æº -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ”— å‚è€ƒèµ„æº</h2>
                    <ul>
                        <li>
                            <a href="https://docs.langchain.com/oss/python/langchain/tools" target="_blank">
                                LangChain å®˜æ–¹ Tools æ–‡æ¡£
                            </a>
                        </li>
                        <li>
                            <a href="https://python.langchain.com/docs/how_to/#tools" target="_blank">
                                Tools ä½¿ç”¨æŒ‡å—
                            </a>
                        </li>
                        <li>
                            <a href="https://reference.langchain.com/python/langchain/tools.html" target="_blank">
                                Tools API å‚è€ƒ
                            </a>
                        </li>
                        <li>
                            <a href="https://python.langchain.com/docs/integrations/tools/" target="_blank">
                                é¢„æ„å»ºå·¥å…·é›†æˆ
                            </a>
                        </li>
                    </ul>
                </section>

                <!-- é¡µé¢å¯¼èˆª -->
                                <nav class="page-navigation">
                    <a href="04-messages.html" class="nav-button prev">
                        â† ä¸Šä¸€é¡µ:æ¶ˆæ¯ç³»ç»Ÿ
                    </a>
                    <a href="06-agents.html" class="nav-button next">
                        ä¸‹ä¸€é¡µ:Agent åŸºç¡€ â†’
                    </a>
                </nav>
            </div>
        </main>
    </div>

    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button class="back-to-top" aria-label="è¿”å›é¡¶éƒ¨">â†‘</button>

    <!-- JavaScript -->
    <script src="assets/js/mermaid-init.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</body>
</html>
