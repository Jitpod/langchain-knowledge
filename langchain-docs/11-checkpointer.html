<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="LangChain 1.0 æ ¸å¿ƒæ¶æ„ - æ·±å…¥ç†è§£ LangChain çš„è®¾è®¡å“²å­¦å’Œæ¨¡å—ç»„ç»‡">
    <title>æ ¸å¿ƒæ¶æ„ | LangChain 1.0 Python çŸ¥è¯†æ–‡æ¡£</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <button class="mobile-menu-button" aria-label="æ‰“å¼€èœå•">â˜°</button>

    <div class="container">
        <!-- ä¾§è¾¹æ å¯¼èˆª -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1 class="sidebar-title">ğŸ¦œ LangChain 1.0</h1>
                <p class="sidebar-subtitle">Python å®Œæ•´å­¦ä¹ æŒ‡å—</p>
            </div>

            <ul class="nav-menu">
                <li class="nav-section">
                    <div class="nav-section-title">å¼€å§‹</div>
                    <ul>
                        <li class="nav-item">
                            <a href="index.html" class="nav-link">
                                <span class="nav-icon">ğŸ </span>
                                ä¸»é¡µ
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">åŸºç¡€ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="01-introduction.html" class="nav-link">
                                <span class="nav-icon">ğŸ“–</span>
                                LangChain ç®€ä»‹
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="02-architecture.html" class="nav-link">
                                <span class="nav-icon">ğŸ—ï¸</span>
                                æ ¸å¿ƒæ¶æ„
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="03-models.html" class="nav-link">
                                <span class="nav-icon">ğŸ¤–</span>
                                æ¨¡å‹æ¥å£
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="04-messages.html" class="nav-link">
                                <span class="nav-icon">ğŸ’¬</span>
                                æ¶ˆæ¯ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="05-tools.html" class="nav-link">
                                <span class="nav-icon">ğŸ”§</span>
                                å·¥å…·ç³»ç»Ÿ
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">è¿›é˜¶ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="06-agents.html" class="nav-link">
                                <span class="nav-icon">ğŸ¯</span>
                                Agent åŸºç¡€
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="07-middleware.html" class="nav-link">
                                <span class="nav-icon">âš™ï¸</span>
                                ä¸­é—´ä»¶ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="08-rag.html" class="nav-link">
                                <span class="nav-icon">ğŸ”</span>
                                RAG è¯¦è§£
                                <span class="nav-badge">é‡ç‚¹</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="09-lcel.html" class="nav-link">
                                <span class="nav-icon">ğŸ”—</span>
                                LCEL è¡¨è¾¾å¼
                            </a>
                        </li>
                    </ul>
                </li>

                                <li class="nav-section">
                    <div class="nav-section-title">é«˜çº§åº”ç”¨</div>
                    <ul>
                        <li class="nav-item">
                            <a href="10-runtime.html" class="nav-link">
                                <span class="nav-icon">ğŸ”Œ</span>
                                Runtime ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item active">
                            <a href="11-checkpointer.html" class="nav-link">
                                <span class="nav-icon">ğŸ’¾</span>
                                æŒä¹…åŒ–ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="12-streaming.html" class="nav-link">
                                <span class="nav-icon">ğŸŒŠ</span>
                                æµå¼è¾“å‡º
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="13-human-in-loop.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¤</span>
                                äººå·¥ä»‹å…¥
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="14-long-term-memory.html" class="nav-link">
                                <span class="nav-icon">ğŸ—„ï¸</span>
                                é•¿æœŸè®°å¿†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="15-langgraph.html" class="nav-link">
                                <span class="nav-icon">ğŸ“Š</span>
                                LangGraph
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="16-context-engineering.html" class="nav-link">
                                <span class="nav-icon">ğŸ¯</span>
                                ä¸Šä¸‹æ–‡å·¥ç¨‹
                                <span class="nav-badge">é‡ç‚¹</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="17-mcp.html" class="nav-link">
                                <span class="nav-icon">ğŸ”Œ</span>
                                MCP åè®®
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">å®æˆ˜ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="18-customer-service.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¥</span>
                                å®¢æœæœºå™¨äºº
                                <span class="nav-badge">é‡ç‚¹</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="19-best-practices.html" class="nav-link">
                                <span class="nav-icon">âœ¨</span>
                                æœ€ä½³å®è·µ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="38-chat.html" class="nav-link">
                                <span class="nav-icon">ğŸ’¬</span>
                                åœ¨çº¿å¯¹è¯åŠ©æ‰‹
                                <span class="nav-badge">NEW</span>
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">å‚è€ƒç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="20-api-reference.html" class="nav-link">
                                <span class="nav-icon">ğŸ“š</span>
                                API é€ŸæŸ¥è¡¨
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="21-troubleshooting.html" class="nav-link">
                                <span class="nav-icon">ğŸ›</span>
                                æ•…éšœæ’é™¤
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="22-migration.html" class="nav-link">
                                <span class="nav-icon">ğŸ”„</span>
                                è¿ç§»æŒ‡å—
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">æ‰©å±•ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="23-structured-output.html" class="nav-link">
                                <span class="nav-icon">ğŸ“Š</span>
                                ç»“æ„åŒ–è¾“å‡º
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">DeepAgents ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="24-deepagents-quickstart.html" class="nav-link">
                                <span class="nav-icon">ğŸš€</span>
                                å¿«é€Ÿå¼€å§‹
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="25-deepagents-customization.html" class="nav-link">
                                <span class="nav-icon">ğŸ¨</span>
                                å®šåˆ¶åŒ–
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="26-deepagents-harness.html" class="nav-link">
                                <span class="nav-icon">ğŸ›ï¸</span>
                                Harness ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="27-deepagents-backends.html" class="nav-link">
                                <span class="nav-icon">ğŸ”§</span>
                                åç«¯é…ç½®
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="28-deepagents-subagents.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¥</span>
                                å­ä»£ç†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="29-deepagents-hitl.html" class="nav-link">
                                <span class="nav-icon">ğŸ¤</span>
                                äººå·¥ä»‹å…¥
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="30-deepagents-memory.html" class="nav-link">
                                <span class="nav-icon">ğŸ§ </span>
                                é•¿æœŸè®°å¿†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="31-deepagents-middleware.html" class="nav-link">
                                <span class="nav-icon">âš™ï¸</span>
                                ä¸­é—´ä»¶
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">Multi-Agent ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="32-multi-agent-index.html" class="nav-link">
                                <span class="nav-icon">ğŸŒ</span>
                                æ¦‚è¿°
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="33-multi-agent-subagents.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¥</span>
                                å­ä»£ç†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="34-multi-agent-handoffs.html" class="nav-link">
                                <span class="nav-icon">ğŸ”„</span>
                                äº¤æ¥æœºåˆ¶
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="35-multi-agent-skills.html" class="nav-link">
                                <span class="nav-icon">ğŸ¯</span>
                                æŠ€èƒ½ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="36-multi-agent-router.html" class="nav-link">
                                <span class="nav-icon">ğŸ§­</span>
                                è·¯ç”±æœºåˆ¶
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="37-multi-agent-workflow.html" class="nav-link">
                                <span class="nav-icon">ğŸ”€</span>
                                è‡ªå®šä¹‰å·¥ä½œæµ
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <div class="content-wrapper">
                <!-- é¢åŒ…å±‘å¯¼èˆª -->
                <nav class="breadcrumb">
                    <span class="breadcrumb-item">
                        <a href="index.html" class="breadcrumb-link">ä¸»é¡µ</a>
                    </span>
                    <span class="breadcrumb-item">
                        é«˜çº§åº”ç”¨
                    </span>
                    <span class="breadcrumb-item">
                        æŒä¹…åŒ–ç³»ç»Ÿ
                    </span>
                </nav>

                <!-- é¡µé¢æ ‡é¢˜ -->
                <header class="page-header">
                    <h1 class="page-title">ğŸ’¾ Checkpointer æŒä¹…åŒ–ç³»ç»Ÿ</h1>
                    <p class="page-subtitle">
                        æŒæ¡ LangChain 1.0 çš„ Checkpointer æœºåˆ¶ï¼Œå®ç°å¯¹è¯å†å²æŒä¹…åŒ–å’ŒçŸ­æœŸè®°å¿†ç®¡ç†ï¼Œ
                        æ„å»ºæœ‰çŠ¶æ€çš„ AI Agent åº”ç”¨ã€‚
                    </p>
                </header>

                <!-- Checkpointer ç®€ä»‹ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ“š ä»€ä¹ˆæ˜¯ Checkpointerï¼Ÿ</h2>
                    <p>
                        <strong>Checkpointer</strong> æ˜¯ LangChain 1.0 çš„çŠ¶æ€æŒä¹…åŒ–æœºåˆ¶ï¼Œ
                        è®© Agent èƒ½å¤Ÿè®°ä½å¯¹è¯å†å²ï¼Œå®ç°çœŸæ­£çš„<strong>çŸ­æœŸè®°å¿†ï¼ˆShort-term Memoryï¼‰</strong>ã€‚
                    </p>

                    <div class="info-box note">
                        <div class="info-box-title">ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</div>
                        <ul>
                            <li><strong>Threadï¼ˆçº¿ç¨‹ï¼‰</strong>ï¼šä¸€ä¸ªç‹¬ç«‹çš„å¯¹è¯ä¼šè¯ï¼Œç±»ä¼¼é‚®ä»¶çš„ä¼šè¯è§†å›¾</li>
                            <li><strong>Checkpointï¼ˆæ£€æŸ¥ç‚¹ï¼‰</strong>ï¼šAgent çŠ¶æ€çš„å¿«ç…§ï¼ŒåŒ…å«å®Œæ•´çš„æ¶ˆæ¯å†å²</li>
                            <li><strong>Thread ID</strong>ï¼šå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„å¯¹è¯ä¼šè¯</li>
                            <li><strong>Stateï¼ˆçŠ¶æ€ï¼‰</strong>ï¼šåŒ…å« messagesã€è‡ªå®šä¹‰å­—æ®µç­‰çš„å®Œæ•´ä¸Šä¸‹æ–‡</li>
                        </ul>
                        <p style="margin-top: 0.5rem;">
                            é€šè¿‡ Checkpointerï¼ŒAgent å¯ä»¥è®¿é—®å®Œæ•´çš„å¯¹è¯å†å²ï¼ŒåŒæ—¶ä¿æŒä¸åŒ Thread ä¹‹é—´çš„éš”ç¦»ã€‚
                        </p>
                    </div>

                    <h3 class="subsection-title">ä¸ºä»€ä¹ˆéœ€è¦ Checkpointerï¼Ÿ</h3>
                    <p>é•¿å¯¹è¯é¢ä¸´ä»¥ä¸‹æŒ‘æˆ˜ï¼š</p>
                    <ul>
                        <li><strong>ä¸Šä¸‹æ–‡çª—å£é™åˆ¶</strong>ï¼šå®Œæ•´å†å²å¯èƒ½è¶…å‡º LLM çš„ token é™åˆ¶</li>
                        <li><strong>ä¼šè¯éš”ç¦»</strong>ï¼šéœ€è¦åŒºåˆ†ä¸åŒç”¨æˆ·æˆ–ä¼šè¯çš„å¯¹è¯</li>
                        <li><strong>çŠ¶æ€ä¸¢å¤±</strong>ï¼šAgent é‡å¯åéœ€è¦æ¢å¤å¯¹è¯ä¸Šä¸‹æ–‡</li>
                        <li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šæ¯æ¬¡è¯·æ±‚é‡æ–°åŠ è½½æ‰€æœ‰å†å²æ•ˆç‡ä½</li>
                    </ul>
                </section>

                <!-- Checkpointer æ¶æ„ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ—ï¸ Checkpointer æ¶æ„</h2>

                    <div class="mermaid-wrapper">
                        <div class="mermaid">
graph TB
    A[ç”¨æˆ·è¯·æ±‚] --> B{æä¾› thread_idï¼Ÿ}
    B -->|æ˜¯| C[Checkpointer åŠ è½½çŠ¶æ€]
    B -->|å¦| D[åˆ›å»ºæ–° Thread]

    C --> E[æ¢å¤æ¶ˆæ¯å†å²]
    D --> E

    E --> F[Agent å¤„ç†]
    F --> G[ç”Ÿæˆå“åº”]

    G --> H[ä¿å­˜æ–°çŠ¶æ€]
    H --> I[è¿”å›å“åº”]

    subgraph "Checkpointer å­˜å‚¨"
        J[Thread 1 çŠ¶æ€]
        K[Thread 2 çŠ¶æ€]
        L[Thread N çŠ¶æ€]
    end

    C -.è¯»å–.-> J
    H -.å†™å…¥.-> J

    style C fill:#3b82f6,color:#fff
    style H fill:#10b981,color:#fff
    style J fill:#f59e0b,color:#fff
    style K fill:#f59e0b,color:#fff
    style L fill:#f59e0b,color:#fff
                        </div>
                    </div>

                    <h3 class="subsection-title">æ‰§è¡Œæµç¨‹è¯´æ˜</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>æ­¥éª¤</th>
                                <th>æ“ä½œ</th>
                                <th>è¯´æ˜</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1. è¯·æ±‚åˆ°è¾¾</td>
                                <td>æ£€æŸ¥ thread_id</td>
                                <td>åˆ¤æ–­æ˜¯å¦ä¸ºç°æœ‰å¯¹è¯</td>
                            </tr>
                            <tr>
                                <td>2. åŠ è½½çŠ¶æ€</td>
                                <td>ä» Checkpointer è¯»å–</td>
                                <td>æ¢å¤å®Œæ•´çš„æ¶ˆæ¯å†å²å’Œè‡ªå®šä¹‰çŠ¶æ€</td>
                            </tr>
                            <tr>
                                <td>3. Agent å¤„ç†</td>
                                <td>ä½¿ç”¨å†å²ä¸Šä¸‹æ–‡</td>
                                <td>æ¨¡å‹å¯ä»¥è®¿é—®ä¹‹å‰çš„å¯¹è¯å†…å®¹</td>
                            </tr>
                            <tr>
                                <td>4. ä¿å­˜çŠ¶æ€</td>
                                <td>å†™å…¥ Checkpointer</td>
                                <td>æŒä¹…åŒ–æ–°çš„æ¶ˆæ¯å’ŒçŠ¶æ€å˜åŒ–</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <!-- Checkpointer ç±»å‹ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ—‚ï¸ Checkpointer ç±»å‹å¯¹æ¯”</h2>

                    <table>
                        <thead>
                            <tr>
                                <th>ç±»å‹</th>
                                <th>å­˜å‚¨ä½ç½®</th>
                                <th>æŒä¹…æ€§</th>
                                <th>é€‚ç”¨åœºæ™¯</th>
                                <th>å®‰è£…</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>InMemorySaver</strong></td>
                                <td>åº”ç”¨å†…å­˜</td>
                                <td>âŒ é‡å¯ä¸¢å¤±</td>
                                <td>å¼€å‘æµ‹è¯•</td>
                                <td>å†…ç½®</td>
                            </tr>
                            <tr>
                                <td><strong>SqliteSaver</strong></td>
                                <td>SQLite æ–‡ä»¶</td>
                                <td>âœ… æ–‡ä»¶æŒä¹…åŒ–</td>
                                <td>å°å‹éƒ¨ç½²ã€å•æœºåº”ç”¨</td>
                                <td><code>langgraph-checkpoint-sqlite</code></td>
                            </tr>
                            <tr>
                                <td><strong>PostgresSaver</strong></td>
                                <td>PostgreSQL æ•°æ®åº“</td>
                                <td>âœ… æ•°æ®åº“æŒä¹…åŒ–</td>
                                <td>ç”Ÿäº§ç¯å¢ƒã€å¤šå®ä¾‹</td>
                                <td><code>langgraph-checkpoint-postgres</code></td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 class="subsection-title">1. InMemorySaver - å¼€å‘æµ‹è¯•</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty basic">ğŸŸ¢ åŸºç¡€</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
InMemorySaver ç¤ºä¾‹
åŠŸèƒ½ï¼šå†…å­˜å­˜å‚¨ï¼Œé€‚åˆå¼€å‘æµ‹è¯•
"""
from langchain.agents import create_agent
from langgraph.checkpoint.memory import InMemorySaver

# åˆ›å»ºå¸¦å†…å­˜æŒä¹…åŒ–çš„ Agent
agent = create_agent(
    model="gpt-4o",
    tools=[],
    checkpointer=InMemorySaver(),  # å†…å­˜å­˜å‚¨
)

# ç¬¬ä¸€è½®å¯¹è¯
response1 = agent.invoke(
    {"messages": [{"role": "user", "content": "ä½ å¥½ï¼æˆ‘å«å¼ ä¸‰ã€‚"}]},
    {"configurable": {"thread_id": "user_001"}}  # æŒ‡å®š Thread ID
)
print(response1["messages"][-1].content)

# ç¬¬äºŒè½®å¯¹è¯ï¼ˆè®°ä½ä¹‹å‰çš„å†…å®¹ï¼‰
response2 = agent.invoke(
    {"messages": [{"role": "user", "content": "æˆ‘åˆšæ‰è¯´æˆ‘å«ä»€ä¹ˆï¼Ÿ"}]},
    {"configurable": {"thread_id": "user_001"}}  # ç›¸åŒ Thread ID
)
print(response2["messages"][-1].content)  # è¾“å‡ºï¼š"ä½ è¯´ä½ å«å¼ ä¸‰ã€‚"</code></pre>
                    </div>

                    <div class="info-box warning">
                        <div class="info-box-title">âš ï¸ InMemorySaver é™åˆ¶</div>
                        <p>
                            InMemorySaver ä»…å°†çŠ¶æ€å­˜å‚¨åœ¨åº”ç”¨å†…å­˜ä¸­ã€‚ä¸€æ—¦åº”ç”¨é‡å¯ï¼Œæ‰€æœ‰å¯¹è¯å†å²éƒ½ä¼šä¸¢å¤±ã€‚
                            <strong>ä»…ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨æ•°æ®åº“å­˜å‚¨ã€‚</strong>
                        </p>
                    </div>

                    <h3 class="subsection-title">2. PostgresSaver - ç”Ÿäº§ç¯å¢ƒ</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Bash</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-bash"># å®‰è£… PostgreSQL Checkpointer
pip install langgraph-checkpoint-postgres</code></pre>
                    </div>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
PostgresSaver ç¤ºä¾‹
åŠŸèƒ½ï¼šç”Ÿäº§çº§æ•°æ®åº“æŒä¹…åŒ–
"""
from langchain.agents import create_agent
from langgraph.checkpoint.postgres import PostgresSaver

# PostgreSQL è¿æ¥å­—ç¬¦ä¸²
DB_URI = "postgresql://username:password@localhost:5432/langchain_db"

# ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨
with PostgresSaver.from_conn_string(DB_URI) as checkpointer:
    # é¦–æ¬¡ä½¿ç”¨éœ€è¦åˆå§‹åŒ–è¡¨ç»“æ„
    checkpointer.setup()

    # åˆ›å»º Agent
    agent = create_agent(
        model="gpt-4o",
        tools=[],
        checkpointer=checkpointer,
    )

    # ç”¨æˆ· A çš„å¯¹è¯
    agent.invoke(
        {"messages": [{"role": "user", "content": "æˆ‘å–œæ¬¢è“è‰²"}]},
        {"configurable": {"thread_id": "user_A"}}
    )

    # ç”¨æˆ· B çš„å¯¹è¯ï¼ˆå®Œå…¨éš”ç¦»ï¼‰
    agent.invoke(
        {"messages": [{"role": "user", "content": "æˆ‘å–œæ¬¢çº¢è‰²"}]},
        {"configurable": {"thread_id": "user_B"}}
    )

    # ç”¨æˆ· A ç»§ç»­å¯¹è¯ï¼ˆè®°ä½ä¹‹å‰çš„å†…å®¹ï¼‰
    response = agent.invoke(
        {"messages": [{"role": "user", "content": "æˆ‘å–œæ¬¢ä»€ä¹ˆé¢œè‰²ï¼Ÿ"}]},
        {"configurable": {"thread_id": "user_A"}}
    )
    print(response["messages"][-1].content)  # è¾“å‡ºï¼š"ä½ å–œæ¬¢è“è‰²ã€‚"</code></pre>
                    </div>

                    <h3 class="subsection-title">3. SqliteSaver - è½»é‡éƒ¨ç½²</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Bash</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-bash"># å®‰è£… SQLite Checkpointer
pip install langgraph-checkpoint-sqlite</code></pre>
                    </div>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty basic">ğŸŸ¢ åŸºç¡€</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
SqliteSaver ç¤ºä¾‹
åŠŸèƒ½ï¼šæ–‡ä»¶æŒä¹…åŒ–ï¼Œé€‚åˆå°å‹éƒ¨ç½²
"""
from langchain.agents import create_agent
from langgraph.checkpoint.sqlite import SqliteSaver

# åˆ›å»º SQLite Checkpointerï¼ˆå­˜å‚¨åˆ°æ–‡ä»¶ï¼‰
with SqliteSaver.from_conn_string("checkpoints.db") as checkpointer:
    checkpointer.setup()

    agent = create_agent(
        model="gpt-4o",
        tools=[],
        checkpointer=checkpointer,
    )

    # å¯¹è¯ä¼šæŒä¹…åŒ–åˆ° checkpoints.db æ–‡ä»¶
    agent.invoke(
        {"messages": [{"role": "user", "content": "ä½ å¥½"}]},
        {"configurable": {"thread_id": "session_123"}}
    )</code></pre>
                    </div>
                </section>

                <!-- Thread ID å’Œä¼šè¯éš”ç¦» -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ”‘ Thread ID å’Œä¼šè¯éš”ç¦»</h2>
                    <p>
                        <code>thread_id</code> æ˜¯ Checkpointer çš„æ ¸å¿ƒæ¦‚å¿µï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„å¯¹è¯ä¼šè¯ã€‚
                    </p>

                    <div class="mermaid-wrapper">
                        <div class="mermaid">
graph LR
    A[ç”¨æˆ·è¯·æ±‚] --> B{thread_id}

    B -->|thread_001| C[Thread 1 å†å²]
    B -->|thread_002| D[Thread 2 å†å²]
    B -->|thread_003| E[Thread 3 å†å²]

    C --> F[Agent å¤„ç†]
    D --> F
    E --> F

    F --> G[å“åº”]

    G -->|ä¿å­˜| C
    G -->|ä¿å­˜| D
    G -->|ä¿å­˜| E

    style C fill:#3b82f6,color:#fff
    style D fill:#10b981,color:#fff
    style E fill:#f59e0b,color:#fff
                        </div>
                    </div>

                    <h3 class="subsection-title">Thread ID ä½¿ç”¨æ¨¡å¼</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
Thread ID ä½¿ç”¨ç¤ºä¾‹
åŠŸèƒ½ï¼šæ¼”ç¤ºä¼šè¯éš”ç¦»å’Œ Thread ID è®¾è®¡æ¨¡å¼
"""
from langchain.agents import create_agent
from langgraph.checkpoint.memory import InMemorySaver
import uuid

agent = create_agent("gpt-4o", tools=[], checkpointer=InMemorySaver())

# æ¨¡å¼ 1ï¼šç”¨æˆ· ID ä½œä¸º Thread IDï¼ˆå•ç”¨æˆ·å¤šä¼šè¯ï¼‰
user_id = "user_12345"
session_id = "session_001"
thread_id = f"{user_id}_{session_id}"

agent.invoke(
    {"messages": [{"role": "user", "content": "å¸®æˆ‘åˆ›å»ºè®¢å•"}]},
    {"configurable": {"thread_id": thread_id}}
)

# æ¨¡å¼ 2ï¼šéšæœºç”Ÿæˆ Thread IDï¼ˆåŒ¿åä¼šè¯ï¼‰
thread_id = str(uuid.uuid4())  # ç”Ÿæˆå”¯ä¸€ ID
agent.invoke(
    {"messages": [{"role": "user", "content": "ä½ å¥½"}]},
    {"configurable": {"thread_id": thread_id}}
)

# æ¨¡å¼ 3ï¼šä¸šåŠ¡å®ä½“ä½œä¸º Thread IDï¼ˆè®¢å•å¯¹è¯ï¼‰
order_id = "ORDER-2024-001"
thread_id = f"order_{order_id}"

agent.invoke(
    {"messages": [{"role": "user", "content": "æŸ¥è¯¢è®¢å•çŠ¶æ€"}]},
    {"configurable": {"thread_id": thread_id}}
)

# æ¨¡å¼ 4ï¼šå¤šç§Ÿæˆ·éš”ç¦»
tenant_id = "company_A"
user_id = "user_001"
thread_id = f"{tenant_id}_{user_id}"

agent.invoke(
    {"messages": [{"role": "user", "content": "å¸®æˆ‘æŸ¥è¯¢è´¦æˆ·ä½™é¢"}]},
    {"configurable": {"thread_id": thread_id}}
)</code></pre>
                    </div>

                    <div class="info-box tip">
                        <div class="info-box-title">âœ… Thread ID è®¾è®¡å»ºè®®</div>
                        <ul>
                            <li><strong>å”¯ä¸€æ€§</strong>ï¼šç¡®ä¿æ¯ä¸ª Thread ID å…¨å±€å”¯ä¸€</li>
                            <li><strong>å¯è¯»æ€§</strong>ï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„å‘½åï¼Œæ–¹ä¾¿è°ƒè¯•å’Œè¿½è¸ª</li>
                            <li><strong>åˆ†å±‚ç»“æ„</strong>ï¼šä½¿ç”¨åˆ†éš”ç¬¦ç»„åˆå¤šä¸ªæ ‡è¯†ç¬¦ï¼ˆå¦‚ <code>tenant_user_session</code>ï¼‰</li>
                            <li><strong>å®‰å…¨æ€§</strong>ï¼šé¿å…åœ¨ Thread ID ä¸­åŒ…å«æ•æ„Ÿä¿¡æ¯</li>
                            <li><strong>é•¿åº¦é™åˆ¶</strong>ï¼šä¿æŒåˆç†é•¿åº¦ï¼ˆé€šå¸¸ &lt;128 å­—ç¬¦ï¼‰</li>
                        </ul>
                    </div>
                </section>

                <!-- è‡ªå®šä¹‰çŠ¶æ€ Schema -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ“ è‡ªå®šä¹‰çŠ¶æ€ Schema</h2>
                    <p>
                        é™¤äº†æ¶ˆæ¯å†å²ï¼Œè¿˜å¯ä»¥åœ¨çŠ¶æ€ä¸­å­˜å‚¨è‡ªå®šä¹‰æ•°æ®ã€‚
                    </p>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty advanced">ğŸ”´ é«˜çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
è‡ªå®šä¹‰çŠ¶æ€ Schema ç¤ºä¾‹
åŠŸèƒ½ï¼šåœ¨çŠ¶æ€ä¸­å­˜å‚¨ç”¨æˆ·ä¿¡æ¯å’Œåå¥½è®¾ç½®
"""
from langchain.agents import create_agent, AgentState
from langgraph.checkpoint.memory import InMemorySaver
from langchain.tools import tool, ToolRuntime

# å®šä¹‰è‡ªå®šä¹‰çŠ¶æ€ç±»å‹
class CustomAgentState(AgentState):
    user_id: str
    user_name: str
    preferences: dict
    order_history: list

# å®šä¹‰è®¿é—®çŠ¶æ€çš„å·¥å…·
@tool
def get_user_info(runtime: ToolRuntime[CustomAgentState]) -> str:
    """è·å–ç”¨æˆ·ä¿¡æ¯"""
    state = runtime.state
    user_name = state.get("user_name", "æœªçŸ¥ç”¨æˆ·")
    preferences = state.get("preferences", {})

    return f"""
    ç”¨æˆ·å§“åï¼š{user_name}
    ä¸»é¢˜åå¥½ï¼š{preferences.get('theme', 'æœªè®¾ç½®')}
    è¯­è¨€åå¥½ï¼š{preferences.get('language', 'æœªè®¾ç½®')}
    """

@tool
def get_order_history(runtime: ToolRuntime[CustomAgentState]) -> str:
    """æŸ¥è¯¢è®¢å•å†å²"""
    orders = runtime.state.get("order_history", [])
    if not orders:
        return "æš‚æ— è®¢å•è®°å½•"

    order_list = "\n".join([f"- {order}" for order in orders])
    return f"è®¢å•å†å²ï¼š\n{order_list}"

# åˆ›å»ºå¸¦è‡ªå®šä¹‰çŠ¶æ€çš„ Agent
agent = create_agent(
    model="gpt-4o",
    tools=[get_user_info, get_order_history],
    state_schema=CustomAgentState,
    checkpointer=InMemorySaver(),
)

# è°ƒç”¨æ—¶æä¾›å®Œæ•´çŠ¶æ€
result = agent.invoke(
    {
        "messages": [{"role": "user", "content": "æŸ¥è¯¢æˆ‘çš„ä¿¡æ¯"}],
        "user_id": "user_123",
        "user_name": "å¼ ä¸‰",
        "preferences": {
            "theme": "dark",
            "language": "zh-CN"
        },
        "order_history": [
            "è®¢å•#001 - iPhone 15",
            "è®¢å•#002 - MacBook Pro"
        ]
    },
    {"configurable": {"thread_id": "user_123"}}
)

print(result["messages"][-1].content)</code></pre>
                    </div>

                    <div class="info-box note">
                        <div class="info-box-title">ğŸ’¡ çŠ¶æ€å­—æ®µè®¾è®¡</div>
                        <p>
                            è‡ªå®šä¹‰çŠ¶æ€å­—æ®µä¼šè¢«æŒä¹…åŒ–åˆ° Checkpointer ä¸­ï¼Œä¸‹æ¬¡è°ƒç”¨æ—¶è‡ªåŠ¨æ¢å¤ã€‚
                            é€‚åˆå­˜å‚¨ï¼š
                        </p>
                        <ul>
                            <li>ç”¨æˆ·èº«ä»½ä¿¡æ¯</li>
                            <li>ä¼šè¯é…ç½®å’Œåå¥½</li>
                            <li>ä¸šåŠ¡ä¸Šä¸‹æ–‡æ•°æ®</li>
                            <li>ä¸´æ—¶è®¡ç®—ç»“æœ</li>
                        </ul>
                        <p style="margin-top: 0.5rem;">
                            <strong>æ³¨æ„</strong>ï¼šé¿å…åœ¨çŠ¶æ€ä¸­å­˜å‚¨å¤§å‹å¯¹è±¡ï¼ˆå¦‚å®Œæ•´æ–‡æ¡£ï¼‰ï¼Œ
                            åº”è¯¥å­˜å‚¨å¼•ç”¨ IDï¼ŒæŒ‰éœ€ä»æ•°æ®åº“åŠ è½½ã€‚
                        </p>
                    </div>
                </section>

                <!-- æ¶ˆæ¯ç®¡ç†ç­–ç•¥ -->
                <section class="content-section">
                    <h2 class="section-title">âœ‚ï¸ æ¶ˆæ¯ç®¡ç†ç­–ç•¥</h2>
                    <p>
                        é•¿å¯¹è¯ä¼šè¶…å‡º LLM çš„ä¸Šä¸‹æ–‡çª—å£é™åˆ¶ï¼Œéœ€è¦å®æ–½æ¶ˆæ¯ç®¡ç†ç­–ç•¥ã€‚
                    </p>

                    <h3 class="subsection-title">1. æ¶ˆæ¯ä¿®å‰ªï¼ˆTrim Messagesï¼‰</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
æ¶ˆæ¯ä¿®å‰ªä¸­é—´ä»¶
åŠŸèƒ½ï¼šä¿ç•™æœ€è¿‘çš„ N æ¡æ¶ˆæ¯ï¼Œåˆ é™¤æ—§æ¶ˆæ¯
"""
from langchain.agents.middleware import before_model
from langchain.messages import RemoveMessage
from langgraph.graph.message import REMOVE_ALL_MESSAGES
from langchain.agents import AgentState, create_agent
from langgraph.checkpoint.memory import InMemorySaver

@before_model
def trim_messages(state: AgentState, runtime) -> dict | None:
    """ä¿®å‰ªæ¶ˆæ¯ï¼šä¿ç•™ç¬¬ä¸€æ¡ + æœ€è¿‘ 3 æ¡"""
    messages = state["messages"]

    # æ¶ˆæ¯æ•°é‡å°‘äºé˜ˆå€¼ï¼Œæ— éœ€ä¿®å‰ª
    if len(messages) <= 3:
        return None

    # ä¿ç•™ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼ˆé€šå¸¸æ˜¯ SystemMessageï¼‰
    first_msg = messages[0]

    # ä¿ç•™æœ€è¿‘ 3 æ¡æ¶ˆæ¯
    recent = messages[-3:] if len(messages) % 2 == 0 else messages[-4:]

    # æ„å»ºä¿®å‰ªæŒ‡ä»¤
    return {
        "messages": [
            RemoveMessage(id=REMOVE_ALL_MESSAGES),  # åˆ é™¤æ‰€æœ‰æ¶ˆæ¯
            first_msg,                              # æ¢å¤ç¬¬ä¸€æ¡
            *recent                                 # æ¢å¤æœ€è¿‘çš„æ¶ˆæ¯
        ]
    }

# åˆ›å»ºå¸¦æ¶ˆæ¯ä¿®å‰ªçš„ Agent
agent = create_agent(
    model="gpt-4o",
    tools=[],
    middleware=[trim_messages],
    checkpointer=InMemorySaver(),
)

# æ¨¡æ‹Ÿé•¿å¯¹è¯
thread_id = "long_conversation"
for i in range(10):
    agent.invoke(
        {"messages": [{"role": "user", "content": f"æ¶ˆæ¯ {i+1}"}]},
        {"configurable": {"thread_id": thread_id}}
    )

# å†å²åªä¼šä¿ç•™æœ€è¿‘å‡ æ¡æ¶ˆæ¯</code></pre>
                    </div>

                    <h3 class="subsection-title">2. æ¶ˆæ¯åˆ é™¤ï¼ˆDelete Messagesï¼‰</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
æ¶ˆæ¯åˆ é™¤ç¤ºä¾‹
åŠŸèƒ½ï¼šæ‰‹åŠ¨åˆ é™¤ç‰¹å®šæ¶ˆæ¯
"""
from langchain.messages import RemoveMessage
from langchain.agents import create_agent
from langgraph.checkpoint.memory import InMemorySaver

agent = create_agent("gpt-4o", tools=[], checkpointer=InMemorySaver())

# ç¬¬ä¸€è½®å¯¹è¯
response1 = agent.invoke(
    {"messages": [{"role": "user", "content": "ç¬¬ä¸€æ¡æ¶ˆæ¯"}]},
    {"configurable": {"thread_id": "test"}}
)

# ç¬¬äºŒè½®å¯¹è¯
response2 = agent.invoke(
    {"messages": [{"role": "user", "content": "ç¬¬äºŒæ¡æ¶ˆæ¯"}]},
    {"configurable": {"thread_id": "test"}}
)

# è·å–å½“å‰çŠ¶æ€
state = agent.get_state({"configurable": {"thread_id": "test"}})
messages = state.values["messages"]

# åˆ é™¤å‰ä¸¤æ¡æ¶ˆæ¯
if len(messages) > 2:
    delete_result = agent.update_state(
        {"configurable": {"thread_id": "test"}},
        {"messages": [RemoveMessage(id=m.id) for m in messages[:2]]}
    )

# ç»§ç»­å¯¹è¯ï¼ˆå‰ä¸¤æ¡æ¶ˆæ¯å·²è¢«åˆ é™¤ï¼‰
response3 = agent.invoke(
    {"messages": [{"role": "user", "content": "æˆ‘ä¹‹å‰è¯´äº†ä»€ä¹ˆï¼Ÿ"}]},
    {"configurable": {"thread_id": "test"}}
)
print(response3["messages"][-1].content)  # æ¨¡å‹ä¸ä¼šè®°å¾—å‰ä¸¤æ¡</code></pre>
                    </div>

                    <h3 class="subsection-title">3. æ¶ˆæ¯æ‘˜è¦ï¼ˆSummarizationï¼‰</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty advanced">ğŸ”´ é«˜çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
æ¶ˆæ¯æ‘˜è¦ä¸­é—´ä»¶
åŠŸèƒ½ï¼šè‡ªåŠ¨æ€»ç»“æ—§æ¶ˆæ¯ï¼ŒèŠ‚çœ Token
"""
from langchain.agents.middleware import SummarizationMiddleware
from langchain.agents import create_agent
from langgraph.checkpoint.memory import InMemorySaver

agent = create_agent(
    model="gpt-4o",
    tools=[],
    middleware=[
        SummarizationMiddleware(
            model="gpt-4o-mini",          # ä½¿ç”¨è½»é‡æ¨¡å‹ç”Ÿæˆæ‘˜è¦
            trigger=("tokens", 4000),      # è¶…è¿‡ 4000 tokens è§¦å‘æ‘˜è¦
            keep=("messages", 20),         # ä¿ç•™æœ€è¿‘ 20 æ¡æ¶ˆæ¯
        )
    ],
    checkpointer=InMemorySaver(),
    system_prompt="ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„åŠ©æ‰‹ã€‚"
)

# é•¿å¯¹è¯ä¼šè‡ªåŠ¨è§¦å‘æ‘˜è¦
thread_id = "summarization_test"
for i in range(30):
    agent.invoke(
        {"messages": [{"role": "user", "content": f"è¿™æ˜¯ç¬¬ {i+1} æ¡æ¶ˆæ¯ï¼Œå†…å®¹æ˜¯..."}]},
        {"configurable": {"thread_id": thread_id}}
    )</code></pre>
                    </div>

                    <div class="info-box tip">
                        <div class="info-box-title">âœ… æ¶ˆæ¯ç®¡ç†ç­–ç•¥é€‰æ‹©</div>
                        <table style="margin-top: 0.5rem;">
                            <thead>
                                <tr>
                                    <th>ç­–ç•¥</th>
                                    <th>ä¼˜ç‚¹</th>
                                    <th>ç¼ºç‚¹</th>
                                    <th>é€‚ç”¨åœºæ™¯</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ä¿®å‰ª</td>
                                    <td>ç®€å•ã€å¿«é€Ÿ</td>
                                    <td>ä¸¢å¤±å†å²ä¿¡æ¯</td>
                                    <td>çŸ­æœŸå¯¹è¯ã€ä¸é‡è¦çš„å†å²</td>
                                </tr>
                                <tr>
                                    <td>æ‘˜è¦</td>
                                    <td>ä¿ç•™å…³é”®ä¿¡æ¯</td>
                                    <td>é¢å¤– LLM è°ƒç”¨æˆæœ¬</td>
                                    <td>é•¿æœŸå¯¹è¯ã€éœ€è¦ä¸Šä¸‹æ–‡</td>
                                </tr>
                                <tr>
                                    <td>æ··åˆ</td>
                                    <td>çµæ´»ã€å¯å®šåˆ¶</td>
                                    <td>å®ç°å¤æ‚</td>
                                    <td>ä¼ä¸šçº§åº”ç”¨</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- åœ¨å·¥å…·ä¸­è®¿é—®çŠ¶æ€ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ”§ åœ¨å·¥å…·ä¸­è®¿é—®å’Œä¿®æ”¹çŠ¶æ€</h2>

                    <h3 class="subsection-title">è¯»å–çŠ¶æ€</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
å·¥å…·è¯»å–çŠ¶æ€ç¤ºä¾‹
åŠŸèƒ½ï¼šåœ¨å·¥å…·ä¸­è®¿é—® Agent çŠ¶æ€
"""
from langchain.tools import tool, ToolRuntime
from langchain.agents import AgentState, create_agent
from langgraph.checkpoint.memory import InMemorySaver

class UserState(AgentState):
    user_id: str
    subscription_level: str

@tool
def get_user_quota(runtime: ToolRuntime[UserState]) -> str:
    """æŸ¥è¯¢ç”¨æˆ·é…é¢"""
    # è®¿é—®çŠ¶æ€
    user_id = runtime.state.get("user_id", "unknown")
    level = runtime.state.get("subscription_level", "free")

    # æ ¹æ®è®¢é˜…ç­‰çº§è¿”å›é…é¢
    quotas = {
        "free": 10,
        "basic": 100,
        "premium": 1000,
    }

    quota = quotas.get(level, 10)
    return f"ç”¨æˆ· {user_id} çš„é…é¢ï¼š{quota} æ¬¡/æœˆ"

agent = create_agent(
    model="gpt-4o",
    tools=[get_user_quota],
    state_schema=UserState,
    checkpointer=InMemorySaver(),
)

result = agent.invoke(
    {
        "messages": [{"role": "user", "content": "æŸ¥è¯¢æˆ‘çš„é…é¢"}],
        "user_id": "user_123",
        "subscription_level": "premium"
    },
    {"configurable": {"thread_id": "user_123"}}
)

print(result["messages"][-1].content)</code></pre>
                    </div>

                    <h3 class="subsection-title">ä¿®æ”¹çŠ¶æ€</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty advanced">ğŸ”´ é«˜çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
å·¥å…·ä¿®æ”¹çŠ¶æ€ç¤ºä¾‹
åŠŸèƒ½ï¼šå·¥å…·æ‰§è¡Œåæ›´æ–°çŠ¶æ€
"""
from langchain.tools import tool, ToolRuntime
from langgraph.types import Command
from langchain.messages import ToolMessage
from langchain.agents import AgentState, create_agent
from langgraph.checkpoint.memory import InMemorySaver

class OrderState(AgentState):
    current_order_id: str | None
    order_total: float

@tool
def create_order(
    items: list[str],
    runtime: ToolRuntime[OrderState]
) -> Command:
    """åˆ›å»ºè®¢å•å¹¶æ›´æ–°çŠ¶æ€"""
    # æ¨¡æ‹Ÿè®¢å•åˆ›å»º
    order_id = "ORDER-2024-001"
    total = len(items) * 99.0  # ç®€åŒ–è®¡ç®—

    # è¿”å› Command æ›´æ–°çŠ¶æ€
    return Command(
        update={
            "current_order_id": order_id,
            "order_total": total,
            "messages": [
                ToolMessage(
                    content=f"è®¢å•åˆ›å»ºæˆåŠŸï¼è®¢å•å·ï¼š{order_id}ï¼Œæ€»é‡‘é¢ï¼šÂ¥{total}",
                    tool_call_id=runtime.tool_call_id
                )
            ]
        }
    )

@tool
def get_current_order(runtime: ToolRuntime[OrderState]) -> str:
    """æŸ¥è¯¢å½“å‰è®¢å•"""
    order_id = runtime.state.get("current_order_id")
    total = runtime.state.get("order_total", 0.0)

    if not order_id:
        return "æš‚æ— è¿›è¡Œä¸­çš„è®¢å•"

    return f"å½“å‰è®¢å•ï¼š{order_id}ï¼Œé‡‘é¢ï¼šÂ¥{total}"

agent = create_agent(
    model="gpt-4o",
    tools=[create_order, get_current_order],
    state_schema=OrderState,
    checkpointer=InMemorySaver(),
)

# åˆ›å»ºè®¢å•
result1 = agent.invoke(
    {
        "messages": [{"role": "user", "content": "å¸®æˆ‘åˆ›å»ºè®¢å•ï¼Œå•†å“ï¼šiPhone, AirPods"}],
        "current_order_id": None,
        "order_total": 0.0
    },
    {"configurable": {"thread_id": "order_session_001"}}
)

# æŸ¥è¯¢è®¢å•ï¼ˆçŠ¶æ€å·²æ›´æ–°ï¼‰
result2 = agent.invoke(
    {"messages": [{"role": "user", "content": "æŸ¥è¯¢æˆ‘çš„è®¢å•"}]},
    {"configurable": {"thread_id": "order_session_001"}}
)

print(result2["messages"][-1].content)</code></pre>
                    </div>
                </section>

                <!-- å®Œæ•´ç¤ºä¾‹ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ¯ å®Œæ•´ç¤ºä¾‹ï¼šå¤šç”¨æˆ·å®¢æœç³»ç»Ÿ</h2>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty advanced">ğŸ”´ é«˜çº§ - å®Œæ•´é¡¹ç›®</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
å¤šç”¨æˆ·å®¢æœç³»ç»Ÿå®Œæ•´ç¤ºä¾‹
åŠŸèƒ½ï¼šæ¼”ç¤º Checkpointer åœ¨å®é™…åº”ç”¨ä¸­çš„ä½¿ç”¨
"""
from langchain.agents import create_agent, AgentState
from langchain.tools import tool, ToolRuntime
from langgraph.checkpoint.memory import InMemorySaver
from langgraph.types import Command
from langchain.messages import ToolMessage
from datetime import datetime

# ==================== è‡ªå®šä¹‰çŠ¶æ€ ====================

class CustomerServiceState(AgentState):
    user_id: str
    user_name: str
    issue_category: str | None
    ticket_id: str | None
    satisfaction_score: int | None

# ==================== å·¥å…·å®šä¹‰ ====================

@tool
def create_ticket(
    category: str,
    description: str,
    runtime: ToolRuntime[CustomerServiceState]
) -> Command:
    """åˆ›å»ºå®¢æœå·¥å•"""
    user_id = runtime.state.get("user_id", "unknown")
    ticket_id = f"TICKET-{datetime.now().strftime('%Y%m%d%H%M%S')}"

    return Command(
        update={
            "ticket_id": ticket_id,
            "issue_category": category,
            "messages": [
                ToolMessage(
                    content=f"å·¥å•åˆ›å»ºæˆåŠŸï¼\nå·¥å•å·ï¼š{ticket_id}\nç±»åˆ«ï¼š{category}\né—®é¢˜ï¼š{description}",
                    tool_call_id=runtime.tool_call_id
                )
            ]
        }
    )

@tool
def get_ticket_status(runtime: ToolRuntime[CustomerServiceState]) -> str:
    """æŸ¥è¯¢å·¥å•çŠ¶æ€"""
    ticket_id = runtime.state.get("ticket_id")

    if not ticket_id:
        return "æ‚¨å½“å‰æ²¡æœ‰è¿›è¡Œä¸­çš„å·¥å•"

    category = runtime.state.get("issue_category", "æœªåˆ†ç±»")
    return f"å·¥å•å·ï¼š{ticket_id}\nç±»åˆ«ï¼š{category}\nçŠ¶æ€ï¼šå¤„ç†ä¸­\né¢„è®¡è§£å†³æ—¶é—´ï¼š24 å°æ—¶å†…"

@tool
def submit_feedback(
    score: int,
    comment: str,
    runtime: ToolRuntime[CustomerServiceState]
) -> Command:
    """æäº¤æ»¡æ„åº¦è¯„åˆ†ï¼ˆ1-5 åˆ†ï¼‰"""
    if not 1 <= score <= 5:
        return Command(
            update={
                "messages": [
                    ToolMessage(
                        content="è¯„åˆ†å¿…é¡»åœ¨ 1-5 åˆ†ä¹‹é—´",
                        tool_call_id=runtime.tool_call_id
                    )
                ]
            }
        )

    return Command(
        update={
            "satisfaction_score": score,
            "messages": [
                ToolMessage(
                    content=f"æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼è¯„åˆ†ï¼š{score} åˆ†\nè¯„ä»·ï¼š{comment}",
                    tool_call_id=runtime.tool_call_id
                )
            ]
        }
    )

# ==================== åˆ›å»º Agent ====================

customer_service_agent = create_agent(
    model="gpt-4o",
    tools=[create_ticket, get_ticket_status, submit_feedback],
    state_schema=CustomerServiceState,
    checkpointer=InMemorySaver(),  # ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ PostgresSaver
    system_prompt="""ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å®¢æœåŠ©æ‰‹ã€‚

èŒè´£ï¼š
1. å¸®åŠ©ç”¨æˆ·åˆ›å»ºå’ŒæŸ¥è¯¢å·¥å•
2. æ”¶é›†ç”¨æˆ·åé¦ˆå’Œæ»¡æ„åº¦è¯„åˆ†
3. æä¾›å‹å¥½ã€ä¸“ä¸šçš„æœåŠ¡

å·¥ä½œæµç¨‹ï¼š
- äº†è§£ç”¨æˆ·é—®é¢˜ï¼Œä½¿ç”¨ create_ticket åˆ›å»ºå·¥å•
- ç”¨æˆ·æŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨ get_ticket_status æŸ¥çœ‹è¿›åº¦
- é—®é¢˜è§£å†³åï¼Œå¼•å¯¼ç”¨æˆ·ä½¿ç”¨ submit_feedback è¯„åˆ†

æ³¨æ„ï¼š
- å§‹ç»ˆä¿æŒç¤¼è²Œå’Œè€å¿ƒ
- è®°ä½ç”¨æˆ·çš„å§“åå’Œé—®é¢˜ç±»åˆ«
- æ¯ä¸ªç”¨æˆ·çš„å¯¹è¯æ˜¯ç‹¬ç«‹çš„"""
)

# ==================== æ¨¡æ‹Ÿå¤šç”¨æˆ·å¯¹è¯ ====================

def simulate_customer_conversation(user_id: str, user_name: str):
    """æ¨¡æ‹Ÿå•ä¸ªç”¨æˆ·çš„å®Œæ•´å¯¹è¯æµç¨‹"""
    thread_id = f"customer_{user_id}"
    print(f"\n{'='*60}")
    print(f"ç”¨æˆ·ï¼š{user_name} (ID: {user_id})")
    print(f"{'='*60}\n")

    # åˆå§‹çŠ¶æ€
    initial_state = {
        "user_id": user_id,
        "user_name": user_name,
        "issue_category": None,
        "ticket_id": None,
        "satisfaction_score": None
    }

    # ç¬¬ 1 è½®ï¼šæŠ¥å‘Šé—®é¢˜
    print("ğŸ‘¤ ç”¨æˆ·ï¼šæˆ‘çš„è´¦å·ç™»å½•ä¸äº†ï¼Œä¸€ç›´æ˜¾ç¤ºå¯†ç é”™è¯¯")
    response1 = customer_service_agent.invoke(
        {**initial_state, "messages": [{"role": "user", "content": "æˆ‘çš„è´¦å·ç™»å½•ä¸äº†ï¼Œä¸€ç›´æ˜¾ç¤ºå¯†ç é”™è¯¯"}]},
        {"configurable": {"thread_id": thread_id}}
    )
    print(f"ğŸ¤– å®¢æœï¼š{response1['messages'][-1].content}\n")

    # ç¬¬ 2 è½®ï¼šæŸ¥è¯¢è¿›åº¦
    print("ğŸ‘¤ ç”¨æˆ·ï¼šæˆ‘çš„å·¥å•å¤„ç†å¾—æ€ä¹ˆæ ·äº†ï¼Ÿ")
    response2 = customer_service_agent.invoke(
        {"messages": [{"role": "user", "content": "æˆ‘çš„å·¥å•å¤„ç†å¾—æ€ä¹ˆæ ·äº†ï¼Ÿ"}]},
        {"configurable": {"thread_id": thread_id}}
    )
    print(f"ğŸ¤– å®¢æœï¼š{response2['messages'][-1].content}\n")

    # ç¬¬ 3 è½®ï¼šæäº¤åé¦ˆ
    print("ğŸ‘¤ ç”¨æˆ·ï¼šé—®é¢˜å·²è§£å†³ï¼Œæˆ‘ç»™ 5 åˆ†å¥½è¯„ï¼")
    response3 = customer_service_agent.invoke(
        {"messages": [{"role": "user", "content": "é—®é¢˜å·²è§£å†³ï¼Œæˆ‘ç»™ 5 åˆ†å¥½è¯„ï¼ŒæœåŠ¡æ€åº¦å¾ˆæ£’ï¼"}]},
        {"configurable": {"thread_id": thread_id}}
    )
    print(f"ğŸ¤– å®¢æœï¼š{response3['messages'][-1].content}\n")

# ==================== æµ‹è¯• ====================

if __name__ == "__main__":
    # æ¨¡æ‹Ÿå¤šä¸ªç”¨æˆ·çš„ç‹¬ç«‹å¯¹è¯ï¼ˆå®Œå…¨éš”ç¦»ï¼‰
    simulate_customer_conversation("user_001", "å¼ ä¸‰")
    simulate_customer_conversation("user_002", "æå››")
    simulate_customer_conversation("user_003", "ç‹äº”")

    print("\n" + "="*60)
    print("å¤šç”¨æˆ·å¯¹è¯å®Œæˆï¼æ¯ä¸ªç”¨æˆ·çš„çŠ¶æ€å®Œå…¨éš”ç¦»ã€‚")
    print("="*60)</code></pre>
                    </div>
                </section>

                <!-- å¸¸è§é—®é¢˜ -->
                <section class="content-section">
                    <h2 class="section-title">â“ å¸¸è§é—®é¢˜</h2>

                    <h3 class="subsection-subtitle">Q1: Checkpointer ä¼šè‡ªåŠ¨å¤„ç†æ¶ˆæ¯é™åˆ¶å—ï¼Ÿ</h3>
                    <p>
                        <strong>ä¸ä¼š</strong>ã€‚Checkpointer åªè´Ÿè´£æŒä¹…åŒ–çŠ¶æ€ï¼Œä¸ä¼šè‡ªåŠ¨ä¿®å‰ªæ¶ˆæ¯ã€‚
                        ä½ éœ€è¦ä½¿ç”¨ä¸­é—´ä»¶ï¼ˆå¦‚ <code>SummarizationMiddleware</code> æˆ–è‡ªå®šä¹‰ <code>@before_model</code> é’©å­ï¼‰
                        æ¥ç®¡ç†æ¶ˆæ¯å†å²ã€‚
                    </p>

                    <h3 class="subsection-subtitle">Q2: ä¸åŒ Checkpointer ä¹‹é—´å¯ä»¥è¿ç§»å—ï¼Ÿ</h3>
                    <p>
                        å¯ä»¥ï¼Œä½†éœ€è¦æ‰‹åŠ¨å¤„ç†ã€‚æ‰€æœ‰ Checkpointer éƒ½ä½¿ç”¨ç›¸åŒçš„çŠ¶æ€æ ¼å¼ï¼Œ
                        ä½ å¯ä»¥è¯»å–ä¸€ä¸ª Checkpointer çš„çŠ¶æ€å¹¶å†™å…¥å¦ä¸€ä¸ªã€‚ä¾‹å¦‚ï¼š
                    </p>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python"># ä» InMemorySaver è¿ç§»åˆ° PostgresSaver
old_checkpointer = InMemorySaver()
new_checkpointer = PostgresSaver.from_conn_string(DB_URI)

# è¯»å–æ—§çŠ¶æ€
state = old_checkpointer.get({"configurable": {"thread_id": "thread_001"}})

# å†™å…¥æ–° Checkpointer
new_checkpointer.put(
    {"configurable": {"thread_id": "thread_001"}},
    state.checkpoint,
    state.metadata
)</code></pre>
                    </div>

                    <h3 class="subsection-subtitle">Q3: Thread ID å¯ä»¥ä¿®æ”¹å—ï¼Ÿ</h3>
                    <p>
                        Thread ID åœ¨ Checkpointer ä¸­æ˜¯ä¸å¯å˜çš„ã€‚å¦‚æœéœ€è¦"åˆå¹¶"å¯¹è¯ï¼Œ
                        ä½ éœ€è¦åˆ›å»ºæ–°çš„ Thread IDï¼Œå¹¶æ‰‹åŠ¨å°†æ—§å¯¹è¯çš„æ¶ˆæ¯å¤åˆ¶è¿‡å»ã€‚
                    </p>

                    <h3 class="subsection-subtitle">Q4: Checkpointer çš„æ€§èƒ½å¦‚ä½•ï¼Ÿ</h3>
                    <p>
                        æ€§èƒ½å–å†³äºåç«¯å­˜å‚¨ï¼š
                    </p>
                    <ul>
                        <li><strong>InMemorySaver</strong>ï¼šæå¿«ï¼Œä½†ä¸æŒä¹…åŒ–</li>
                        <li><strong>SqliteSaver</strong>ï¼šä¸­ç­‰ï¼Œé€‚åˆå°å‹åº”ç”¨</li>
                        <li><strong>PostgresSaver</strong>ï¼šå–å†³äºæ•°æ®åº“é…ç½®ï¼Œç”Ÿäº§çº§åº”ç”¨éœ€è¦ç´¢å¼•ä¼˜åŒ–</li>
                    </ul>
                    <p>
                        å»ºè®®ä¸º <code>thread_id</code> å’Œ <code>checkpoint_id</code> åˆ›å»ºç´¢å¼•ä»¥æå‡æŸ¥è¯¢æ€§èƒ½ã€‚
                    </p>

                    <h3 class="subsection-subtitle">Q5: å¦‚ä½•æ¸…ç†æ—§çš„å¯¹è¯å†å²ï¼Ÿ</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python"># ä½¿ç”¨ PostgresSaver å®šæœŸæ¸…ç†æ—§æ•°æ®
import psycopg2
from datetime import datetime, timedelta

# åˆ é™¤ 30 å¤©å‰çš„æ£€æŸ¥ç‚¹
conn = psycopg2.connect(DB_URI)
cursor = conn.cursor()

cutoff_date = datetime.now() - timedelta(days=30)
cursor.execute("""
    DELETE FROM checkpoints
    WHERE created_at < %s
""", (cutoff_date,))

conn.commit()
cursor.close()
conn.close()</code></pre>
                    </div>
                </section>

                <!-- æœ€ä½³å®è·µ -->
                <section class="content-section">
                    <h2 class="section-title">âœ¨ æœ€ä½³å®è·µ</h2>

                    <h3 class="subsection-title">1. é€‰æ‹©åˆé€‚çš„ Checkpointer</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ç¯å¢ƒ</th>
                                <th>æ¨èæ–¹æ¡ˆ</th>
                                <th>ç†ç”±</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>æœ¬åœ°å¼€å‘</td>
                                <td>InMemorySaver</td>
                                <td>å¿«é€Ÿè¿­ä»£ï¼Œæ— éœ€é…ç½®</td>
                            </tr>
                            <tr>
                                <td>æµ‹è¯•ç¯å¢ƒ</td>
                                <td>SqliteSaver</td>
                                <td>æŒä¹…åŒ–ï¼Œä¾¿äºè°ƒè¯•</td>
                            </tr>
                            <tr>
                                <td>ç”Ÿäº§ç¯å¢ƒ</td>
                                <td>PostgresSaver</td>
                                <td>é«˜å¯ç”¨ã€å¯æ‰©å±•</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 class="subsection-title">2. Thread ID å‘½åè§„èŒƒ</h3>
                    <ul>
                        <li><strong>ç”¨æˆ·ä¼šè¯</strong>ï¼š<code>user_{user_id}_{session_id}</code></li>
                        <li><strong>ä¸šåŠ¡å®ä½“</strong>ï¼š<code>{entity_type}_{entity_id}</code></li>
                        <li><strong>å¤šç§Ÿæˆ·</strong>ï¼š<code>{tenant_id}_{user_id}</code></li>
                        <li><strong>ä¸´æ—¶ä¼šè¯</strong>ï¼š<code>temp_{uuid}</code></li>
                    </ul>

                    <h3 class="subsection-title">3. æ¶ˆæ¯ç®¡ç†ç­–ç•¥</h3>
                    <ul>
                        <li>å¯¹è¯ &lt; 10 è½®ï¼šæ— éœ€ç‰¹æ®Šå¤„ç†</li>
                        <li>å¯¹è¯ 10-50 è½®ï¼šä½¿ç”¨æ¶ˆæ¯ä¿®å‰ª</li>
                        <li>å¯¹è¯ &gt; 50 è½®ï¼šä½¿ç”¨æ¶ˆæ¯æ‘˜è¦</li>
                        <li>å…³é”®ä¸šåŠ¡å¯¹è¯ï¼šåŒæ—¶ä¿ç•™åŸå§‹å†å²åˆ°å¤–éƒ¨å­˜å‚¨</li>
                    </ul>

                    <h3 class="subsection-title">4. çŠ¶æ€è®¾è®¡åŸåˆ™</h3>
                    <ul>
                        <li><strong>æœ€å°åŒ–</strong>ï¼šåªå­˜å‚¨å¿…è¦çš„ä¿¡æ¯</li>
                        <li><strong>å¼•ç”¨ä¼˜å…ˆ</strong>ï¼šå­˜å‚¨ ID è€Œéå®Œæ•´å¯¹è±¡</li>
                        <li><strong>å¯åºåˆ—åŒ–</strong>ï¼šç¡®ä¿æ‰€æœ‰å­—æ®µå¯ä»¥ JSON åºåˆ—åŒ–</li>
                        <li><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼šè€ƒè™‘çŠ¶æ€ Schema çš„æ¼”è¿›</li>
                    </ul>

                    <h3 class="subsection-title">5. ç›‘æ§å’Œæ—¥å¿—</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python"># ç›‘æ§ Checkpointer ä½¿ç”¨æƒ…å†µ
from langchain.agents.middleware import after_agent
import logging

logger = logging.getLogger(__name__)

@after_agent
def log_checkpoint_stats(state, runtime):
    """è®°å½•æ£€æŸ¥ç‚¹ç»Ÿè®¡ä¿¡æ¯"""
    message_count = len(state["messages"])
    thread_id = runtime.config.get("configurable", {}).get("thread_id")

    logger.info(f"Thread {thread_id}: {message_count} messages saved")

    # è­¦å‘Šï¼šæ¶ˆæ¯æ•°é‡è¿‡å¤š
    if message_count > 100:
        logger.warning(f"Thread {thread_id} has {message_count} messages - consider cleanup")

    return None</code></pre>
                    </div>
                </section>

                <!-- å‚è€ƒèµ„æº -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ“– å‚è€ƒèµ„æº</h2>
                    <ul>
                        <li>
                            <a href="https://docs.langchain.com/oss/python/langchain/short-term-memory" target="_blank">
                                LangChain å®˜æ–¹ Short-term Memory æ–‡æ¡£
                            </a>
                        </li>
                        <li>
                            <a href="https://langchain-ai.github.io/langgraph/concepts/persistence/" target="_blank">
                                LangGraph Persistence æ–‡æ¡£
                            </a>
                        </li>
                        <li>
                            <a href="https://langchain-ai.github.io/langgraph/reference/checkpoints/" target="_blank">
                                Checkpointer API å‚è€ƒ
                            </a>
                        </li>
                        <li>
                            <a href="https://docs.langchain.com/oss/python/langchain/middleware/built-in#summarizationmiddleware" target="_blank">
                                SummarizationMiddleware æ–‡æ¡£
                            </a>
                        </li>
                    </ul>
                </section>

                <!-- é¡µé¢å¯¼èˆª -->
                                <nav class="page-navigation">
                    <a href="10-runtime.html" class="nav-button prev">
                        â† ä¸Šä¸€é¡µ:Runtime ç³»ç»Ÿ
                    </a>
                    <a href="12-streaming.html" class="nav-button next">
                        ä¸‹ä¸€é¡µ:æµå¼è¾“å‡º â†’
                    </a>
                </nav>
            </div>
        </main>
    </div>

    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button class="back-to-top" aria-label="è¿”å›é¡¶éƒ¨">â†‘</button>

    <!-- JavaScript -->
    <script src="assets/js/mermaid-init.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</body>
</html>
