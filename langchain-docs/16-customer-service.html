<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="LangChain 1.0 æ ¸å¿ƒæ¶æ„ - æ·±å…¥ç†è§£ LangChain çš„è®¾è®¡å“²å­¦å’Œæ¨¡å—ç»„ç»‡">
    <title>æ ¸å¿ƒæ¶æ„ | LangChain 1.0 Python çŸ¥è¯†æ–‡æ¡£</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <button class="mobile-menu-button" aria-label="æ‰“å¼€èœå•">â˜°</button>

    <div class="container">
        <!-- ä¾§è¾¹æ å¯¼èˆª -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1 class="sidebar-title">ğŸ¦œ LangChain 1.0</h1>
                <p class="sidebar-subtitle">Python å®Œæ•´å­¦ä¹ æŒ‡å—</p>
            </div>

            <ul class="nav-menu">
                <li class="nav-section">
                    <div class="nav-section-title">å¼€å§‹</div>
                    <ul>
                        <li class="nav-item">
                            <a href="index.html" class="nav-link">
                                <span class="nav-icon">ğŸ </span>
                                ä¸»é¡µ
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">åŸºç¡€ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="01-introduction.html" class="nav-link">
                                <span class="nav-icon">ğŸ“–</span>
                                LangChain ç®€ä»‹
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="02-architecture.html" class="nav-link">
                                <span class="nav-icon">ğŸ—ï¸</span>
                                æ ¸å¿ƒæ¶æ„
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="03-models.html" class="nav-link">
                                <span class="nav-icon">ğŸ¤–</span>
                                æ¨¡å‹æ¥å£
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="04-messages.html" class="nav-link">
                                <span class="nav-icon">ğŸ’¬</span>
                                æ¶ˆæ¯ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="05-tools.html" class="nav-link">
                                <span class="nav-icon">ğŸ”§</span>
                                å·¥å…·ç³»ç»Ÿ
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">è¿›é˜¶ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="06-agents.html" class="nav-link">
                                <span class="nav-icon">ğŸ¯</span>
                                Agent åŸºç¡€
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="07-middleware.html" class="nav-link">
                                <span class="nav-icon">âš™ï¸</span>
                                ä¸­é—´ä»¶ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="08-rag.html" class="nav-link">
                                <span class="nav-icon">ğŸ”</span>
                                RAG è¯¦è§£
                                <span class="nav-badge">é‡ç‚¹</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="09-lcel.html" class="nav-link">
                                <span class="nav-icon">ğŸ”—</span>
                                LCEL è¡¨è¾¾å¼
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">é«˜çº§åº”ç”¨</div>
                    <ul>
                        <li class="nav-item">
                            <a href="10-runtime.html" class="nav-link">
                                <span class="nav-icon">ğŸ”Œ</span>
                                Runtime ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="11-checkpointer.html" class="nav-link">
                                <span class="nav-icon">ğŸ’¾</span>
                                æŒä¹…åŒ–ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="12-streaming.html" class="nav-link">
                                <span class="nav-icon">ğŸŒŠ</span>
                                æµå¼è¾“å‡º
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="13-human-in-loop.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¤</span>
                                äººå·¥ä»‹å…¥
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="14-long-term-memory.html" class="nav-link">
                                <span class="nav-icon">ğŸ—„ï¸</span>
                                é•¿æœŸè®°å¿†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="15-langgraph.html" class="nav-link">
                                <span class="nav-icon">ğŸ“Š</span>
                                LangGraph
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">å®æˆ˜ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="16-customer-service.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¥</span>
                                å®¢æœæœºå™¨äºº
                                <span class="nav-badge">é‡ç‚¹</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="17-best-practices.html" class="nav-link">
                                <span class="nav-icon">âœ¨</span>
                                æœ€ä½³å®è·µ
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">å‚è€ƒç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="18-api-reference.html" class="nav-link">
                                <span class="nav-icon">ğŸ“š</span>
                                API é€ŸæŸ¥è¡¨
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="19-troubleshooting.html" class="nav-link">
                                <span class="nav-icon">ğŸ›</span>
                                æ•…éšœæ’é™¤
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="20-migration.html" class="nav-link">
                                <span class="nav-icon">ğŸ”„</span>
                                è¿ç§»æŒ‡å—
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">æ‰©å±•ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="21-structured-output.html" class="nav-link">
                                <span class="nav-icon">ğŸ“Š</span>
                                ç»“æ„åŒ–è¾“å‡º
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">DeepAgents ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="22-deepagents-quickstart.html" class="nav-link">
                                <span class="nav-icon">ğŸš€</span>
                                å¿«é€Ÿå¼€å§‹
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="23-deepagents-customization.html" class="nav-link">
                                <span class="nav-icon">ğŸ¨</span>
                                å®šåˆ¶åŒ–
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="24-deepagents-harness.html" class="nav-link">
                                <span class="nav-icon">ğŸ›ï¸</span>
                                Harness ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="25-deepagents-backends.html" class="nav-link">
                                <span class="nav-icon">ğŸ”§</span>
                                åç«¯é…ç½®
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="26-deepagents-subagents.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¥</span>
                                å­ä»£ç†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="27-deepagents-hitl.html" class="nav-link">
                                <span class="nav-icon">ğŸ¤</span>
                                äººå·¥ä»‹å…¥
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="28-deepagents-memory.html" class="nav-link">
                                <span class="nav-icon">ğŸ§ </span>
                                é•¿æœŸè®°å¿†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="29-deepagents-middleware.html" class="nav-link">
                                <span class="nav-icon">âš™ï¸</span>
                                ä¸­é—´ä»¶
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">Multi-Agent ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="30-multi-agent-index.html" class="nav-link">
                                <span class="nav-icon">ğŸŒ</span>
                                æ¦‚è¿°
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="31-multi-agent-subagents.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¥</span>
                                å­ä»£ç†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="32-multi-agent-handoffs.html" class="nav-link">
                                <span class="nav-icon">ğŸ”„</span>
                                äº¤æ¥æœºåˆ¶
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="33-multi-agent-skills.html" class="nav-link">
                                <span class="nav-icon">ğŸ¯</span>
                                æŠ€èƒ½ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="34-multi-agent-router.html" class="nav-link">
                                <span class="nav-icon">ğŸ§­</span>
                                è·¯ç”±æœºåˆ¶
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="35-multi-agent-workflow.html" class="nav-link">
                                <span class="nav-icon">ğŸ”€</span>
                                è‡ªå®šä¹‰å·¥ä½œæµ
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <div class="content-wrapper">
                <!-- é¢åŒ…å±‘å¯¼èˆª -->
                <nav class="breadcrumb">
                    <span class="breadcrumb-item">
                        <a href="index.html" class="breadcrumb-link">ä¸»é¡µ</a>
                    </span>
                    <span class="breadcrumb-item">
                        å®æˆ˜ç¯‡
                    </span>
                    <span class="breadcrumb-item">
                        å®¢æœæœºå™¨äººå®æˆ˜
                    </span>
                </nav>

                <!-- é¡µé¢æ ‡é¢˜ -->
                <header class="page-header">
                    <h1 class="page-title">ğŸ‘¥ å®¢æœæœºå™¨äººå®æˆ˜é¡¹ç›®</h1>
                    <p class="page-subtitle">
                        é€šè¿‡å®Œæ•´çš„ç”µå•†å®¢æœç³»ç»Ÿï¼Œç»¼åˆè¿ç”¨ RAGã€å·¥å…·è°ƒç”¨ã€å¯¹è¯ç®¡ç†ã€
                        æµå¼è¾“å‡ºã€äººå·¥ä»‹å…¥å’Œé•¿æœŸè®°å¿†ç­‰æŠ€æœ¯ï¼Œæ„å»ºç”Ÿäº§çº§ AI å®¢æœæœºå™¨äººã€‚
                    </p>
                </header>

                <!-- é¡¹ç›®ç®€ä»‹ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ“š é¡¹ç›®æ¦‚è¿°</h2>
                    <p>
                        æœ¬é¡¹ç›®å°†æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„<strong>ç”µå•†æ™ºèƒ½å®¢æœç³»ç»Ÿ</strong>ï¼Œ
                        æ•´åˆå‰é¢æ‰€æœ‰ç« èŠ‚å­¦åˆ°çš„æŠ€æœ¯ï¼Œå®ç°ä¸€ä¸ªå¯ä»¥ç›´æ¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒçš„å®¢æœæœºå™¨äººã€‚
                    </p>

                    <div class="info-box note">
                        <div class="info-box-title">ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½</div>
                        <table style="margin-top: 0.5rem;">
                            <thead>
                                <tr>
                                    <th>åŠŸèƒ½æ¨¡å—</th>
                                    <th>æŠ€æœ¯æ–¹æ¡ˆ</th>
                                    <th>åº”ç”¨ç« èŠ‚</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>FAQ æ™ºèƒ½é—®ç­”</strong></td>
                                    <td>åŸºäº RAG çš„è¯­ä¹‰æ£€ç´¢</td>
                                    <td>08-rag.html</td>
                                </tr>
                                <tr>
                                    <td><strong>è®¢å•æŸ¥è¯¢å’Œç®¡ç†</strong></td>
                                    <td>è‡ªå®šä¹‰å·¥å…·é›†æˆ</td>
                                    <td>05-tools.html</td>
                                </tr>
                                <tr>
                                    <td><strong>å¤šè½®å¯¹è¯</strong></td>
                                    <td>Checkpointer çŠ¶æ€ç®¡ç†</td>
                                    <td>11-checkpointer.html</td>
                                </tr>
                                <tr>
                                    <td><strong>ç”¨æˆ·åå¥½è®°å¿†</strong></td>
                                    <td>Store é•¿æœŸå­˜å‚¨</td>
                                    <td>14-long-term-memory.html</td>
                                </tr>
                                <tr>
                                    <td><strong>å®æ—¶å“åº”</strong></td>
                                    <td>æµå¼è¾“å‡º</td>
                                    <td>12-streaming.html</td>
                                </tr>
                                <tr>
                                    <td><strong>æ•æ„Ÿæ“ä½œå®¡æ ¸</strong></td>
                                    <td>Human-in-the-Loop</td>
                                    <td>13-human-in-loop.html</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3 class="subsection-title">ä¸šåŠ¡åœºæ™¯</h3>
                    <p>
                        <strong>åœºæ™¯èƒŒæ™¯</strong>ï¼šæŸç”µå•†å¹³å°æ¯å¤©æ¥æ”¶å¤§é‡å®¢æˆ·å’¨è¯¢ï¼ŒåŒ…æ‹¬ï¼š
                    </p>
                    <ul>
                        <li><strong>å¸¸è§é—®é¢˜</strong>ï¼šé…é€æ—¶é—´ã€é€€æ¢è´§æ”¿ç­–ã€æ”¯ä»˜æ–¹å¼ç­‰ï¼ˆå  60%ï¼‰</li>
                        <li><strong>è®¢å•æŸ¥è¯¢</strong>ï¼šè®¢å•çŠ¶æ€ã€ç‰©æµä¿¡æ¯ã€é€€æ¬¾è¿›åº¦ç­‰ï¼ˆå  30%ï¼‰</li>
                        <li><strong>å”®åæœåŠ¡</strong>ï¼šé€€è´§ç”³è¯·ã€æ¢è´§å¤„ç†ã€æŠ•è¯‰å»ºè®®ç­‰ï¼ˆå  10%ï¼‰</li>
                    </ul>

                    <p>
                        <strong>ç›®æ ‡</strong>ï¼šä½¿ç”¨ AI å®¢æœæœºå™¨äººè‡ªåŠ¨å¤„ç† 80% ä»¥ä¸Šçš„å’¨è¯¢ï¼Œ
                        å¤æ‚é—®é¢˜è½¬äººå·¥å¤„ç†ï¼Œæå‡æ•ˆç‡å¹¶ä¿æŒæœåŠ¡è´¨é‡ã€‚
                    </p>
                </section>

                <!-- ç³»ç»Ÿæ¶æ„ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡</h2>

                    <div class="mermaid-wrapper">
                        <div class="mermaid">
graph TB
    User[ç”¨æˆ·å’¨è¯¢] --> Agent[æ™ºèƒ½å®¢æœ Agent]

    Agent --> FAQ{FAQ é—®é¢˜ï¼Ÿ}
    Agent --> Order{è®¢å•æŸ¥è¯¢ï¼Ÿ}
    Agent --> Service{å”®åæœåŠ¡ï¼Ÿ}

    FAQ -->|æ˜¯| RAG[RAG æ£€ç´¢å·¥å…·]
    RAG --> VectorDB[(å‘é‡æ•°æ®åº“<br/>FAQ çŸ¥è¯†åº“)]
    RAG --> Answer1[ç”Ÿæˆç­”æ¡ˆ]

    Order -->|æ˜¯| OrderTools[è®¢å•å·¥å…·é›†]
    OrderTools --> OrderDB[(è®¢å•æ•°æ®åº“)]
    OrderTools --> Answer2[è¿”å›è®¢å•ä¿¡æ¯]

    Service -->|æ˜¯| ServiceTools[å”®åå·¥å…·é›†]
    ServiceTools --> HITL{éœ€è¦å®¡æ ¸ï¼Ÿ}
    HITL -->|æ˜¯| Human[äººå·¥å®¡æ ¸]
    HITL -->|å¦| Execute[æ‰§è¡Œæ“ä½œ]
    Human --> Execute
    Execute --> Answer3[è¿”å›å¤„ç†ç»“æœ]

    Answer1 --> Stream[æµå¼è¾“å‡º]
    Answer2 --> Stream
    Answer3 --> Stream

    Stream --> Memory[å¯¹è¯è®°å¿†]
    Memory --> Checkpointer[(Checkpointer<br/>çŸ­æœŸè®°å¿†)]
    Memory --> Store[(Store<br/>é•¿æœŸè®°å¿†)]

    Stream --> Response[å®æ—¶å“åº”ç”¨æˆ·]

    style Agent fill:#3b82f6,color:#fff
    style RAG fill:#10b981,color:#fff
    style OrderTools fill:#f59e0b,color:#fff
    style ServiceTools fill:#ef4444,color:#fff
    style HITL fill:#8b5cf6,color:#fff
    style Stream fill:#06b6d4,color:#fff
                        </div>
                    </div>

                    <h3 class="subsection-title">æ¶æ„è¯´æ˜</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ç»„ä»¶</th>
                                <th>èŒè´£</th>
                                <th>æŠ€æœ¯å®ç°</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>æ™ºèƒ½å®¢æœ Agent</strong></td>
                                <td>ç†è§£ç”¨æˆ·æ„å›¾ï¼Œè°ƒç”¨åˆé€‚çš„å·¥å…·</td>
                                <td>create_agent() + GPT-4</td>
                            </tr>
                            <tr>
                                <td><strong>RAG æ£€ç´¢å·¥å…·</strong></td>
                                <td>ä» FAQ çŸ¥è¯†åº“æ£€ç´¢ç›¸å…³ä¿¡æ¯</td>
                                <td>Chroma + OpenAI Embeddings</td>
                            </tr>
                            <tr>
                                <td><strong>è®¢å•å·¥å…·é›†</strong></td>
                                <td>æŸ¥è¯¢è®¢å•ã€ç‰©æµã€é€€æ¬¾ä¿¡æ¯</td>
                                <td>@tool è£…é¥°å™¨ + SQLite</td>
                            </tr>
                            <tr>
                                <td><strong>å”®åå·¥å…·é›†</strong></td>
                                <td>å¤„ç†é€€è´§ã€æ¢è´§ã€æŠ•è¯‰</td>
                                <td>@tool + HITL Middleware</td>
                            </tr>
                            <tr>
                                <td><strong>æµå¼è¾“å‡º</strong></td>
                                <td>å®æ—¶æ˜¾ç¤ºå“åº”è¿‡ç¨‹</td>
                                <td>stream_mode="messages"</td>
                            </tr>
                            <tr>
                                <td><strong>å¯¹è¯è®°å¿†</strong></td>
                                <td>çŸ­æœŸå¯¹è¯å†å² + é•¿æœŸç”¨æˆ·åå¥½</td>
                                <td>Checkpointer + Store</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <!-- ç¬¬ä¸€æ­¥ï¼šFAQ æ™ºèƒ½é—®ç­” -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ“– ç¬¬ä¸€æ­¥ï¼šFAQ æ™ºèƒ½é—®ç­”ï¼ˆRAGï¼‰</h2>
                    <p>
                        é¦–å…ˆå®ç°åŸºäº RAG çš„ FAQ é—®ç­”åŠŸèƒ½ï¼Œè®©æœºå™¨äººèƒ½å¤Ÿå›ç­”å¸¸è§é—®é¢˜ã€‚
                    </p>

                    <h3 class="subsection-title">FAQ æ•°æ®å‡†å¤‡</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">JSON</span>
                            <span class="code-difficulty basic">ğŸŸ¢ åŸºç¡€</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-json">// projects/customer-service-bot/data/faq.json
[
  {
    "question": "é…é€æ—¶é—´æ˜¯å¤šä¹…ï¼Ÿ",
    "answer": "ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè®¢å•åœ¨æäº¤å 1-2 ä¸ªå·¥ä½œæ—¥å†…å‘è´§ã€‚å›½å†…é…é€é€šå¸¸éœ€è¦ 3-5 ä¸ªå·¥ä½œæ—¥ï¼Œåè¿œåœ°åŒºå¯èƒ½éœ€è¦ 5-7 ä¸ªå·¥ä½œæ—¥ã€‚æ‚¨å¯ä»¥åœ¨è®¢å•è¯¦æƒ…é¡µæŸ¥çœ‹å®æ—¶ç‰©æµä¿¡æ¯ã€‚",
    "category": "é…é€"
  },
  {
    "question": "å¦‚ä½•ç”³è¯·é€€è´§ï¼Ÿ",
    "answer": "æ‚¨å¯ä»¥åœ¨è®¢å•è¯¦æƒ…é¡µç‚¹å‡»'ç”³è¯·å”®å'æŒ‰é’®ï¼Œé€‰æ‹©é€€è´§åŸå› å¹¶æäº¤ã€‚æˆ‘ä»¬ä¼šåœ¨ 1-2 ä¸ªå·¥ä½œæ—¥å†…å®¡æ ¸æ‚¨çš„ç”³è¯·ã€‚é€€è´§å•†å“éœ€ä¿æŒåŸåŒ…è£…å®Œå¥½ï¼Œæœªä½¿ç”¨ï¼Œæ”¶åˆ°é€€è´§å 3-5 ä¸ªå·¥ä½œæ—¥é€€æ¬¾ã€‚",
    "category": "å”®å"
  },
  {
    "question": "æ”¯æŒå“ªäº›æ”¯ä»˜æ–¹å¼ï¼Ÿ",
    "answer": "æˆ‘ä»¬æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼ï¼š1ï¼‰æ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜ 2ï¼‰é“¶è¡Œå¡ï¼ˆå€Ÿè®°å¡/ä¿¡ç”¨å¡ï¼‰3ï¼‰è´§åˆ°ä»˜æ¬¾ï¼ˆéƒ¨åˆ†åœ°åŒºæ”¯æŒï¼‰ã€‚æ‰€æœ‰æ”¯ä»˜æ¸ é“å‡é‡‡ç”¨åŠ å¯†æŠ€æœ¯ï¼Œä¿éšœæ‚¨çš„èµ„é‡‘å®‰å…¨ã€‚",
    "category": "æ”¯ä»˜"
  },
  {
    "question": "ä¼šå‘˜ç­‰çº§æœ‰ä»€ä¹ˆæƒç›Šï¼Ÿ",
    "answer": "æˆ‘ä»¬çš„ä¼šå‘˜ä½“ç³»åˆ†ä¸ºæ™®é€šã€é“¶å¡ã€é‡‘å¡ã€é’»çŸ³å››ä¸ªç­‰çº§ã€‚ç­‰çº§è¶Šé«˜ï¼Œäº«å—çš„æŠ˜æ‰£è¶Šå¤šï¼ˆæœ€é«˜å¯è¾¾ 9.5 æŠ˜ï¼‰ï¼Œå¹¶å¯è·å¾—ä¸“å±å®¢æœã€ä¼˜å…ˆé…é€ã€ç”Ÿæ—¥ç¤¼å“ç­‰ç‰¹æƒã€‚ä¼šå‘˜ç­‰çº§æ ¹æ®å¹´åº¦æ¶ˆè´¹é‡‘é¢è‡ªåŠ¨å‡çº§ã€‚",
    "category": "ä¼šå‘˜"
  },
  {
    "question": "å¦‚ä½•ä¿®æ”¹æ”¶è´§åœ°å€ï¼Ÿ",
    "answer": "è®¢å•æœªå‘è´§å‰ï¼Œæ‚¨å¯ä»¥åœ¨è®¢å•è¯¦æƒ…é¡µç‚¹å‡»'ä¿®æ”¹åœ°å€'è¿›è¡Œæ›´æ”¹ã€‚å¦‚æœè®¢å•å·²å‘è´§ï¼Œè¯·è”ç³»å®¢æœååŠ©ä¿®æ”¹ï¼ˆå¯èƒ½äº§ç”Ÿé¢å¤–è¿è´¹ï¼‰ã€‚å»ºè®®åœ¨ä¸ªäººä¸­å¿ƒé¢„å…ˆè®¾ç½®å¸¸ç”¨åœ°å€ï¼Œä¸‹å•æ—¶å¯å¿«é€Ÿé€‰æ‹©ã€‚",
    "category": "è®¢å•ç®¡ç†"
  }
]</code></pre>
                    </div>

                    <h3 class="subsection-title">æ„å»º FAQ æ£€ç´¢å·¥å…·</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
FAQ æ£€ç´¢å·¥å…·å®ç°
åŠŸèƒ½ï¼šåŸºäº RAG çš„è¯­ä¹‰æœç´¢
"""
from langchain_chroma import Chroma
from langchain_openai import OpenAIEmbeddings
from langchain_core.documents import Document
from langchain.tools import tool
import json

# åŠ è½½ FAQ æ•°æ®
def load_faq_data(file_path: str) -> list[Document]:
    """åŠ è½½ FAQ æ•°æ®å¹¶è½¬æ¢ä¸º Document å¯¹è±¡"""
    with open(file_path, 'r', encoding='utf-8') as f:
        faq_list = json.load(f)

    documents = []
    for item in faq_list:
        # å°†é—®é¢˜å’Œç­”æ¡ˆç»„åˆæˆæ–‡æ¡£
        content = f"é—®é¢˜ï¼š{item['question']}\nç­”æ¡ˆï¼š{item['answer']}"
        doc = Document(
            page_content=content,
            metadata={
                "category": item["category"],
                "question": item["question"]
            }
        )
        documents.append(doc)

    return documents

# åˆå§‹åŒ–å‘é‡å­˜å‚¨
embeddings = OpenAIEmbeddings(model="text-embedding-3-small")
documents = load_faq_data("data/faq.json")

vectorstore = Chroma.from_documents(
    documents=documents,
    embedding=embeddings,
    collection_name="faq_knowledge"
)

retriever = vectorstore.as_retriever(search_kwargs={"k": 2})

# å®šä¹‰ FAQ æ£€ç´¢å·¥å…·
@tool
def search_faq(query: str) -> str:
    """
    æœç´¢å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰çŸ¥è¯†åº“ã€‚

    é€‚ç”¨äºï¼š
    - é…é€æ—¶é—´ã€é€€æ¢è´§æ”¿ç­–ã€æ”¯ä»˜æ–¹å¼ç­‰å¸¸è§é—®é¢˜
    - ä¼šå‘˜æƒç›Šã€ä¼˜æƒ æ´»åŠ¨ç­‰é€šç”¨ä¿¡æ¯

    å‚æ•°ï¼š
        query: ç”¨æˆ·çš„é—®é¢˜æè¿°

    è¿”å›ï¼š
        ç›¸å…³çš„ FAQ ç­”æ¡ˆ
    """
    # æ£€ç´¢ç›¸å…³æ–‡æ¡£
    docs = retriever.invoke(query)

    if not docs:
        return "æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„å¸¸è§é—®é¢˜è§£ç­”ã€‚æ‚¨å¯ä»¥è¯¦ç»†æè¿°æ‚¨çš„é—®é¢˜ï¼Œæˆ–è€…è½¬æ¥äººå·¥å®¢æœã€‚"

    # ç»„åˆæ£€ç´¢ç»“æœ
    result = "æ ¹æ®å¸¸è§é—®é¢˜åº“ï¼Œæˆ‘æ‰¾åˆ°ä»¥ä¸‹ç›¸å…³ä¿¡æ¯ï¼š\n\n"
    for i, doc in enumerate(docs, 1):
        result += f"{i}. {doc.metadata['question']}\n"
        result += f"   {doc.page_content.split('ç­”æ¡ˆï¼š')[1]}\n\n"

    return result.strip()</code></pre>
                    </div>

                    <h3 class="subsection-title">æµ‹è¯• FAQ å·¥å…·</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty basic">ğŸŸ¢ åŸºç¡€</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
æµ‹è¯• FAQ æ£€ç´¢å·¥å…·
"""
# ç›´æ¥è°ƒç”¨å·¥å…·
result = search_faq.invoke({"query": "æˆ‘æƒ³çŸ¥é“å¤šä¹…èƒ½æ”¶åˆ°è´§"})
print(result)

# é¢„æœŸè¾“å‡ºï¼š
# æ ¹æ®å¸¸è§é—®é¢˜åº“ï¼Œæˆ‘æ‰¾åˆ°ä»¥ä¸‹ç›¸å…³ä¿¡æ¯ï¼š
#
# 1. é…é€æ—¶é—´æ˜¯å¤šä¹…ï¼Ÿ
#    ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè®¢å•åœ¨æäº¤å 1-2 ä¸ªå·¥ä½œæ—¥å†…å‘è´§...
#
# 2. å¦‚ä½•ä¿®æ”¹æ”¶è´§åœ°å€ï¼Ÿ
#    è®¢å•æœªå‘è´§å‰ï¼Œæ‚¨å¯ä»¥åœ¨è®¢å•è¯¦æƒ…é¡µç‚¹å‡»'ä¿®æ”¹åœ°å€'...</code></pre>
                    </div>
                </section>

                <!-- ç¬¬äºŒæ­¥ï¼šè®¢å•æŸ¥è¯¢å·¥å…· -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ“¦ ç¬¬äºŒæ­¥ï¼šè®¢å•æŸ¥è¯¢å’Œç®¡ç†å·¥å…·</h2>
                    <p>
                        å®ç°è®¢å•ç›¸å…³çš„å·¥å…·é›†ï¼ŒåŒ…æ‹¬æŸ¥è¯¢è®¢å•çŠ¶æ€ã€ç‰©æµä¿¡æ¯å’Œé€€æ¬¾è¿›åº¦ã€‚
                    </p>

                    <h3 class="subsection-title">æ¨¡æ‹Ÿè®¢å•æ•°æ®åº“</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty basic">ğŸŸ¢ åŸºç¡€</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
è®¢å•æ•°æ®æ¨¡æ‹Ÿï¼ˆç”Ÿäº§ç¯å¢ƒåº”è¿æ¥çœŸå®æ•°æ®åº“ï¼‰
"""
import sqlite3
from datetime import datetime, timedelta

# åˆå§‹åŒ–æ•°æ®åº“
def init_order_database():
    """åˆ›å»ºè®¢å•æ•°æ®åº“å¹¶æ’å…¥æµ‹è¯•æ•°æ®"""
    conn = sqlite3.connect("data/orders.db")
    cursor = conn.cursor()

    # åˆ›å»ºè®¢å•è¡¨
    cursor.execute("""
        CREATE TABLE IF NOT EXISTS orders (
            order_id TEXT PRIMARY KEY,
            user_id TEXT NOT NULL,
            product_name TEXT NOT NULL,
            quantity INTEGER NOT NULL,
            total_price REAL NOT NULL,
            status TEXT NOT NULL,
            shipping_address TEXT,
            tracking_number TEXT,
            created_at TEXT NOT NULL,
            updated_at TEXT NOT NULL
        )
    """)

    # æ’å…¥æµ‹è¯•æ•°æ®
    test_orders = [
        ("ORDER-2024001", "user_123", "iPhone 15 Pro", 1, 7999.0,
         "å·²å‘è´§", "åŒ—äº¬å¸‚æœé˜³åŒºxxxå°åŒº", "SF1234567890",
         (datetime.now() - timedelta(days=3)).isoformat(),
         (datetime.now() - timedelta(days=1)).isoformat()),

        ("ORDER-2024002", "user_123", "AirPods Pro 2", 1, 1899.0,
         "é…é€ä¸­", "åŒ—äº¬å¸‚æœé˜³åŒºxxxå°åŒº", "SF0987654321",
         (datetime.now() - timedelta(days=2)).isoformat(),
         datetime.now().isoformat()),

        ("ORDER-2024003", "user_123", "MacBook Pro 14", 1, 14999.0,
         "å¤„ç†ä¸­", "åŒ—äº¬å¸‚æœé˜³åŒºxxxå°åŒº", None,
         (datetime.now() - timedelta(hours=6)).isoformat(),
         (datetime.now() - timedelta(hours=6)).isoformat()),
    ]

    cursor.executemany("""
        INSERT OR REPLACE INTO orders VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    """, test_orders)

    conn.commit()
    conn.close()
    print("è®¢å•æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ")

# æ‰§è¡Œåˆå§‹åŒ–
init_order_database()</code></pre>
                    </div>

                    <h3 class="subsection-title">è®¢å•æŸ¥è¯¢å·¥å…·é›†</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
è®¢å•æŸ¥è¯¢å·¥å…·é›†
åŠŸèƒ½ï¼šæŸ¥è¯¢è®¢å•çŠ¶æ€ã€ç‰©æµä¿¡æ¯
"""
from langchain.tools import tool
from langchain.tools import ToolRuntime
from typing_extensions import TypedDict
import sqlite3

# å®šä¹‰ä¸Šä¸‹æ–‡ Schema
class CustomerContext(TypedDict):
    user_id: str
    session_id: str

@tool
def get_my_orders(runtime: ToolRuntime[CustomerContext]) -> str:
    """
    æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„æ‰€æœ‰è®¢å•ã€‚

    è¿”å›ï¼š
        è®¢å•åˆ—è¡¨ï¼ŒåŒ…æ‹¬è®¢å•å·ã€å•†å“åç§°ã€çŠ¶æ€ç­‰ä¿¡æ¯
    """
    user_id = runtime.context["user_id"]

    conn = sqlite3.connect("data/orders.db")
    cursor = conn.cursor()

    cursor.execute("""
        SELECT order_id, product_name, quantity, total_price, status, created_at
        FROM orders
        WHERE user_id = ?
        ORDER BY created_at DESC
    """, (user_id,))

    orders = cursor.fetchall()
    conn.close()

    if not orders:
        return "æ‚¨ç›®å‰æ²¡æœ‰ä»»ä½•è®¢å•è®°å½•ã€‚"

    result = f"æ‚¨å…±æœ‰ {len(orders)} ä¸ªè®¢å•ï¼š\n\n"
    for order in orders:
        order_id, product, qty, price, status, created = order
        result += f"ğŸ“¦ è®¢å•å·ï¼š{order_id}\n"
        result += f"   å•†å“ï¼š{product} x{qty}\n"
        result += f"   é‡‘é¢ï¼šÂ¥{price:.2f}\n"
        result += f"   çŠ¶æ€ï¼š{status}\n"
        result += f"   ä¸‹å•æ—¶é—´ï¼š{created[:10]}\n\n"

    return result.strip()

@tool
def get_order_details(order_id: str, runtime: ToolRuntime[CustomerContext]) -> str:
    """
    æŸ¥è¯¢ç‰¹å®šè®¢å•çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç‰©æµä¿¡æ¯ã€‚

    å‚æ•°ï¼š
        order_id: è®¢å•å·ï¼ˆä¾‹å¦‚ï¼šORDER-2024001ï¼‰

    è¿”å›ï¼š
        è®¢å•è¯¦ç»†ä¿¡æ¯å’Œç‰©æµçŠ¶æ€
    """
    user_id = runtime.context["user_id"]

    conn = sqlite3.connect("data/orders.db")
    cursor = conn.cursor()

    cursor.execute("""
        SELECT * FROM orders
        WHERE order_id = ? AND user_id = ?
    """, (order_id, user_id))

    order = cursor.fetchone()
    conn.close()

    if not order:
        return f"æœªæ‰¾åˆ°è®¢å• {order_id}ï¼Œè¯·æ£€æŸ¥è®¢å•å·æ˜¯å¦æ­£ç¡®ã€‚"

    _, _, product, qty, price, status, address, tracking, created, updated = order

    result = f"ğŸ“¦ è®¢å•è¯¦æƒ…\n\n"
    result += f"è®¢å•å·ï¼š{order_id}\n"
    result += f"å•†å“ï¼š{product} x{qty}\n"
    result += f"é‡‘é¢ï¼šÂ¥{price:.2f}\n"
    result += f"çŠ¶æ€ï¼š{status}\n"
    result += f"æ”¶è´§åœ°å€ï¼š{address}\n"
    result += f"ä¸‹å•æ—¶é—´ï¼š{created[:16]}\n"
    result += f"æ›´æ–°æ—¶é—´ï¼š{updated[:16]}\n"

    if tracking:
        result += f"\nğŸšš ç‰©æµä¿¡æ¯\n"
        result += f"å¿«é€’å•å·ï¼š{tracking}\n"
        result += f"ç‰©æµçŠ¶æ€ï¼š{status}\n"

        # æ¨¡æ‹Ÿç‰©æµè½¨è¿¹
        if status == "å·²å‘è´§":
            result += "æœ€æ–°è½¨è¿¹ï¼šæ‚¨çš„åŒ…è£¹å·²ä»ä»“åº“å‘å‡ºï¼Œæ­£åœ¨è¿è¾“é€”ä¸­\n"
        elif status == "é…é€ä¸­":
            result += "æœ€æ–°è½¨è¿¹ï¼šæ‚¨çš„åŒ…è£¹å·²åˆ°è¾¾åŒ—äº¬åˆ†æ‹¨ä¸­å¿ƒï¼Œå³å°†æ´¾é€\n"

    return result

@tool
def cancel_order(order_id: str, reason: str, runtime: ToolRuntime[CustomerContext]) -> str:
    """
    å–æ¶ˆè®¢å•ï¼ˆä»…é™æœªå‘è´§çš„è®¢å•ï¼‰ã€‚

    å‚æ•°ï¼š
        order_id: è®¢å•å·
        reason: å–æ¶ˆåŸå› 

    è¿”å›ï¼š
        å–æ¶ˆç»“æœ
    """
    user_id = runtime.context["user_id"]

    conn = sqlite3.connect("data/orders.db")
    cursor = conn.cursor()

    # æ£€æŸ¥è®¢å•çŠ¶æ€
    cursor.execute("""
        SELECT status FROM orders
        WHERE order_id = ? AND user_id = ?
    """, (order_id, user_id))

    result = cursor.fetchone()

    if not result:
        conn.close()
        return f"æœªæ‰¾åˆ°è®¢å• {order_id}"

    status = result[0]

    if status != "å¤„ç†ä¸­":
        conn.close()
        return f"è®¢å• {order_id} å½“å‰çŠ¶æ€ä¸º '{status}'ï¼Œæ— æ³•å–æ¶ˆã€‚å·²å‘è´§çš„è®¢å•è¯·ç”³è¯·é€€è´§ã€‚"

    # æ›´æ–°è®¢å•çŠ¶æ€
    cursor.execute("""
        UPDATE orders
        SET status = 'å·²å–æ¶ˆ', updated_at = ?
        WHERE order_id = ? AND user_id = ?
    """, (datetime.now().isoformat(), order_id, user_id))

    conn.commit()
    conn.close()

    return f"è®¢å• {order_id} å·²æˆåŠŸå–æ¶ˆã€‚å–æ¶ˆåŸå› ï¼š{reason}\né€€æ¬¾å°†åœ¨ 3-5 ä¸ªå·¥ä½œæ—¥å†…åŸè·¯é€€å›ã€‚"</code></pre>
                    </div>
                </section>

                <!-- ç¬¬ä¸‰æ­¥ï¼šå¤šè½®å¯¹è¯å’Œè®°å¿† -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ’¬ ç¬¬ä¸‰æ­¥ï¼šå¤šè½®å¯¹è¯å’Œè®°å¿†ç®¡ç†</h2>
                    <p>
                        æ•´åˆ Checkpointerï¼ˆçŸ­æœŸå¯¹è¯å†å²ï¼‰å’Œ Storeï¼ˆé•¿æœŸç”¨æˆ·åå¥½ï¼‰å®ç°æ™ºèƒ½å¯¹è¯ã€‚
                    </p>

                    <h3 class="subsection-title">ç”¨æˆ·åå¥½ç®¡ç†å·¥å…·</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
ç”¨æˆ·åå¥½ç®¡ç†ï¼ˆé•¿æœŸè®°å¿†ï¼‰
åŠŸèƒ½ï¼šè®°ä½ç”¨æˆ·çš„è¯­è¨€åå¥½ã€å¸¸ç”¨åœ°å€ç­‰ä¿¡æ¯
"""
from langchain.tools import tool, ToolRuntime
from langgraph.store.memory import InMemoryStore

# åˆå§‹åŒ– Store
store = InMemoryStore()

@tool
def save_user_preference(
    preference_type: str,
    preference_value: str,
    runtime: ToolRuntime[CustomerContext]
) -> str:
    """
    ä¿å­˜ç”¨æˆ·åå¥½è®¾ç½®ã€‚

    å‚æ•°ï¼š
        preference_type: åå¥½ç±»å‹ï¼ˆlanguage, default_address, notification ç­‰ï¼‰
        preference_value: åå¥½å€¼

    è¿”å›ï¼š
        ä¿å­˜ç»“æœ
    """
    user_id = runtime.context["user_id"]
    store_obj = runtime.store

    # è·å–ç°æœ‰åå¥½
    current_prefs = store_obj.get(("users", user_id), "preferences")

    if current_prefs:
        prefs = current_prefs.value
    else:
        prefs = {}

    # æ›´æ–°åå¥½
    prefs[preference_type] = preference_value

    # ä¿å­˜åˆ° Store
    store_obj.put(("users", user_id), "preferences", prefs)

    return f"å·²ä¿å­˜æ‚¨çš„åå¥½ï¼š{preference_type} = {preference_value}"

@tool
def get_user_preference(
    preference_type: str,
    runtime: ToolRuntime[CustomerContext]
) -> str:
    """
    è·å–ç”¨æˆ·åå¥½è®¾ç½®ã€‚

    å‚æ•°ï¼š
        preference_type: åå¥½ç±»å‹

    è¿”å›ï¼š
        åå¥½å€¼
    """
    user_id = runtime.context["user_id"]
    store_obj = runtime.store

    prefs = store_obj.get(("users", user_id), "preferences")

    if not prefs:
        return f"æœªè®¾ç½® {preference_type} åå¥½"

    value = prefs.value.get(preference_type)

    if not value:
        return f"æœªè®¾ç½® {preference_type} åå¥½"

    return f"æ‚¨çš„ {preference_type} åå¥½ä¸ºï¼š{value}"

@tool
def record_interaction_history(
    interaction_summary: str,
    runtime: ToolRuntime[CustomerContext]
) -> str:
    """
    è®°å½•é‡è¦çš„äº¤äº’å†å²ï¼ˆç”¨äºåç»­åˆ†æå’Œæ”¹è¿›æœåŠ¡ï¼‰ã€‚

    å‚æ•°ï¼š
        interaction_summary: äº¤äº’æ‘˜è¦

    è¿”å›ï¼š
        è®°å½•ç»“æœ
    """
    user_id = runtime.context["user_id"]
    store_obj = runtime.store

    # è·å–å†å²è®°å½•
    history = store_obj.get(("users", user_id, "history"), "interactions")

    if history:
        interactions = history.value
    else:
        interactions = []

    # æ·»åŠ æ–°è®°å½•
    interactions.append({
        "timestamp": datetime.now().isoformat(),
        "summary": interaction_summary
    })

    # ä¿ç•™æœ€è¿‘ 50 æ¡
    interactions = interactions[-50:]

    # ä¿å­˜
    store_obj.put(("users", user_id, "history"), "interactions", interactions)

    return "äº¤äº’å†å²å·²è®°å½•"</code></pre>
                    </div>
                </section>

                <!-- ç¬¬å››æ­¥ï¼šç³»ç»Ÿæ•´åˆ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ¯ ç¬¬å››æ­¥ï¼šå®Œæ•´ç³»ç»Ÿæ•´åˆ</h2>
                    <p>
                        å°†æ‰€æœ‰ç»„ä»¶æ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„å®¢æœæœºå™¨äººç³»ç»Ÿï¼ŒåŒ…å«æµå¼è¾“å‡ºå’Œäººå·¥ä»‹å…¥ã€‚
                    </p>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty advanced">ğŸ”´ é«˜çº§ - å®Œæ•´ç³»ç»Ÿ</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
å®Œæ•´çš„ç”µå•†å®¢æœæœºå™¨äººç³»ç»Ÿ
æ•´åˆï¼šRAG + å·¥å…· + å¯¹è¯ç®¡ç† + æµå¼è¾“å‡º + äººå·¥ä»‹å…¥ + é•¿æœŸè®°å¿†
"""
from langchain.agents import create_agent
from langchain.agents.middleware import HumanInTheLoopMiddleware
from langgraph.checkpoint.memory import InMemorySaver
from langgraph.store.memory import InMemoryStore
from typing_extensions import TypedDict
import uuid

# ==================== ä¸Šä¸‹æ–‡å®šä¹‰ ====================

class CustomerContext(TypedDict):
    user_id: str
    session_id: str

# ==================== å·¥å…·é›†åˆ ====================

# å‰é¢å®šä¹‰çš„æ‰€æœ‰å·¥å…·
all_tools = [
    # FAQ å·¥å…·
    search_faq,

    # è®¢å•å·¥å…·
    get_my_orders,
    get_order_details,
    cancel_order,

    # ç”¨æˆ·åå¥½å·¥å…·
    save_user_preference,
    get_user_preference,
    record_interaction_history,
]

# ==================== æ•æ„Ÿæ“ä½œå®¡æ ¸é…ç½® ====================

# é€€æ¬¾å’Œå–æ¶ˆè®¢å•éœ€è¦äººå·¥å®¡æ ¸
hitl_middleware = HumanInTheLoopMiddleware(
    interrupt_on={
        "cancel_order": True,  # å–æ¶ˆè®¢å•éœ€è¦å®¡æ ¸
        "search_faq": False,
        "get_my_orders": False,
        "get_order_details": False,
        "save_user_preference": False,
        "get_user_preference": False,
        "record_interaction_history": False,
    },
    description=lambda req: f"ç”¨æˆ·è¯·æ±‚ï¼š{req['name']}({req['args']})"
)

# ==================== åˆ›å»ºå®¢æœ Agent ====================

# åˆå§‹åŒ– Checkpointer å’Œ Store
checkpointer = InMemorySaver()
store = InMemoryStore()

customer_service_agent = create_agent(
    model="gpt-4o",
    tools=all_tools,
    middleware=[hitl_middleware],
    checkpointer=checkpointer,
    store=store,
    context_schema=CustomerContext,
    system_prompt="""ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç”µå•†å®¢æœåŠ©æ‰‹ã€‚

èŒè´£ï¼š
1. è§£ç­”å®¢æˆ·å…³äºé…é€ã€é€€æ¢è´§ã€æ”¯ä»˜ç­‰å¸¸è§é—®é¢˜ï¼ˆä½¿ç”¨ search_faq å·¥å…·ï¼‰
2. æŸ¥è¯¢å’Œç®¡ç†è®¢å•ä¿¡æ¯ï¼ˆä½¿ç”¨è®¢å•ç›¸å…³å·¥å…·ï¼‰
3. è®°ä½ç”¨æˆ·çš„åå¥½ï¼Œæä¾›ä¸ªæ€§åŒ–æœåŠ¡
4. å¯¹äºå¤æ‚æˆ–æ•æ„Ÿçš„é—®é¢˜ï¼ŒåŠæ—¶è½¬æ¥äººå·¥å®¢æœ

å·¥ä½œåŸåˆ™ï¼š
- å§‹ç»ˆä¿æŒç¤¼è²Œã€ä¸“ä¸šã€è€å¿ƒ
- ä¼˜å…ˆä½¿ç”¨å·¥å…·æŸ¥è¯¢å‡†ç¡®ä¿¡æ¯ï¼Œä¸è¦çŒœæµ‹
- å¯¹äºè®¢å•å–æ¶ˆã€é€€æ¬¾ç­‰æ•æ„Ÿæ“ä½œï¼Œéœ€è¦äººå·¥å®¡æ ¸
- è®°å½•é‡è¦çš„äº¤äº’å†å²ï¼Œå¸®åŠ©æ”¹è¿›æœåŠ¡
- å¦‚æœæ— æ³•è§£å†³é—®é¢˜ï¼Œä¸»åŠ¨å»ºè®®è½¬æ¥äººå·¥

å›ç­”é£æ ¼ï¼š
- ç®€æ´æ˜äº†ï¼Œé‡ç‚¹çªå‡º
- ä½¿ç”¨åˆ—è¡¨å’Œæ®µè½å¢å¼ºå¯è¯»æ€§
- æä¾›å…·ä½“çš„æ“ä½œæ­¥éª¤
"""
)

# ==================== æµå¼å¯¹è¯å¤„ç† ====================

def chat_with_customer_service(
    user_message: str,
    user_id: str = "user_123",
    thread_id: str = None
):
    """
    ä¸å®¢æœæœºå™¨äººè¿›è¡Œæµå¼å¯¹è¯

    å‚æ•°ï¼š
        user_message: ç”¨æˆ·æ¶ˆæ¯
        user_id: ç”¨æˆ· ID
        thread_id: ä¼šè¯ IDï¼ˆç”¨äºå¤šè½®å¯¹è¯ï¼‰
    """
    if thread_id is None:
        thread_id = str(uuid.uuid4())

    config = {
        "configurable": {
            "thread_id": thread_id,
        },
        "context": {
            "user_id": user_id,
            "session_id": thread_id
        }
    }

    print(f"\n{'='*60}")
    print(f"ç”¨æˆ·: {user_message}")
    print('='*60)

    # æµå¼è°ƒç”¨
    print("\nğŸ¤– å®¢æœ: ", end="", flush=True)

    full_response = ""
    interrupted = False

    for stream_mode, chunk in customer_service_agent.stream(
        {"messages": [{"role": "user", "content": user_message}]},
        config=config,
        stream_mode=["messages", "updates"]
    ):
        if stream_mode == "messages":
            token, metadata = chunk
            if token:
                print(token, end="", flush=True)
                full_response += token

        elif stream_mode == "updates":
            for step, data in chunk.items():
                if "__interrupt__" in data:
                    interrupted = True
                    print("\n\nâ¸ï¸ éœ€è¦äººå·¥å®¡æ ¸ï¼Œè¯·ç¨å€™...")

    print("\n" + "="*60)

    return {
        "thread_id": thread_id,
        "response": full_response,
        "interrupted": interrupted
    }

# ==================== æµ‹è¯•åœºæ™¯ ====================

def run_test_scenarios():
    """è¿è¡Œå¤šä¸ªæµ‹è¯•åœºæ™¯"""

    print("\n" + "ğŸ§ª å¼€å§‹æµ‹è¯•ç”µå•†å®¢æœæœºå™¨äºº".center(60, "="))

    # åœºæ™¯ 1ï¼šFAQ é—®ç­”
    print("\n\nğŸ“Œ åœºæ™¯ 1ï¼šæŸ¥è¯¢é…é€æ—¶é—´")
    result1 = chat_with_customer_service(
        "æˆ‘æƒ³çŸ¥é“è®¢å•ä¸€èˆ¬å¤šä¹…èƒ½é€åˆ°ï¼Ÿ",
        user_id="user_123"
    )
    thread_id = result1["thread_id"]

    input("\næŒ‰å›è½¦ç»§ç»­ä¸‹ä¸€ä¸ªåœºæ™¯...")

    # åœºæ™¯ 2ï¼šæŸ¥è¯¢è®¢å•ï¼ˆå¤šè½®å¯¹è¯ï¼Œä½¿ç”¨ç›¸åŒ thread_idï¼‰
    print("\n\nğŸ“Œ åœºæ™¯ 2ï¼šæŸ¥è¯¢æˆ‘çš„è®¢å•")
    result2 = chat_with_customer_service(
        "å¸®æˆ‘æŸ¥ä¸€ä¸‹æˆ‘çš„è®¢å•",
        user_id="user_123",
        thread_id=thread_id  # ç»§ç»­ä¹‹å‰çš„å¯¹è¯
    )

    input("\næŒ‰å›è½¦ç»§ç»­ä¸‹ä¸€ä¸ªåœºæ™¯...")

    # åœºæ™¯ 3ï¼šæŸ¥è¯¢ç‰¹å®šè®¢å•è¯¦æƒ…
    print("\n\nğŸ“Œ åœºæ™¯ 3ï¼šæŸ¥è¯¢è®¢å•è¯¦æƒ…")
    result3 = chat_with_customer_service(
        "å¸®æˆ‘æŸ¥ä¸€ä¸‹ ORDER-2024002 çš„ç‰©æµä¿¡æ¯",
        user_id="user_123",
        thread_id=thread_id
    )

    input("\næŒ‰å›è½¦ç»§ç»­ä¸‹ä¸€ä¸ªåœºæ™¯...")

    # åœºæ™¯ 4ï¼šå–æ¶ˆè®¢å•ï¼ˆä¼šè§¦å‘äººå·¥å®¡æ ¸ï¼‰
    print("\n\nğŸ“Œ åœºæ™¯ 4ï¼šå–æ¶ˆè®¢å•ï¼ˆè§¦å‘å®¡æ ¸ï¼‰")
    result4 = chat_with_customer_service(
        "æˆ‘æƒ³å–æ¶ˆè®¢å• ORDER-2024003ï¼Œå› ä¸ºä¹°é”™äº†",
        user_id="user_123",
        thread_id=thread_id
    )

    if result4["interrupted"]:
        print("\nğŸ’¡ æç¤ºï¼šæ­¤æ“ä½œéœ€è¦äººå·¥å®¡æ ¸")
        print("   åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå®¢æœäººå‘˜ä¼šåœ¨åå°å®¡æ ¸æ­¤è¯·æ±‚")

        # æ¨¡æ‹Ÿå®¡æ ¸é€šè¿‡
        from langgraph.types import Command
        print("\nâœ… æ¨¡æ‹Ÿå®¡æ ¸é€šè¿‡ï¼Œç»§ç»­æ‰§è¡Œ...")

        approval_result = customer_service_agent.invoke(
            Command(resume={"decisions": [{"type": "approve"}]}),
            config={
                "configurable": {"thread_id": thread_id},
                "context": {"user_id": "user_123", "session_id": thread_id}
            }
        )

        print(f"\næœ€ç»ˆç»“æœ: {approval_result['messages'][-1].content}")

    input("\næŒ‰å›è½¦ç»§ç»­ä¸‹ä¸€ä¸ªåœºæ™¯...")

    # åœºæ™¯ 5ï¼šä¿å­˜ç”¨æˆ·åå¥½
    print("\n\nğŸ“Œ åœºæ™¯ 5ï¼šä¿å­˜å¸¸ç”¨åœ°å€")
    result5 = chat_with_customer_service(
        "å¸®æˆ‘æŠŠå¸¸ç”¨åœ°å€è®¾ä¸ºï¼šåŒ—äº¬å¸‚æœé˜³åŒºxxxå°åŒº",
        user_id="user_123",
        thread_id=thread_id
    )

    print("\n\n" + "âœ… æµ‹è¯•å®Œæˆï¼".center(60, "="))
    print("\nç³»ç»Ÿæ¼”ç¤ºäº†ä»¥ä¸‹åŠŸèƒ½ï¼š")
    print("  1. âœ… FAQ æ™ºèƒ½é—®ç­”ï¼ˆRAGï¼‰")
    print("  2. âœ… è®¢å•æŸ¥è¯¢å’Œç®¡ç†")
    print("  3. âœ… å¤šè½®å¯¹è¯ï¼ˆCheckpointerï¼‰")
    print("  4. âœ… äººå·¥å®¡æ ¸ï¼ˆHITLï¼‰")
    print("  5. âœ… ç”¨æˆ·åå¥½ï¼ˆStoreï¼‰")
    print("  6. âœ… æµå¼è¾“å‡º")

# ==================== ä¸»ç¨‹åº ====================

if __name__ == "__main__":
    # åˆå§‹åŒ–æ•°æ®
    print("æ­£åœ¨åˆå§‹åŒ–ç³»ç»Ÿ...")
    init_order_database()
    print("ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼\n")

    # è¿è¡Œæµ‹è¯•åœºæ™¯
    run_test_scenarios()</code></pre>
                    </div>
                </section>

                <!-- å¯¹è¯æµç¨‹å›¾ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ”„ å®Œæ•´å¯¹è¯æµç¨‹</h2>

                    <div class="mermaid-wrapper">
                        <div class="mermaid">
sequenceDiagram
    participant U as ç”¨æˆ·
    participant A as Agent
    participant FAQ as FAQå·¥å…·
    participant Order as è®¢å•å·¥å…·
    participant HITL as äººå·¥å®¡æ ¸
    participant CP as Checkpointer
    participant ST as Store

    U->>A: é…é€æ—¶é—´æ˜¯å¤šä¹…ï¼Ÿ
    A->>FAQ: search_faq("é…é€æ—¶é—´")
    FAQ->>A: è¿”å›FAQç­”æ¡ˆ
    A->>CP: ä¿å­˜å¯¹è¯å†å²
    A->>U: æµå¼è¿”å›ç­”æ¡ˆ

    U->>A: æŸ¥è¯¢æˆ‘çš„è®¢å•
    A->>CP: åŠ è½½å¯¹è¯ä¸Šä¸‹æ–‡
    A->>Order: get_my_orders()
    Order->>A: è¿”å›è®¢å•åˆ—è¡¨
    A->>CP: æ›´æ–°å¯¹è¯å†å²
    A->>U: æµå¼è¿”å›è®¢å•ä¿¡æ¯

    U->>A: å–æ¶ˆè®¢å• ORDER-2024003
    A->>Order: cancel_order(ORDER-2024003)
    Order->>HITL: è§¦å‘å®¡æ ¸
    HITL-->>U: ç­‰å¾…äººå·¥å®¡æ ¸

    Note over HITL: å®¢æœå®¡æ ¸ä¸­...

    HITL->>Order: å®¡æ ¸é€šè¿‡ï¼Œæ‰§è¡Œå–æ¶ˆ
    Order->>A: è¿”å›å–æ¶ˆç»“æœ
    A->>CP: è®°å½•æ“ä½œ
    A->>ST: è®°å½•äº¤äº’å†å²
    A->>U: è¿”å›å–æ¶ˆç¡®è®¤

    U->>A: ä¿å­˜å¸¸ç”¨åœ°å€
    A->>ST: save_user_preference()
    ST->>A: ä¿å­˜æˆåŠŸ
    A->>U: ç¡®è®¤ä¿å­˜
                        </div>
                    </div>
                </section>

                <!-- éƒ¨ç½²å’Œä¼˜åŒ– -->
                <section class="content-section">
                    <h2 class="section-title">ğŸš€ éƒ¨ç½²å’Œä¼˜åŒ–å»ºè®®</h2>

                    <h3 class="subsection-title">ç”Ÿäº§ç¯å¢ƒé…ç½®</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty advanced">ğŸ”´ é«˜çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
ç”Ÿäº§ç¯å¢ƒé…ç½®ç¤ºä¾‹
"""
from langgraph.checkpoint.postgres import PostgresSaver
from langgraph.store.postgres import PostgresStore
import os

# æ•°æ®åº“è¿æ¥
DB_URI = os.getenv("DATABASE_URL", "postgresql://user:pass@localhost:5432/customer_service")

# ä½¿ç”¨ PostgreSQL æŒä¹…åŒ–
with PostgresSaver.from_conn_string(DB_URI) as checkpointer:
    checkpointer.setup()

    with PostgresStore.from_conn_string(DB_URI) as store:
        store.setup()

        # åˆ›å»ºç”Ÿäº§çº§ Agent
        production_agent = create_agent(
            model="gpt-4o",
            tools=all_tools,
            middleware=[
                hitl_middleware,
                # å¯æ·»åŠ æ›´å¤šä¸­é—´ä»¶ï¼šæ—¥å¿—ã€ç›‘æ§ã€é™æµç­‰
            ],
            checkpointer=checkpointer,
            store=store,
            context_schema=CustomerContext,
            system_prompt="""..."""  # ç”Ÿäº§çº§æç¤ºè¯
        )</code></pre>
                    </div>

                    <h3 class="subsection-title">æ€§èƒ½ä¼˜åŒ–æ¸…å•</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ä¼˜åŒ–é¡¹</th>
                                <th>æ–¹æ¡ˆ</th>
                                <th>é¢„æœŸæå‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>FAQ æ£€ç´¢é€Ÿåº¦</strong></td>
                                <td>ä½¿ç”¨ Redis ç¼“å­˜çƒ­é—¨é—®é¢˜</td>
                                <td>å“åº”æ—¶é—´å‡å°‘ 70%</td>
                            </tr>
                            <tr>
                                <td><strong>æ•°æ®åº“æŸ¥è¯¢</strong></td>
                                <td>æ·»åŠ ç´¢å¼•ã€ä½¿ç”¨è¿æ¥æ± </td>
                                <td>æŸ¥è¯¢é€Ÿåº¦æå‡ 3-5 å€</td>
                            </tr>
                            <tr>
                                <td><strong>å¹¶å‘å¤„ç†</strong></td>
                                <td>ä½¿ç”¨å¼‚æ­¥ Agentï¼ˆasync/awaitï¼‰</td>
                                <td>æ”¯æŒ 10x å¹¶å‘ç”¨æˆ·</td>
                            </tr>
                            <tr>
                                <td><strong>æˆæœ¬æ§åˆ¶</strong></td>
                                <td>ä½¿ç”¨æ›´å°çš„æ¨¡å‹ï¼ˆGPT-3.5ï¼‰å¤„ç†ç®€å•é—®é¢˜</td>
                                <td>æˆæœ¬é™ä½ 50%</td>
                            </tr>
                            <tr>
                                <td><strong>å“åº”é€Ÿåº¦</strong></td>
                                <td>å¯ç”¨æµå¼è¾“å‡º</td>
                                <td>é¦–å­—å»¶è¿Ÿå‡å°‘ 80%</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 class="subsection-title">ç›‘æ§æŒ‡æ ‡</h3>
                    <ul>
                        <li><strong>å“åº”æ—¶é—´</strong>ï¼šP50 < 2s, P95 < 5s</li>
                        <li><strong>FAQ å‘½ä¸­ç‡</strong>ï¼š> 60%</li>
                        <li><strong>é—®é¢˜è§£å†³ç‡</strong>ï¼š> 80%ï¼ˆæ— éœ€è½¬äººå·¥ï¼‰</li>
                        <li><strong>ç”¨æˆ·æ»¡æ„åº¦</strong>ï¼š> 4.0/5.0</li>
                        <li><strong>æ¯æ—¥æˆæœ¬</strong>ï¼š< $50ï¼ˆ1000 æ¬¡å¯¹è¯ï¼‰</li>
                    </ul>
                </section>

                <!-- å¸¸è§é—®é¢˜ -->
                <section class="content-section">
                    <h2 class="section-title">â“ å¸¸è§é—®é¢˜</h2>

                    <h3 class="subsection-subtitle">Q1: å¦‚ä½•å¤„ç†å¤šä¸ªç”¨æˆ·åŒæ—¶å¯¹è¯ï¼Ÿ</h3>
                    <p>
                        ä½¿ç”¨ä¸åŒçš„ <code>thread_id</code> åŒºåˆ†ä¸åŒç”¨æˆ·çš„ä¼šè¯ã€‚
                        æ¯ä¸ªç”¨æˆ·çš„å¯¹è¯å†å²ç‹¬ç«‹å­˜å‚¨åœ¨ Checkpointer ä¸­ã€‚
                    </p>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python"># ç”¨æˆ· A çš„ä¼šè¯
config_a = {
    "configurable": {"thread_id": "user_a_session_001"},
    "context": {"user_id": "user_a"}
}

# ç”¨æˆ· B çš„ä¼šè¯
config_b = {
    "configurable": {"thread_id": "user_b_session_002"},
    "context": {"user_id": "user_b"}
}

# ä¸¤ä¸ªç”¨æˆ·å¯ä»¥å¹¶å‘å¯¹è¯ï¼Œäº’ä¸å½±å“
agent.invoke({...}, config=config_a)
agent.invoke({...}, config=config_b)</code></pre>
                    </div>

                    <h3 class="subsection-subtitle">Q2: FAQ çŸ¥è¯†åº“å¦‚ä½•æ›´æ–°ï¼Ÿ</h3>
                    <p>
                        <strong>æ–¹æ¡ˆ 1ï¼šå®šæœŸé‡å»º</strong>
                    </p>
                    <ul>
                        <li>æ¯å¤©å‡Œæ™¨è‡ªåŠ¨ä» CMS æˆ–æ•°æ®åº“æ‹‰å–æœ€æ–° FAQ</li>
                        <li>é‡æ–°ç”Ÿæˆ embeddings å¹¶æ›´æ–°å‘é‡æ•°æ®åº“</li>
                        <li>é€‚åˆå˜åŒ–ä¸é¢‘ç¹çš„åœºæ™¯</li>
                    </ul>

                    <p>
                        <strong>æ–¹æ¡ˆ 2ï¼šå¢é‡æ›´æ–°</strong>
                    </p>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python"># æ·»åŠ æ–°çš„ FAQ
new_faq = Document(
    page_content="é—®é¢˜ï¼šxxx\nç­”æ¡ˆï¼šxxx",
    metadata={"category": "æ–°å¢"}
)

vectorstore.add_documents([new_faq])

# åˆ é™¤è¿‡æ—¶çš„ FAQ
vectorstore.delete(ids=["outdated_faq_id"])</code></pre>
                    </div>

                    <h3 class="subsection-subtitle">Q3: å¦‚ä½•é˜²æ­¢ Agent ç»™å‡ºé”™è¯¯ç­”æ¡ˆï¼Ÿ</h3>
                    <p>
                        <strong>å¤šå±‚é˜²æŠ¤ç­–ç•¥</strong>ï¼š
                    </p>
                    <ol>
                        <li><strong>æ˜ç¡®å·¥å…·è¾¹ç•Œ</strong>ï¼šåœ¨å·¥å…·çš„ docstring ä¸­è¯´æ˜é€‚ç”¨åœºæ™¯</li>
                        <li><strong>éªŒè¯å·¥å…·è¾“å…¥</strong>ï¼šåœ¨å·¥å…·å†…éƒ¨éªŒè¯å‚æ•°åˆæ³•æ€§</li>
                        <li><strong>æç¤ºè¯å¼•å¯¼</strong>ï¼šåœ¨ system_prompt ä¸­å¼ºè°ƒ"ä¼˜å…ˆä½¿ç”¨å·¥å…·ï¼Œä¸è¦çŒœæµ‹"</li>
                        <li><strong>è¾“å‡ºéªŒè¯</strong>ï¼šæ·»åŠ ä¸­é—´ä»¶æ£€æŸ¥ç­”æ¡ˆçš„åˆç†æ€§</li>
                        <li><strong>äººå·¥ç›‘ç£</strong>ï¼šå®šæœŸå®¡æŸ¥å¯¹è¯è®°å½•ï¼Œå‘ç°é—®é¢˜åŠæ—¶è°ƒæ•´</li>
                    </ol>

                    <h3 class="subsection-subtitle">Q4: å¯¹è¯å†å²ä¼šæ— é™å¢é•¿å—ï¼Ÿ</h3>
                    <p>
                        ä¸ä¼šã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ§åˆ¶ï¼š
                    </p>
                    <ul>
                        <li><strong>é™åˆ¶å†å²é•¿åº¦</strong>ï¼šåªä¿ç•™æœ€è¿‘ N è½®å¯¹è¯</li>
                        <li><strong>æ‘˜è¦å†å²</strong>ï¼šä½¿ç”¨ LLM å®šæœŸæ€»ç»“å¯¹è¯ï¼Œæ›¿æ¢è¯¦ç»†å†å²</li>
                        <li><strong>å®šæœŸæ¸…ç†</strong>ï¼šè¶…è¿‡ä¸€å®šæ—¶é—´çš„ä¼šè¯è‡ªåŠ¨å½’æ¡£</li>
                    </ul>

                    <h3 class="subsection-subtitle">Q5: å¦‚ä½•è¯„ä¼°å®¢æœæœºå™¨äººçš„æ•ˆæœï¼Ÿ</h3>
                    <p>
                        å»ºç«‹å¤šç»´åº¦è¯„ä¼°ä½“ç³»ï¼š
                    </p>
                    <table>
                        <thead>
                            <tr>
                                <th>æŒ‡æ ‡</th>
                                <th>è®¡ç®—æ–¹æ³•</th>
                                <th>ç›®æ ‡å€¼</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>é—®é¢˜è§£å†³ç‡</strong></td>
                                <td>æ— éœ€è½¬äººå·¥çš„å¯¹è¯æ•° / æ€»å¯¹è¯æ•°</td>
                                <td>> 80%</td>
                            </tr>
                            <tr>
                                <td><strong>é¦–æ¬¡å“åº”æ—¶é—´</strong></td>
                                <td>ç”¨æˆ·å‘é€æ¶ˆæ¯åˆ°æ”¶åˆ°é¦–ä¸ª Token çš„æ—¶é—´</td>
                                <td>< 1s</td>
                            </tr>
                            <tr>
                                <td><strong>å¹³å‡å¯¹è¯è½®æ¬¡</strong></td>
                                <td>è§£å†³é—®é¢˜å¹³å‡éœ€è¦çš„å¯¹è¯è½®æ•°</td>
                                <td>< 5 è½®</td>
                            </tr>
                            <tr>
                                <td><strong>ç”¨æˆ·æ»¡æ„åº¦</strong></td>
                                <td>å¯¹è¯ç»“æŸåçš„ç”¨æˆ·è¯„åˆ†</td>
                                <td>> 4.0/5.0</td>
                            </tr>
                            <tr>
                                <td><strong>ç­”æ¡ˆå‡†ç¡®ç‡</strong></td>
                                <td>äººå·¥æŠ½æŸ¥ç­”æ¡ˆçš„æ­£ç¡®ç‡</td>
                                <td>> 95%</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <!-- æœ€ä½³å®è·µ -->
                <section class="content-section">
                    <h2 class="section-title">âœ¨ æœ€ä½³å®è·µ</h2>

                    <h3 class="subsection-title">1. æç¤ºè¯è®¾è®¡</h3>
                    <ul>
                        <li><strong>æ˜ç¡®è§’è‰²å®šä½</strong>ï¼š"ä½ æ˜¯ä¸“ä¸šçš„ç”µå•†å®¢æœ"</li>
                        <li><strong>åˆ—ä¸¾èŒè´£èŒƒå›´</strong>ï¼šè§£ç­” FAQã€æŸ¥è¯¢è®¢å•ã€å¤„ç†å”®å</li>
                        <li><strong>å¼ºè°ƒå·¥å…·ä¼˜å…ˆ</strong>ï¼šä¸è¦çŒœæµ‹ï¼Œä¼˜å…ˆä½¿ç”¨å·¥å…·</li>
                        <li><strong>è®¾å®šè¡Œä¸ºå‡†åˆ™</strong>ï¼šç¤¼è²Œã€ä¸“ä¸šã€åŠæ—¶è½¬äººå·¥</li>
                        <li><strong>æä¾›ç¤ºä¾‹</strong>ï¼šå±•ç¤ºæœŸæœ›çš„å›ç­”é£æ ¼</li>
                    </ul>

                    <h3 class="subsection-title">2. å·¥å…·è®¾è®¡</h3>
                    <ul>
                        <li><strong>å•ä¸€èŒè´£</strong>ï¼šæ¯ä¸ªå·¥å…·åªåšä¸€ä»¶äº‹</li>
                        <li><strong>æ¸…æ™°çš„ docstring</strong>ï¼šè¯´æ˜åŠŸèƒ½ã€å‚æ•°ã€é€‚ç”¨åœºæ™¯</li>
                        <li><strong>é”™è¯¯å¤„ç†</strong>ï¼šè¿”å›å‹å¥½çš„é”™è¯¯æ¶ˆæ¯</li>
                        <li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šæ·»åŠ ç¼“å­˜ã€æ‰¹é‡æŸ¥è¯¢</li>
                        <li><strong>å®‰å…¨éªŒè¯</strong>ï¼šéªŒè¯ç”¨æˆ·æƒé™å’Œå‚æ•°åˆæ³•æ€§</li>
                    </ul>

                    <h3 class="subsection-title">3. å¯¹è¯ç®¡ç†</h3>
                    <ul>
                        <li><strong>åˆç†çš„ thread_id ç­–ç•¥</strong>ï¼šæ¯ä¸ªç‹¬ç«‹å’¨è¯¢ä¸€ä¸ª thread</li>
                        <li><strong>ä¸»åŠ¨ç»“æŸä¼šè¯</strong>ï¼šé—®é¢˜è§£å†³åè¯¢é—®æ˜¯å¦è¿˜éœ€å¸®åŠ©</li>
                        <li><strong>ä¸Šä¸‹æ–‡å¼•ç”¨</strong>ï¼š"æ‚¨åˆšæ‰æåˆ°çš„è®¢å•"è€Œé"è®¢å•"</li>
                        <li><strong>è®°å½•å…³é”®ä¿¡æ¯</strong>ï¼šç”¨æˆ·åå¥½ã€å¸¸è§é—®é¢˜ä¿å­˜åˆ° Store</li>
                    </ul>

                    <h3 class="subsection-title">4. ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹</h3>
                    <ul>
                        <li><strong>ä½¿ç”¨ PostgreSQL</strong>ï¼šæ›¿ä»£ InMemorySaver å’Œ InMemoryStore</li>
                        <li><strong>å¯ç”¨ç›‘æ§</strong>ï¼šé›†æˆ LangSmith è¿½è¸ªæ‰§è¡Œè¿‡ç¨‹</li>
                        <li><strong>è®¾ç½®é™æµ</strong>ï¼šé˜²æ­¢æ¶æ„è°ƒç”¨</li>
                        <li><strong>å¼‚å¸¸å‘Šè­¦</strong>ï¼šå·¥å…·å¤±è´¥ã€å“åº”è¶…æ—¶ç­‰åŠæ—¶é€šçŸ¥</li>
                        <li><strong>å®šæœŸå¤‡ä»½</strong>ï¼šå¯¹è¯å†å²å’Œç”¨æˆ·æ•°æ®</li>
                    </ul>
                </section>

                <!-- æ‰©å±•æ–¹å‘ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ”® æ‰©å±•æ–¹å‘</h2>

                    <h3 class="subsection-title">åŠŸèƒ½æ‰©å±•</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>åŠŸèƒ½</th>
                                <th>å®ç°æ€è·¯</th>
                                <th>éš¾åº¦</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>å¤šè¯­è¨€æ”¯æŒ</strong></td>
                                <td>æ£€æµ‹ç”¨æˆ·è¯­è¨€ + ç¿»è¯‘å·¥å…·</td>
                                <td>ğŸŸ¡ ä¸­çº§</td>
                            </tr>
                            <tr>
                                <td><strong>è¯­éŸ³è¾“å…¥</strong></td>
                                <td>é›†æˆ Whisper ASR</td>
                                <td>ğŸŸ¡ ä¸­çº§</td>
                            </tr>
                            <tr>
                                <td><strong>å›¾ç‰‡è¯†åˆ«</strong></td>
                                <td>ä½¿ç”¨ GPT-4V å¤„ç†äº§å“å›¾ç‰‡</td>
                                <td>ğŸ”´ é«˜çº§</td>
                            </tr>
                            <tr>
                                <td><strong>æƒ…æ„Ÿåˆ†æ</strong></td>
                                <td>æ£€æµ‹ç”¨æˆ·æƒ…ç»ªï¼Œè°ƒæ•´å›ç­”é£æ ¼</td>
                                <td>ğŸŸ¡ ä¸­çº§</td>
                            </tr>
                            <tr>
                                <td><strong>æ™ºèƒ½æ¨è</strong></td>
                                <td>åŸºäºç”¨æˆ·å†å²æ¨èå•†å“</td>
                                <td>ğŸ”´ é«˜çº§</td>
                            </tr>
                            <tr>
                                <td><strong>ä¸»åŠ¨é—®å€™</strong></td>
                                <td>è¯†åˆ«è€å®¢æˆ·ï¼Œä¸ªæ€§åŒ–é—®å€™</td>
                                <td>ğŸŸ¢ åŸºç¡€</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 class="subsection-title">æŠ€æœ¯å‡çº§</h3>
                    <ul>
                        <li><strong>LangGraph ç¼–æ’</strong>ï¼šç”¨çŠ¶æ€å›¾å®ç°æ›´å¤æ‚çš„å¯¹è¯æµç¨‹</li>
                        <li><strong>å¤š Agent åä½œ</strong>ï¼šè®¢å• Agent + FAQ Agent + å”®å Agent åˆ†å·¥åä½œ</li>
                        <li><strong>å¼ºåŒ–å­¦ä¹ </strong>ï¼šæ ¹æ®ç”¨æˆ·åé¦ˆæŒç»­ä¼˜åŒ–å›ç­”</li>
                        <li><strong>çŸ¥è¯†å›¾è°±</strong>ï¼šæ„å»ºå•†å“å’Œé—®é¢˜çš„å…³ç³»å›¾è°±</li>
                    </ul>
                </section>

                <!-- å‚è€ƒèµ„æº -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ“– å‚è€ƒèµ„æº</h2>
                    <ul>
                        <li>
                            <a href="https://langchain-ai.github.io/langgraph/tutorials/customer-support/customer-support/" target="_blank">
                                LangGraph å®¢æœæœºå™¨äººæ•™ç¨‹
                            </a>
                        </li>
                        <li>
                            <a href="https://docs.langchain.com/oss/python/langchain/retrieval" target="_blank">
                                LangChain Retrieval æ–‡æ¡£
                            </a>
                        </li>
                        <li>
                            <a href="https://docs.langchain.com/oss/python/langchain/agents" target="_blank">
                                LangChain Agents æ–‡æ¡£
                            </a>
                        </li>
                        <li>
                            <a href="https://blog.langchain.com/agent-middleware/" target="_blank">
                                Agent Middleware åšå®¢
                            </a>
                        </li>
                    </ul>
                </section>

                <!-- é¡µé¢å¯¼èˆª -->
                                <nav class="page-navigation">
                    <a href="15-langgraph.html" class="nav-button prev">
                        â† ä¸Šä¸€é¡µï¼šLangGraph
                    </a>
                    <a href="17-best-practices.html" class="nav-button next">
                        ä¸‹ä¸€é¡µï¼šæœ€ä½³å®è·µ â†’
                    </a>
                </nav>
            </div>
        </main>
    </div>

    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button class="back-to-top" aria-label="è¿”å›é¡¶éƒ¨">â†‘</button>

    <!-- JavaScript -->
    <script src="assets/js/mermaid-init.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</body>
</html>
