<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="LangChain 1.0 ä¸Šä¸‹æ–‡å·¥ç¨‹ - æ„å»ºå¯é  AI Agent çš„æ ¸å¿ƒæŠ€æœ¯">
    <title>ä¸Šä¸‹æ–‡å·¥ç¨‹ | LangChain 1.0 Python çŸ¥è¯†æ–‡æ¡£</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <button class="mobile-menu-button" aria-label="æ‰“å¼€èœå•">â˜°</button>

    <div class="container">
        <!-- ä¾§è¾¹æ å¯¼èˆª -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1 class="sidebar-title">ğŸ¦œ LangChain 1.0</h1>
                <p class="sidebar-subtitle">Python å®Œæ•´å­¦ä¹ æŒ‡å—</p>
            </div>

            <ul class="nav-menu">
                <li class="nav-section">
                    <div class="nav-section-title">å¼€å§‹</div>
                    <ul>
                        <li class="nav-item">
                            <a href="index.html" class="nav-link">
                                <span class="nav-icon">ğŸ </span>
                                ä¸»é¡µ
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">åŸºç¡€ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="01-introduction.html" class="nav-link">
                                <span class="nav-icon">ğŸ“–</span>
                                LangChain ç®€ä»‹
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="02-architecture.html" class="nav-link">
                                <span class="nav-icon">ğŸ—ï¸</span>
                                æ ¸å¿ƒæ¶æ„
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="03-models.html" class="nav-link">
                                <span class="nav-icon">ğŸ¤–</span>
                                æ¨¡å‹æ¥å£
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="04-messages.html" class="nav-link">
                                <span class="nav-icon">ğŸ’¬</span>
                                æ¶ˆæ¯ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="05-tools.html" class="nav-link">
                                <span class="nav-icon">ğŸ”§</span>
                                å·¥å…·ç³»ç»Ÿ
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">è¿›é˜¶ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="06-agents.html" class="nav-link">
                                <span class="nav-icon">ğŸ¯</span>
                                Agent åŸºç¡€
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="07-middleware.html" class="nav-link">
                                <span class="nav-icon">âš™ï¸</span>
                                ä¸­é—´ä»¶ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="08-rag.html" class="nav-link">
                                <span class="nav-icon">ğŸ”</span>
                                RAG è¯¦è§£
                                <span class="nav-badge">é‡ç‚¹</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="09-lcel.html" class="nav-link">
                                <span class="nav-icon">ğŸ”—</span>
                                LCEL è¡¨è¾¾å¼
                            </a>
                        </li>
                    </ul>
                </li>

                                <li class="nav-section">
                    <div class="nav-section-title">é«˜çº§åº”ç”¨</div>
                    <ul>
                        <li class="nav-item">
                            <a href="10-runtime.html" class="nav-link">
                                <span class="nav-icon">ğŸ”Œ</span>
                                Runtime ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="11-checkpointer.html" class="nav-link">
                                <span class="nav-icon">ğŸ’¾</span>
                                æŒä¹…åŒ–ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="12-streaming.html" class="nav-link">
                                <span class="nav-icon">ğŸŒŠ</span>
                                æµå¼è¾“å‡º
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="13-human-in-loop.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¤</span>
                                äººå·¥ä»‹å…¥
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="14-long-term-memory.html" class="nav-link">
                                <span class="nav-icon">ğŸ—„ï¸</span>
                                é•¿æœŸè®°å¿†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="15-langgraph.html" class="nav-link">
                                <span class="nav-icon">ğŸ“Š</span>
                                LangGraph
                            </a>
                        </li>
                        <li class="nav-item active">
                            <a href="16-context-engineering.html" class="nav-link">
                                <span class="nav-icon">ğŸ¯</span>
                                ä¸Šä¸‹æ–‡å·¥ç¨‹
                                <span class="nav-badge">é‡ç‚¹</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="17-mcp.html" class="nav-link">
                                <span class="nav-icon">ğŸ”Œ</span>
                                MCP åè®®
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">å®æˆ˜ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="18-customer-service.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¥</span>
                                å®¢æœæœºå™¨äºº
                                <span class="nav-badge">é‡ç‚¹</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="19-best-practices.html" class="nav-link">
                                <span class="nav-icon">âœ¨</span>
                                æœ€ä½³å®è·µ
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">å‚è€ƒç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="20-api-reference.html" class="nav-link">
                                <span class="nav-icon">ğŸ“š</span>
                                API é€ŸæŸ¥è¡¨
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="21-troubleshooting.html" class="nav-link">
                                <span class="nav-icon">ğŸ›</span>
                                æ•…éšœæ’é™¤
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="22-migration.html" class="nav-link">
                                <span class="nav-icon">ğŸ”„</span>
                                è¿ç§»æŒ‡å—
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">æ‰©å±•ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="23-structured-output.html" class="nav-link">
                                <span class="nav-icon">ğŸ“Š</span>
                                ç»“æ„åŒ–è¾“å‡º
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">DeepAgents ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="24-deepagents-quickstart.html" class="nav-link">
                                <span class="nav-icon">ğŸš€</span>
                                å¿«é€Ÿå¼€å§‹
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="25-deepagents-customization.html" class="nav-link">
                                <span class="nav-icon">ğŸ¨</span>
                                å®šåˆ¶åŒ–
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="26-deepagents-harness.html" class="nav-link">
                                <span class="nav-icon">ğŸ›ï¸</span>
                                Harness ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="27-deepagents-backends.html" class="nav-link">
                                <span class="nav-icon">ğŸ”§</span>
                                åç«¯é…ç½®
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="28-deepagents-subagents.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¥</span>
                                å­ä»£ç†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="29-deepagents-hitl.html" class="nav-link">
                                <span class="nav-icon">ğŸ¤</span>
                                äººå·¥ä»‹å…¥
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="30-deepagents-memory.html" class="nav-link">
                                <span class="nav-icon">ğŸ§ </span>
                                é•¿æœŸè®°å¿†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="31-deepagents-middleware.html" class="nav-link">
                                <span class="nav-icon">âš™ï¸</span>
                                ä¸­é—´ä»¶
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">Multi-Agent ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="32-multi-agent-index.html" class="nav-link">
                                <span class="nav-icon">ğŸŒ</span>
                                æ¦‚è¿°
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="33-multi-agent-subagents.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¥</span>
                                å­ä»£ç†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="34-multi-agent-handoffs.html" class="nav-link">
                                <span class="nav-icon">ğŸ”„</span>
                                äº¤æ¥æœºåˆ¶
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="35-multi-agent-skills.html" class="nav-link">
                                <span class="nav-icon">ğŸ¯</span>
                                æŠ€èƒ½ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="36-multi-agent-router.html" class="nav-link">
                                <span class="nav-icon">ğŸ§­</span>
                                è·¯ç”±æœºåˆ¶
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="37-multi-agent-workflow.html" class="nav-link">
                                <span class="nav-icon">ğŸ”€</span>
                                è‡ªå®šä¹‰å·¥ä½œæµ
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <div class="content-wrapper">
                <!-- é¢åŒ…å±‘å¯¼èˆª -->
                <nav class="breadcrumb">
                    <span class="breadcrumb-item">
                        <a href="index.html" class="breadcrumb-link">ä¸»é¡µ</a>
                    </span>
                    <span class="breadcrumb-item">
                        é«˜çº§åº”ç”¨
                    </span>
                    <span class="breadcrumb-item">
                        ä¸Šä¸‹æ–‡å·¥ç¨‹
                    </span>
                </nav>

                <!-- é¡µé¢æ ‡é¢˜ -->
                <header class="page-header">
                    <h1 class="page-title">ğŸ¯ ä¸Šä¸‹æ–‡å·¥ç¨‹ï¼ˆContext Engineeringï¼‰</h1>
                    <p class="page-subtitle">
                        æŒæ¡æ„å»ºå¯é  AI Agent çš„æ ¸å¿ƒæŠ€æœ¯â€”â€”é€šè¿‡æä¾›æ­£ç¡®çš„ä¿¡æ¯å’Œå·¥å…·ï¼Œ
                        ä½¿ LLM èƒ½å¤Ÿå‡†ç¡®å®Œæˆä»»åŠ¡ã€‚è¿™æ˜¯ AI å·¥ç¨‹å¸ˆçš„é¦–è¦èŒè´£ã€‚
                    </p>
                </header>

                <!-- Overview -->
                <section class="content-section">
                    <h2 class="section-title">æ¦‚è¿°</h2>
                    <p>
                        æ„å»º Agentï¼ˆæˆ–ä»»ä½• LLM åº”ç”¨ï¼‰æœ€å›°éš¾çš„éƒ¨åˆ†æ˜¯è®©å®ƒä»¬è¶³å¤Ÿå¯é ã€‚
                        è™½ç„¶å®ƒä»¬åœ¨åŸå‹é˜¶æ®µå¯èƒ½æœ‰æ•ˆï¼Œä½†åœ¨å®é™…ä½¿ç”¨æ¡ˆä¾‹ä¸­ç»å¸¸å¤±è´¥ã€‚
                    </p>

                    <h3 class="subsection-title">ä¸ºä»€ä¹ˆ Agent ä¼šå¤±è´¥ï¼Ÿ</h3>
                    <p>
                        å½“ Agent å¤±è´¥æ—¶ï¼Œé€šå¸¸æ˜¯å› ä¸º Agent å†…éƒ¨çš„ LLM è°ƒç”¨é‡‡å–äº†é”™è¯¯çš„è¡ŒåŠ¨ï¼Œ
                        æˆ–è€…æ²¡æœ‰æŒ‰ç…§æˆ‘ä»¬çš„æœŸæœ›æ‰§è¡Œã€‚LLM å¤±è´¥é€šå¸¸æœ‰ä¸¤ä¸ªåŸå› ï¼š
                    </p>
                    <ol>
                        <li>åº•å±‚ LLM èƒ½åŠ›ä¸è¶³</li>
                        <li>"æ­£ç¡®"çš„ä¸Šä¸‹æ–‡æœªä¼ é€’ç»™ LLM</li>
                    </ol>
                    <p>
                        <strong>æ›´å¤šæƒ…å†µä¸‹ï¼Œå®é™…ä¸Šæ˜¯ç¬¬äºŒä¸ªåŸå› å¯¼è‡´ Agent ä¸å¯é ã€‚</strong>
                    </p>

                    <div class="info-box tip">
                        <div class="info-box-title">ğŸ’¡ ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡å·¥ç¨‹ï¼Ÿ</div>
                        <p>
                            <strong>ä¸Šä¸‹æ–‡å·¥ç¨‹</strong>æ˜¯ä»¥æ­£ç¡®çš„æ ¼å¼æä¾›æ­£ç¡®çš„ä¿¡æ¯å’Œå·¥å…·ï¼Œ
                            ä½¿ LLM èƒ½å¤Ÿå®Œæˆä»»åŠ¡ã€‚è¿™æ˜¯ AI å·¥ç¨‹å¸ˆçš„é¦–è¦å·¥ä½œã€‚
                            ç¼ºä¹"æ­£ç¡®"çš„ä¸Šä¸‹æ–‡æ˜¯é˜»ç¢æ›´å¯é  Agent çš„é¦–è¦éšœç¢ï¼Œ
                            LangChain çš„ Agent æŠ½è±¡ä¸“é—¨è®¾è®¡ç”¨äºä¿ƒè¿›ä¸Šä¸‹æ–‡å·¥ç¨‹ã€‚
                        </p>
                    </div>

                    <h3 class="subsection-title">Agent å¾ªç¯</h3>
                    <p>å…¸å‹çš„ Agent å¾ªç¯åŒ…å«ä¸¤ä¸ªä¸»è¦æ­¥éª¤ï¼š</p>
                    <ol>
                        <li><strong>æ¨¡å‹è°ƒç”¨</strong> - ä½¿ç”¨æç¤ºè¯å’Œå¯ç”¨å·¥å…·è°ƒç”¨ LLMï¼Œè¿”å›å“åº”æˆ–å·¥å…·æ‰§è¡Œè¯·æ±‚</li>
                        <li><strong>å·¥å…·æ‰§è¡Œ</strong> - æ‰§è¡Œ LLM è¯·æ±‚çš„å·¥å…·ï¼Œè¿”å›å·¥å…·ç»“æœ</li>
                    </ol>

                    <div style="text-align: center; margin: 2rem 0;">
                        <img src="https://mintcdn.com/langchain-5e9cc07a/Tazq8zGc0yYUYrDl/oss/images/core_agent_loop.png?fit=max&auto=format&n=Tazq8zGc0yYUYrDl&q=85&s=ac72e48317a9ced68fd1be64e89ec063"
                             alt="æ ¸å¿ƒ Agent å¾ªç¯"
                             style="max-width: 300px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);" />
                    </div>

                    <p>è¿™ä¸ªå¾ªç¯ä¼šæŒç»­è¿›è¡Œï¼Œç›´åˆ° LLM å†³å®šå®Œæˆã€‚</p>
                </section>

                <!-- å¯æ§åˆ¶çš„å†…å®¹ -->
                <section class="content-section">
                    <h2 class="section-title">å¯æ§åˆ¶çš„å†…å®¹</h2>
                    <p>
                        è¦æ„å»ºå¯é çš„ Agentï¼Œæ‚¨éœ€è¦æ§åˆ¶ Agent å¾ªç¯æ¯ä¸€æ­¥å‘ç”Ÿçš„äº‹æƒ…ï¼Œ
                        ä»¥åŠæ­¥éª¤ä¹‹é—´å‘ç”Ÿçš„äº‹æƒ…ã€‚
                    </p>

                    <table>
                        <thead>
                            <tr>
                                <th>ä¸Šä¸‹æ–‡ç±»å‹</th>
                                <th>å¯æ§åˆ¶çš„å†…å®¹</th>
                                <th>ç¬æ€æˆ–æŒä¹…</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>æ¨¡å‹ä¸Šä¸‹æ–‡</strong></td>
                                <td>è¿›å…¥æ¨¡å‹è°ƒç”¨çš„å†…å®¹ï¼ˆæŒ‡ä»¤ã€æ¶ˆæ¯å†å²ã€å·¥å…·ã€å“åº”æ ¼å¼ï¼‰</td>
                                <td>ç¬æ€</td>
                            </tr>
                            <tr>
                                <td><strong>å·¥å…·ä¸Šä¸‹æ–‡</strong></td>
                                <td>å·¥å…·å¯ä»¥è®¿é—®å’Œäº§ç”Ÿçš„å†…å®¹ï¼ˆè¯»/å†™çŠ¶æ€ã€å­˜å‚¨ã€è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ï¼‰</td>
                                <td>æŒä¹…</td>
                            </tr>
                            <tr>
                                <td><strong>ç”Ÿå‘½å‘¨æœŸä¸Šä¸‹æ–‡</strong></td>
                                <td>æ¨¡å‹å’Œå·¥å…·è°ƒç”¨ä¹‹é—´å‘ç”Ÿçš„äº‹æƒ…ï¼ˆæ‘˜è¦ã€é˜²æŠ¤æ ã€æ—¥å¿—ç­‰ï¼‰</td>
                                <td>æŒä¹…</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info-box note">
                        <div class="info-box-title">ç†è§£ç¬æ€ä¸æŒä¹…ä¸Šä¸‹æ–‡</div>
                        <ul>
                            <li>
                                <strong>ç¬æ€ä¸Šä¸‹æ–‡</strong>ï¼šLLM åœ¨å•æ¬¡è°ƒç”¨ä¸­çœ‹åˆ°çš„å†…å®¹ã€‚
                                æ‚¨å¯ä»¥ä¿®æ”¹æ¶ˆæ¯ã€å·¥å…·æˆ–æç¤ºè¯ï¼Œè€Œä¸æ”¹å˜çŠ¶æ€ä¸­ä¿å­˜çš„å†…å®¹ã€‚
                            </li>
                            <li>
                                <strong>æŒä¹…ä¸Šä¸‹æ–‡</strong>ï¼šè·¨è½®æ¬¡ä¿å­˜åœ¨çŠ¶æ€ä¸­çš„å†…å®¹ã€‚
                                ç”Ÿå‘½å‘¨æœŸé’©å­å’Œå·¥å…·å†™å…¥ä¼šæ°¸ä¹…ä¿®æ”¹å®ƒã€‚
                            </li>
                        </ul>
                    </div>

                    <h3 class="subsection-title">æ•°æ®æº</h3>
                    <p>åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ‚¨çš„ Agent è®¿é—®ï¼ˆè¯»/å†™ï¼‰ä¸åŒçš„æ•°æ®æºï¼š</p>

                    <table>
                        <thead>
                            <tr>
                                <th>æ•°æ®æº</th>
                                <th>ä¹Ÿç§°ä¸º</th>
                                <th>èŒƒå›´</th>
                                <th>ç¤ºä¾‹</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Runtime Context</strong></td>
                                <td>é™æ€é…ç½®</td>
                                <td>ä¼šè¯èŒƒå›´</td>
                                <td>ç”¨æˆ· IDã€API å¯†é’¥ã€æ•°æ®åº“è¿æ¥ã€æƒé™ã€ç¯å¢ƒè®¾ç½®</td>
                            </tr>
                            <tr>
                                <td><strong>State</strong></td>
                                <td>çŸ­æœŸè®°å¿†</td>
                                <td>ä¼šè¯èŒƒå›´</td>
                                <td>å½“å‰æ¶ˆæ¯ã€ä¸Šä¼ æ–‡ä»¶ã€è®¤è¯çŠ¶æ€ã€å·¥å…·ç»“æœ</td>
                            </tr>
                            <tr>
                                <td><strong>Store</strong></td>
                                <td>é•¿æœŸè®°å¿†</td>
                                <td>è·¨ä¼šè¯</td>
                                <td>ç”¨æˆ·åå¥½ã€æå–çš„è§è§£ã€è®°å¿†ã€å†å²æ•°æ®</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 class="subsection-title">å·¥ä½œåŸç†</h3>
                    <p>
                        LangChain <strong>ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰</strong>æ˜¯ä½¿ä¸Šä¸‹æ–‡å·¥ç¨‹å¯¹ä½¿ç”¨ LangChain çš„å¼€å‘è€…å˜å¾—å®ç”¨çš„åº•å±‚æœºåˆ¶ã€‚
                    </p>
                    <p>ä¸­é—´ä»¶å…è®¸æ‚¨è¿æ¥åˆ° Agent ç”Ÿå‘½å‘¨æœŸçš„ä»»ä½•æ­¥éª¤ï¼Œå¹¶ä¸”ï¼š</p>
                    <ul>
                        <li>æ›´æ–°ä¸Šä¸‹æ–‡</li>
                        <li>è·³è½¬åˆ° Agent ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒæ­¥éª¤</li>
                    </ul>
                    <p>
                        åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæ‚¨å°†ç»å¸¸çœ‹åˆ°ä½¿ç”¨ä¸­é—´ä»¶ API ä½œä¸ºå®ç°ä¸Šä¸‹æ–‡å·¥ç¨‹ç›®æ ‡çš„æ‰‹æ®µã€‚
                    </p>
                </section>

                <!-- æ¨¡å‹ä¸Šä¸‹æ–‡ -->
                <section class="content-section">
                    <h2 class="section-title">æ¨¡å‹ä¸Šä¸‹æ–‡ï¼ˆModel Contextï¼‰</h2>
                    <p>
                        æ§åˆ¶è¿›å…¥æ¯æ¬¡æ¨¡å‹è°ƒç”¨çš„å†…å®¹â€”â€”æŒ‡ä»¤ã€å¯ç”¨å·¥å…·ã€ä½¿ç”¨å“ªä¸ªæ¨¡å‹ä»¥åŠè¾“å‡ºæ ¼å¼ã€‚
                        è¿™äº›å†³ç­–ç›´æ¥å½±å“å¯é æ€§å’Œæˆæœ¬ã€‚
                    </p>

                    <h3 class="subsection-title">ç³»ç»Ÿæç¤ºè¯ï¼ˆSystem Promptï¼‰</h3>
                    <p>
                        ç³»ç»Ÿæç¤ºè¯è®¾ç½® LLM çš„è¡Œä¸ºå’Œèƒ½åŠ›ã€‚ä¸åŒçš„ç”¨æˆ·ã€ä¸Šä¸‹æ–‡æˆ–å¯¹è¯é˜¶æ®µéœ€è¦ä¸åŒçš„æŒ‡ä»¤ã€‚
                        æˆåŠŸçš„ Agent ä¼šåˆ©ç”¨è®°å¿†ã€åå¥½å’Œé…ç½®ä¸ºå½“å‰å¯¹è¯çŠ¶æ€æä¾›æ­£ç¡®çš„æŒ‡ä»¤ã€‚
                    </p>

                    <h4 class="subsection-subtitle">ä» State è¯»å–</h4>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">from langchain.agents import create_agent
from langchain.agents.middleware import dynamic_prompt, ModelRequest

@dynamic_prompt
def state_aware_prompt(request: ModelRequest) -> str:
    # request.messages æ˜¯ request.state["messages"] çš„å¿«æ·æ–¹å¼
    message_count = len(request.messages)

    base = "You are a helpful assistant."

    if message_count > 10:
        base += "\nThis is a long conversation - be extra concise."

    return base

agent = create_agent(
    model="gpt-4o",
    tools=[...],
    middleware=[state_aware_prompt]
)</code></pre>
                    </div>

                    <h4 class="subsection-subtitle">ä» Store è¯»å–</h4>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">from dataclasses import dataclass
from langchain.agents import create_agent
from langchain.agents.middleware import dynamic_prompt, ModelRequest
from langgraph.store.memory import InMemoryStore

@dataclass
class Context:
    user_id: str

@dynamic_prompt
def store_aware_prompt(request: ModelRequest) -> str:
    user_id = request.runtime.context.user_id

    # ä» Store è¯»å–ï¼šè·å–ç”¨æˆ·åå¥½
    store = request.runtime.store
    user_prefs = store.get(("preferences",), user_id)

    base = "You are a helpful assistant."

    if user_prefs:
        style = user_prefs.value.get("communication_style", "balanced")
        base += f"\nUser prefers {style} responses."

    return base

agent = create_agent(
    model="gpt-4o",
    tools=[...],
    middleware=[store_aware_prompt],
    context_schema=Context,
    store=InMemoryStore()
)</code></pre>
                    </div>

                    <h4 class="subsection-subtitle">ä» Runtime Context è¯»å–</h4>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">from dataclasses import dataclass
from langchain.agents import create_agent
from langchain.agents.middleware import dynamic_prompt, ModelRequest

@dataclass
class Context:
    user_role: str
    deployment_env: str

@dynamic_prompt
def context_aware_prompt(request: ModelRequest) -> str:
    # ä» Runtime Context è¯»å–ï¼šç”¨æˆ·è§’è‰²å’Œç¯å¢ƒ
    user_role = request.runtime.context.user_role
    env = request.runtime.context.deployment_env

    base = "You are a helpful assistant."

    if user_role == "admin":
        base += "\nYou have admin access. You can perform all operations."
    elif user_role == "viewer":
        base += "\nYou have read-only access. Guide users to read operations only."

    if env == "production":
        base += "\nBe extra careful with any data modifications."

    return base

agent = create_agent(
    model="gpt-4o",
    tools=[...],
    middleware=[context_aware_prompt],
    context_schema=Context
)</code></pre>
                    </div>

                    <h3 class="subsection-title">æ¶ˆæ¯ï¼ˆMessagesï¼‰</h3>
                    <p>
                        æ¶ˆæ¯æ„æˆå‘é€ç»™ LLM çš„æç¤ºè¯ã€‚ç®¡ç†æ¶ˆæ¯å†…å®¹å¯¹äºç¡®ä¿ LLM æ‹¥æœ‰æ­£ç¡®çš„ä¿¡æ¯ä»¥è‰¯å¥½å“åº”è‡³å…³é‡è¦ã€‚
                    </p>

                    <h4 class="subsection-subtitle">ä» State æ³¨å…¥æ–‡ä»¶ä¸Šä¸‹æ–‡</h4>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">from langchain.agents import create_agent
from langchain.agents.middleware import wrap_model_call, ModelRequest, ModelResponse
from typing import Callable

@wrap_model_call
def inject_file_context(
    request: ModelRequest,
    handler: Callable[[ModelRequest], ModelResponse]
) -> ModelResponse:
    """æ³¨å…¥ç”¨æˆ·åœ¨æ­¤ä¼šè¯ä¸­ä¸Šä¼ çš„æ–‡ä»¶ä¸Šä¸‹æ–‡"""
    # ä» State è¯»å–ï¼šè·å–ä¸Šä¼ çš„æ–‡ä»¶å…ƒæ•°æ®
    uploaded_files = request.state.get("uploaded_files", [])

    if uploaded_files:
        # æ„å»ºå¯ç”¨æ–‡ä»¶çš„ä¸Šä¸‹æ–‡
        file_descriptions = []
        for file in uploaded_files:
            file_descriptions.append(
                f"- {file['name']} ({file['type']}): {file['summary']}"
            )

        file_context = f"""Files you have access to in this conversation:
{chr(10).join(file_descriptions)}

Reference these files when answering questions."""

        # åœ¨æœ€è¿‘çš„æ¶ˆæ¯ä¹‹å‰æ³¨å…¥æ–‡ä»¶ä¸Šä¸‹æ–‡
        messages = [
            *request.messages,
            {"role": "user", "content": file_context},
        ]
        request = request.override(messages=messages)

    return handler(request)

agent = create_agent(
    model="gpt-4o",
    tools=[...],
    middleware=[inject_file_context]
)</code></pre>
                    </div>

                    <div class="info-box note">
                        <div class="info-box-title">âš ï¸ ç¬æ€ vs æŒä¹…æ¶ˆæ¯æ›´æ–°</div>
                        <p>
                            ä¸Šè¿°ç¤ºä¾‹ä½¿ç”¨ <code>wrap_model_call</code> è¿›è¡Œ<strong>ç¬æ€</strong>æ›´æ–°â€”â€”
                            ä¿®æ”¹å•æ¬¡è°ƒç”¨å‘é€ç»™æ¨¡å‹çš„æ¶ˆæ¯ï¼Œè€Œä¸æ”¹å˜çŠ¶æ€ä¸­ä¿å­˜çš„å†…å®¹ã€‚
                        </p>
                        <p>
                            å¯¹äºä¿®æ”¹çŠ¶æ€çš„<strong>æŒä¹…</strong>æ›´æ–°ï¼ˆå¦‚ç”Ÿå‘½å‘¨æœŸä¸Šä¸‹æ–‡ä¸­çš„æ‘˜è¦ç¤ºä¾‹ï¼‰ï¼Œ
                            ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸé’©å­å¦‚ <code>before_model</code> æˆ– <code>after_model</code>
                            æ¥æ°¸ä¹…æ›´æ–°å¯¹è¯å†å²ã€‚
                        </p>
                    </div>

                    <h3 class="subsection-title">å·¥å…·ï¼ˆToolsï¼‰</h3>
                    <p>
                        å·¥å…·è®©æ¨¡å‹ä¸æ•°æ®åº“ã€API å’Œå¤–éƒ¨ç³»ç»Ÿäº¤äº’ã€‚æ‚¨å®šä¹‰å’Œé€‰æ‹©å·¥å…·çš„æ–¹å¼ç›´æ¥å½±å“æ¨¡å‹èƒ½å¦æœ‰æ•ˆå®Œæˆä»»åŠ¡ã€‚
                    </p>

                    <h4 class="subsection-subtitle">å®šä¹‰å·¥å…·</h4>
                    <p>
                        æ¯ä¸ªå·¥å…·éƒ½éœ€è¦æ¸…æ™°çš„åç§°ã€æè¿°ã€å‚æ•°åç§°å’Œå‚æ•°æè¿°ã€‚
                        è¿™äº›ä¸ä»…ä»…æ˜¯å…ƒæ•°æ®â€”â€”å®ƒä»¬æŒ‡å¯¼æ¨¡å‹ä½•æ—¶ä»¥åŠå¦‚ä½•ä½¿ç”¨å·¥å…·ã€‚
                    </p>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty basic">ğŸŸ¢ åŸºç¡€</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">from langchain.tools import tool

@tool(parse_docstring=True)
def search_orders(
    user_id: str,
    status: str,
    limit: int = 10
) -> str:
    """Search for user orders by status.

    Use this when the user asks about order history or wants to check
    order status. Always filter by the provided status.

    Args:
        user_id: Unique identifier for the user
        status: Order status: 'pending', 'shipped', or 'delivered'
        limit: Maximum number of results to return
    """
    # Implementation here
    pass</code></pre>
                    </div>

                    <h4 class="subsection-subtitle">åŠ¨æ€é€‰æ‹©å·¥å…·</h4>
                    <p>
                        å¹¶éæ¯ä¸ªå·¥å…·éƒ½é€‚ç”¨äºæ¯ç§æƒ…å†µã€‚å·¥å…·è¿‡å¤šå¯èƒ½ä¼šè®©æ¨¡å‹ä¸å ªé‡è´Ÿï¼ˆä¸Šä¸‹æ–‡è¿‡è½½ï¼‰å¹¶å¢åŠ é”™è¯¯ï¼›
                        å·¥å…·è¿‡å°‘ä¼šé™åˆ¶èƒ½åŠ›ã€‚åŠ¨æ€å·¥å…·é€‰æ‹©æ ¹æ®è®¤è¯çŠ¶æ€ã€ç”¨æˆ·æƒé™ã€åŠŸèƒ½æ ‡å¿—æˆ–å¯¹è¯é˜¶æ®µè°ƒæ•´å¯ç”¨å·¥å…·é›†ã€‚
                    </p>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty advanced">ğŸ”´ é«˜çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">from langchain.agents import create_agent
from langchain.agents.middleware import wrap_model_call, ModelRequest, ModelResponse
from typing import Callable

@wrap_model_call
def state_based_tools(
    request: ModelRequest,
    handler: Callable[[ModelRequest], ModelResponse]
) -> ModelResponse:
    """åŸºäºå¯¹è¯ State è¿‡æ»¤å·¥å…·"""
    # ä» State è¯»å–ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²è®¤è¯
    state = request.state
    is_authenticated = state.get("authenticated", False)
    message_count = len(state["messages"])

    # åªåœ¨è®¤è¯åå¯ç”¨æ•æ„Ÿå·¥å…·
    if not is_authenticated:
        tools = [t for t in request.tools if t.name.startswith("public_")]
        request = request.override(tools=tools)
    elif message_count < 5:
        # åœ¨å¯¹è¯æ—©æœŸé™åˆ¶å·¥å…·
        tools = [t for t in request.tools if t.name != "advanced_search"]
        request = request.override(tools=tools)

    return handler(request)

agent = create_agent(
    model="gpt-4o",
    tools=[public_search, private_search, advanced_search],
    middleware=[state_based_tools]
)</code></pre>
                    </div>

                    <h3 class="subsection-title">æ¨¡å‹é€‰æ‹©ï¼ˆModelï¼‰</h3>
                    <p>
                        ä¸åŒçš„æ¨¡å‹å…·æœ‰ä¸åŒçš„ä¼˜åŠ¿ã€æˆæœ¬å’Œä¸Šä¸‹æ–‡çª—å£ã€‚ä¸ºæ‰‹å¤´çš„ä»»åŠ¡é€‰æ‹©åˆé€‚çš„æ¨¡å‹ï¼Œ
                        è¿™å¯èƒ½ä¼šåœ¨ Agent è¿è¡ŒæœŸé—´å‘ç”Ÿå˜åŒ–ã€‚
                    </p>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">from langchain.agents import create_agent
from langchain.agents.middleware import wrap_model_call, ModelRequest, ModelResponse
from langchain.chat_models import init_chat_model
from typing import Callable

# åœ¨ä¸­é—´ä»¶å¤–éƒ¨åˆå§‹åŒ–æ¨¡å‹ä¸€æ¬¡
large_model = init_chat_model("claude-sonnet-4-5-20250929")
standard_model = init_chat_model("gpt-4o")
efficient_model = init_chat_model("gpt-4o-mini")

@wrap_model_call
def state_based_model(
    request: ModelRequest,
    handler: Callable[[ModelRequest], ModelResponse]
) -> ModelResponse:
    """åŸºäº State å¯¹è¯é•¿åº¦é€‰æ‹©æ¨¡å‹"""
    # request.messages æ˜¯ request.state["messages"] çš„å¿«æ·æ–¹å¼
    message_count = len(request.messages)

    if message_count > 20:
        # é•¿å¯¹è¯ - ä½¿ç”¨å…·æœ‰æ›´å¤§ä¸Šä¸‹æ–‡çª—å£çš„æ¨¡å‹
        model = large_model
    elif message_count > 10:
        # ä¸­ç­‰å¯¹è¯
        model = standard_model
    else:
        # çŸ­å¯¹è¯ - ä½¿ç”¨é«˜æ•ˆæ¨¡å‹
        model = efficient_model

    request = request.override(model=model)

    return handler(request)

agent = create_agent(
    model="gpt-4o-mini",
    tools=[...],
    middleware=[state_based_model]
)</code></pre>
                    </div>

                    <h3 class="subsection-title">å“åº”æ ¼å¼ï¼ˆResponse Formatï¼‰</h3>
                    <p>
                        ç»“æ„åŒ–è¾“å‡ºå°†éç»“æ„åŒ–æ–‡æœ¬è½¬æ¢ä¸ºç»è¿‡éªŒè¯çš„ç»“æ„åŒ–æ•°æ®ã€‚
                        å½“æå–ç‰¹å®šå­—æ®µæˆ–ä¸ºä¸‹æ¸¸ç³»ç»Ÿè¿”å›æ•°æ®æ—¶ï¼Œè‡ªç”±æ ¼å¼æ–‡æœ¬æ˜¯ä¸å¤Ÿçš„ã€‚
                    </p>

                    <h4 class="subsection-subtitle">å®šä¹‰æ ¼å¼</h4>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty basic">ğŸŸ¢ åŸºç¡€</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">from pydantic import BaseModel, Field

class CustomerSupportTicket(BaseModel):
    """ä»å®¢æˆ·æ¶ˆæ¯ä¸­æå–çš„ç»“æ„åŒ–å·¥å•ä¿¡æ¯"""

    category: str = Field(
        description="Issue category: 'billing', 'technical', 'account', or 'product'"
    )
    priority: str = Field(
        description="Urgency level: 'low', 'medium', 'high', or 'critical'"
    )
    summary: str = Field(
        description="One-sentence summary of the customer's issue"
    )
    customer_sentiment: str = Field(
        description="Customer's emotional tone: 'frustrated', 'neutral', or 'satisfied'"
    )</code></pre>
                    </div>

                    <h4 class="subsection-subtitle">åŠ¨æ€é€‰æ‹©æ ¼å¼</h4>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">from langchain.agents import create_agent
from langchain.agents.middleware import wrap_model_call, ModelRequest, ModelResponse
from pydantic import BaseModel, Field
from typing import Callable

class SimpleResponse(BaseModel):
    """æ—©æœŸå¯¹è¯çš„ç®€å•å“åº”"""
    answer: str = Field(description="A brief answer")

class DetailedResponse(BaseModel):
    """å·²å»ºç«‹å¯¹è¯çš„è¯¦ç»†å“åº”"""
    answer: str = Field(description="A detailed answer")
    reasoning: str = Field(description="Explanation of reasoning")
    confidence: float = Field(description="Confidence score 0-1")

@wrap_model_call
def state_based_output(
    request: ModelRequest,
    handler: Callable[[ModelRequest], ModelResponse]
) -> ModelResponse:
    """åŸºäº State é€‰æ‹©è¾“å‡ºæ ¼å¼"""
    # request.messages æ˜¯ request.state["messages"] çš„å¿«æ·æ–¹å¼
    message_count = len(request.messages)

    if message_count < 3:
        # æ—©æœŸå¯¹è¯ - ä½¿ç”¨ç®€å•æ ¼å¼
        request = request.override(response_format=SimpleResponse)
    else:
        # å·²å»ºç«‹å¯¹è¯ - ä½¿ç”¨è¯¦ç»†æ ¼å¼
        request = request.override(response_format=DetailedResponse)

    return handler(request)

agent = create_agent(
    model="gpt-4o",
    tools=[...],
    middleware=[state_based_output]
)</code></pre>
                    </div>
                </section>

                <!-- å·¥å…·ä¸Šä¸‹æ–‡ -->
                <section class="content-section">
                    <h2 class="section-title">å·¥å…·ä¸Šä¸‹æ–‡ï¼ˆTool Contextï¼‰</h2>
                    <p>
                        å·¥å…·çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºå®ƒä»¬æ—¢è¯»å–åˆå†™å…¥ä¸Šä¸‹æ–‡ã€‚åœ¨æœ€åŸºæœ¬çš„æƒ…å†µä¸‹ï¼Œ
                        å½“å·¥å…·æ‰§è¡Œæ—¶ï¼Œå®ƒæ¥æ”¶ LLM çš„è¯·æ±‚å‚æ•°å¹¶è¿”å›å·¥å…·æ¶ˆæ¯ã€‚å·¥å…·å®Œæˆå…¶å·¥ä½œå¹¶äº§ç”Ÿç»“æœã€‚
                    </p>
                    <p>
                        å·¥å…·è¿˜å¯ä»¥è·å–æ¨¡å‹å®Œæˆä»»åŠ¡æ‰€éœ€çš„é‡è¦ä¿¡æ¯ã€‚
                    </p>

                    <h3 class="subsection-title">è¯»å–ï¼ˆReadsï¼‰</h3>
                    <p>
                        å¤§å¤šæ•°çœŸå®ä¸–ç•Œçš„å·¥å…·éœ€è¦çš„ä¸ä»…ä»…æ˜¯ LLM çš„å‚æ•°ã€‚å®ƒä»¬éœ€è¦ç”¨æˆ· ID æ¥è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œ
                        éœ€è¦ API å¯†é’¥æ¥è®¿é—®å¤–éƒ¨æœåŠ¡ï¼Œæˆ–éœ€è¦å½“å‰ä¼šè¯çŠ¶æ€æ¥åšå‡ºå†³ç­–ã€‚
                        å·¥å…·ä» Stateã€Store å’Œ Runtime Context è¯»å–ä»¥è®¿é—®è¿™äº›ä¿¡æ¯ã€‚
                    </p>

                    <div class="tabs-container">
                        <div class="tabs-header">
                            <button class="tab-button active" data-tab="tool-read-state">State</button>
                            <button class="tab-button" data-tab="tool-read-store">Store</button>
                            <button class="tab-button" data-tab="tool-read-runtime">Runtime Context</button>
                        </div>

                        <div class="tab-content active" data-tab="tool-read-state">
                            <div class="code-block-wrapper">
                                <div class="code-block-header">
                                    <span class="code-language">Python</span>
                                    <span class="code-difficulty basic">ğŸŸ¢ åŸºç¡€</span>
                                    <button class="copy-button">å¤åˆ¶ä»£ç </button>
                                </div>
                                <pre><code class="language-python">from langchain.tools import tool, ToolRuntime
from langchain.agents import create_agent

@tool
def check_authentication(
    runtime: ToolRuntime
) -> str:
    """æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²è®¤è¯"""
    # ä» State è¯»å–ï¼šæ£€æŸ¥å½“å‰è®¤è¯çŠ¶æ€
    current_state = runtime.state
    is_authenticated = current_state.get("authenticated", False)

    if is_authenticated:
        return "User is authenticated"
    else:
        return "User is not authenticated"

agent = create_agent(
    model="gpt-4o",
    tools=[check_authentication]
)</code></pre>
                            </div>
                        </div>

                        <div class="tab-content" data-tab="tool-read-store">
                            <div class="code-block-wrapper">
                                <div class="code-block-header">
                                    <span class="code-language">Python</span>
                                    <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                                    <button class="copy-button">å¤åˆ¶ä»£ç </button>
                                </div>
                                <pre><code class="language-python">from dataclasses import dataclass
from langchain.tools import tool, ToolRuntime
from langchain.agents import create_agent
from langgraph.store.memory import InMemoryStore

@dataclass
class Context:
    user_id: str

@tool
def get_preference(
    preference_key: str,
    runtime: ToolRuntime[Context]
) -> str:
    """ä» Store è·å–ç”¨æˆ·åå¥½"""
    user_id = runtime.context.user_id

    # ä» Store è¯»å–ï¼šè·å–ç°æœ‰åå¥½
    store = runtime.store
    existing_prefs = store.get(("preferences",), user_id)

    if existing_prefs:
        value = existing_prefs.value.get(preference_key)
        return f"{preference_key}: {value}" if value else f"No preference set for {preference_key}"
    else:
        return "No preferences found"

agent = create_agent(
    model="gpt-4o",
    tools=[get_preference],
    context_schema=Context,
    store=InMemoryStore()
)</code></pre>
                            </div>
                        </div>

                        <div class="tab-content" data-tab="tool-read-runtime">
                            <div class="code-block-wrapper">
                                <div class="code-block-header">
                                    <span class="code-language">Python</span>
                                    <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                                    <button class="copy-button">å¤åˆ¶ä»£ç </button>
                                </div>
                                <pre><code class="language-python">from dataclasses import dataclass
from langchain.tools import tool, ToolRuntime
from langchain.agents import create_agent

@dataclass
class Context:
    user_id: str
    api_key: str
    db_connection: str

@tool
def fetch_user_data(
    query: str,
    runtime: ToolRuntime[Context]
) -> str:
    """ä½¿ç”¨ Runtime Context é…ç½®è·å–æ•°æ®"""
    # ä» Runtime Context è¯»å–ï¼šè·å– API å¯†é’¥å’Œæ•°æ®åº“è¿æ¥
    user_id = runtime.context.user_id
    api_key = runtime.context.api_key
    db_connection = runtime.context.db_connection

    # ä½¿ç”¨é…ç½®è·å–æ•°æ®
    results = perform_database_query(db_connection, query, api_key)

    return f"Found {len(results)} results for user {user_id}"

agent = create_agent(
    model="gpt-4o",
    tools=[fetch_user_data],
    context_schema=Context
)

# ä½¿ç”¨è¿è¡Œæ—¶ä¸Šä¸‹æ–‡è°ƒç”¨
result = agent.invoke(
    {"messages": [{"role": "user", "content": "Get my data"}]},
    context=Context(
        user_id="user_123",
        api_key="sk-...",
        db_connection="postgresql://..."
    )
)</code></pre>
                            </div>
                        </div>
                    </div>

                    <h3 class="subsection-title">å†™å…¥ï¼ˆWritesï¼‰</h3>
                    <p>
                        å·¥å…·ç»“æœå¯ç”¨äºå¸®åŠ© Agent å®Œæˆç»™å®šä»»åŠ¡ã€‚å·¥å…·å¯ä»¥ç›´æ¥å‘æ¨¡å‹è¿”å›ç»“æœï¼Œ
                        ä¹Ÿå¯ä»¥æ›´æ–° Agent çš„è®°å¿†ï¼Œä½¿é‡è¦ä¸Šä¸‹æ–‡å¯ä¾›æœªæ¥æ­¥éª¤ä½¿ç”¨ã€‚
                    </p>

                    <div class="tabs-container">
                        <div class="tabs-header">
                            <button class="tab-button active" data-tab="tool-write-state">State</button>
                            <button class="tab-button" data-tab="tool-write-store">Store</button>
                        </div>

                        <div class="tab-content active" data-tab="tool-write-state">
                            <div class="code-block-wrapper">
                                <div class="code-block-header">
                                    <span class="code-language">Python</span>
                                    <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                                    <button class="copy-button">å¤åˆ¶ä»£ç </button>
                                </div>
                                <pre><code class="language-python">from langchain.tools import tool, ToolRuntime
from langchain.agents import create_agent
from langgraph.types import Command

@tool
def authenticate_user(
    password: str,
    runtime: ToolRuntime
) -> Command:
    """è®¤è¯ç”¨æˆ·å¹¶æ›´æ–° State"""
    # æ‰§è¡Œè®¤è¯ï¼ˆç®€åŒ–ï¼‰
    if password == "correct":
        # å†™å…¥ Stateï¼šä½¿ç”¨ Command æ ‡è®°ä¸ºå·²è®¤è¯
        return Command(
            update={"authenticated": True},
        )
    else:
        return Command(update={"authenticated": False})

agent = create_agent(
    model="gpt-4o",
    tools=[authenticate_user]
)</code></pre>
                            </div>
                        </div>

                        <div class="tab-content" data-tab="tool-write-store">
                            <div class="code-block-wrapper">
                                <div class="code-block-header">
                                    <span class="code-language">Python</span>
                                    <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                                    <button class="copy-button">å¤åˆ¶ä»£ç </button>
                                </div>
                                <pre><code class="language-python">from dataclasses import dataclass
from langchain.tools import tool, ToolRuntime
from langchain.agents import create_agent
from langgraph.store.memory import InMemoryStore

@dataclass
class Context:
    user_id: str

@tool
def save_preference(
    preference_key: str,
    preference_value: str,
    runtime: ToolRuntime[Context]
) -> str:
    """å°†ç”¨æˆ·åå¥½ä¿å­˜åˆ° Store"""
    user_id = runtime.context.user_id

    # è¯»å–ç°æœ‰åå¥½
    store = runtime.store
    existing_prefs = store.get(("preferences",), user_id)

    # ä¸æ–°åå¥½åˆå¹¶
    prefs = existing_prefs.value if existing_prefs else {}
    prefs[preference_key] = preference_value

    # å†™å…¥ Storeï¼šä¿å­˜æ›´æ–°çš„åå¥½
    store.put(("preferences",), user_id, prefs)

    return f"Saved preference: {preference_key} = {preference_value}"

agent = create_agent(
    model="gpt-4o",
    tools=[save_preference],
    context_schema=Context,
    store=InMemoryStore()
)</code></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ç”Ÿå‘½å‘¨æœŸä¸Šä¸‹æ–‡ -->
                <section class="content-section">
                    <h2 class="section-title">ç”Ÿå‘½å‘¨æœŸä¸Šä¸‹æ–‡ï¼ˆLife-cycle Contextï¼‰</h2>
                    <p>
                        æ§åˆ¶æ ¸å¿ƒ Agent æ­¥éª¤<strong>ä¹‹é—´</strong>å‘ç”Ÿçš„äº‹æƒ…â€”â€”æ‹¦æˆªæ•°æ®æµä»¥å®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œ
                        å¦‚æ‘˜è¦ã€é˜²æŠ¤æ å’Œæ—¥å¿—è®°å½•ã€‚
                    </p>

                    <p>
                        å¦‚æ‚¨åœ¨æ¨¡å‹ä¸Šä¸‹æ–‡å’Œå·¥å…·ä¸Šä¸‹æ–‡ä¸­æ‰€è§ï¼Œä¸­é—´ä»¶æ˜¯ä½¿ä¸Šä¸‹æ–‡å·¥ç¨‹å˜å¾—å®ç”¨çš„æœºåˆ¶ã€‚
                        ä¸­é—´ä»¶å…è®¸æ‚¨è¿æ¥åˆ° Agent ç”Ÿå‘½å‘¨æœŸçš„ä»»ä½•æ­¥éª¤ï¼Œå¹¶ä¸”ï¼š
                    </p>
                    <ol>
                        <li><strong>æ›´æ–°ä¸Šä¸‹æ–‡</strong> - ä¿®æ”¹çŠ¶æ€å’Œå­˜å‚¨ä»¥æŒä¹…åŒ–æ›´æ”¹ã€æ›´æ–°å¯¹è¯å†å²æˆ–ä¿å­˜è§è§£</li>
                        <li><strong>åœ¨ç”Ÿå‘½å‘¨æœŸä¸­è·³è½¬</strong> - æ ¹æ®ä¸Šä¸‹æ–‡ç§»åŠ¨åˆ° Agent å¾ªç¯çš„ä¸åŒæ­¥éª¤ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶åˆ™è·³è¿‡å·¥å…·æ‰§è¡Œï¼Œä½¿ç”¨ä¿®æ”¹çš„ä¸Šä¸‹æ–‡é‡å¤æ¨¡å‹è°ƒç”¨ï¼‰</li>
                    </ol>

                    <div style="text-align: center; margin: 2rem 0;">
                        <img src="https://mintcdn.com/langchain-5e9cc07a/RAP6mjwE5G00xYsA/oss/images/middleware_final.png?fit=max&auto=format&n=RAP6mjwE5G00xYsA&q=85&s=eb4404b137edec6f6f0c8ccb8323eaf1"
                             alt="Agent å¾ªç¯ä¸­çš„ä¸­é—´ä»¶é’©å­"
                             style="max-width: 500px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);" />
                    </div>

                    <h3 class="subsection-title">ç¤ºä¾‹ï¼šæ‘˜è¦</h3>
                    <p>
                        æœ€å¸¸è§çš„ç”Ÿå‘½å‘¨æœŸæ¨¡å¼ä¹‹ä¸€æ˜¯åœ¨å¯¹è¯å†å²è¿‡é•¿æ—¶è‡ªåŠ¨å‹ç¼©å®ƒã€‚
                        ä¸æ¨¡å‹ä¸Šä¸‹æ–‡ä¸­æ˜¾ç¤ºçš„ç¬æ€æ¶ˆæ¯ä¿®å‰ªä¸åŒï¼Œæ‘˜è¦<strong>æŒä¹…åœ°æ›´æ–°çŠ¶æ€</strong>â€”â€”
                        æ°¸ä¹…åœ°ç”¨æ‘˜è¦æ›¿æ¢æ—§æ¶ˆæ¯ï¼Œè¯¥æ‘˜è¦å°†ä¸ºæ‰€æœ‰æœªæ¥è½®æ¬¡ä¿å­˜ã€‚
                    </p>

                    <p>LangChain ä¸ºæ­¤æä¾›äº†å†…ç½®ä¸­é—´ä»¶ï¼š</p>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">from langchain.agents import create_agent
from langchain.agents.middleware import SummarizationMiddleware

agent = create_agent(
    model="gpt-4o",
    tools=[...],
    middleware=[
        SummarizationMiddleware(
            model="gpt-4o-mini",
            trigger={"tokens": 4000},
            keep={"messages": 20},
        ),
    ],
)</code></pre>
                    </div>

                    <p>å½“å¯¹è¯è¶…è¿‡ Token é™åˆ¶æ—¶ï¼Œ<code>SummarizationMiddleware</code> ä¼šè‡ªåŠ¨ï¼š</p>
                    <ol>
                        <li>ä½¿ç”¨å•ç‹¬çš„ LLM è°ƒç”¨æ‘˜è¦æ—§æ¶ˆæ¯</li>
                        <li>åœ¨ State ä¸­ç”¨æ‘˜è¦æ¶ˆæ¯æ°¸ä¹…æ›¿æ¢å®ƒä»¬</li>
                        <li>ä¿ç•™æœ€è¿‘çš„æ¶ˆæ¯ä»¥æä¾›ä¸Šä¸‹æ–‡</li>
                    </ol>

                    <p>æ‘˜è¦çš„å¯¹è¯å†å²ä¼šæ°¸ä¹…æ›´æ–°â€”â€”æœªæ¥çš„è½®æ¬¡å°†çœ‹åˆ°æ‘˜è¦è€Œä¸æ˜¯åŸå§‹æ¶ˆæ¯ã€‚</p>

                    <div class="info-box note">
                        <div class="info-box-title">ğŸ“š æ›´å¤šä¸­é—´ä»¶èµ„æº</div>
                        <p>
                            æœ‰å…³å†…ç½®ä¸­é—´ä»¶çš„å®Œæ•´åˆ—è¡¨ã€å¯ç”¨é’©å­ä»¥åŠå¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰ä¸­é—´ä»¶ï¼Œ
                            è¯·å‚é˜…<a href="07-middleware.html">ä¸­é—´ä»¶æ–‡æ¡£</a>ã€‚
                        </p>
                    </div>
                </section>

                <!-- æœ€ä½³å®è·µ -->
                <section class="content-section">
                    <h2 class="section-title">æœ€ä½³å®è·µ</h2>
                    <ol>
                        <li><strong>ä»ç®€å•å¼€å§‹</strong> - ä»é™æ€æç¤ºè¯å’Œå·¥å…·å¼€å§‹ï¼Œä»…åœ¨éœ€è¦æ—¶æ·»åŠ åŠ¨æ€æ€§</li>
                        <li><strong>é€æ­¥æµ‹è¯•</strong> - ä¸€æ¬¡æ·»åŠ ä¸€ä¸ªä¸Šä¸‹æ–‡å·¥ç¨‹åŠŸèƒ½</li>
                        <li><strong>ç›‘æ§æ€§èƒ½</strong> - è¿½è¸ªæ¨¡å‹è°ƒç”¨ã€Token ä½¿ç”¨å’Œå»¶è¿Ÿ</li>
                        <li><strong>ä½¿ç”¨å†…ç½®ä¸­é—´ä»¶</strong> - åˆ©ç”¨ <code>SummarizationMiddleware</code>ã€<code>LLMToolSelectorMiddleware</code> ç­‰</li>
                        <li><strong>è®°å½•æ‚¨çš„ä¸Šä¸‹æ–‡ç­–ç•¥</strong> - æ˜ç¡®æ­£åœ¨ä¼ é€’ä»€ä¹ˆä¸Šä¸‹æ–‡ä»¥åŠä¸ºä»€ä¹ˆ</li>
                        <li><strong>ç†è§£ç¬æ€ vs æŒä¹…</strong>ï¼šæ¨¡å‹ä¸Šä¸‹æ–‡æ›´æ”¹æ˜¯ç¬æ€çš„ï¼ˆæ¯æ¬¡è°ƒç”¨ï¼‰ï¼Œè€Œç”Ÿå‘½å‘¨æœŸä¸Šä¸‹æ–‡æ›´æ”¹æŒä¹…åˆ°çŠ¶æ€</li>
                    </ol>
                </section>

                <!-- ç›¸å…³èµ„æº -->
                <section class="content-section">
                    <h2 class="section-title">ç›¸å…³èµ„æº</h2>
                    <ul>
                        <li><a href="07-middleware.html">ä¸­é—´ä»¶ç³»ç»Ÿ</a> - å®Œæ•´çš„ä¸­é—´ä»¶æŒ‡å—</li>
                        <li><a href="05-tools.html">å·¥å…·ç³»ç»Ÿ</a> - å·¥å…·åˆ›å»ºå’Œä¸Šä¸‹æ–‡è®¿é—®</li>
                        <li><a href="14-long-term-memory.html">é•¿æœŸè®°å¿†</a> - çŸ­æœŸå’Œé•¿æœŸè®°å¿†æ¨¡å¼</li>
                        <li><a href="06-agents.html">Agent åŸºç¡€</a> - æ ¸å¿ƒ Agent æ¦‚å¿µ</li>
                        <li><a href="39-best-practices.html">æœ€ä½³å®è·µ</a> - ç”Ÿäº§çº§æœ€ä½³å®è·µ</li>
                    </ul>
                </section>

                <!-- é¡µé¢å¯¼èˆª -->
                <nav class="page-navigation">
                    <a href="15-langgraph.html" class="nav-button prev">
                        â† ä¸Šä¸€é¡µ:LangGraph
                    </a>
                    <a href="17-mcp.html" class="nav-button next">
                        ä¸‹ä¸€é¡µ:MCP åè®® â†’
                    </a>
                </nav>
            </div>
        </main>
    </div>

    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button class="back-to-top" aria-label="è¿”å›é¡¶éƒ¨">â†‘</button>

    <!-- JavaScript -->
    <script src="assets/js/main.js"></script>
</body>
</html>