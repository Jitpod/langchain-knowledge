<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="LangChain 1.0 æ ¸å¿ƒæ¶æ„ - æ·±å…¥ç†è§£ LangChain çš„è®¾è®¡å“²å­¦å’Œæ¨¡å—ç»„ç»‡">
    <title>æ ¸å¿ƒæ¶æ„ | LangChain 1.0 Python çŸ¥è¯†æ–‡æ¡£</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <button class="mobile-menu-button" aria-label="æ‰“å¼€èœå•">â˜°</button>

    <div class="container">
        <!-- ä¾§è¾¹æ å¯¼èˆª -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1 class="sidebar-title">ğŸ¦œ LangChain 1.0</h1>
                <p class="sidebar-subtitle">Python å®Œæ•´å­¦ä¹ æŒ‡å—</p>
            </div>

            <ul class="nav-menu">
                <li class="nav-section">
                    <div class="nav-section-title">å¼€å§‹</div>
                    <ul>
                        <li class="nav-item">
                            <a href="index.html" class="nav-link">
                                <span class="nav-icon">ğŸ </span>
                                ä¸»é¡µ
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">åŸºç¡€ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="01-introduction.html" class="nav-link">
                                <span class="nav-icon">ğŸ“–</span>
                                LangChain ç®€ä»‹
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="02-architecture.html" class="nav-link">
                                <span class="nav-icon">ğŸ—ï¸</span>
                                æ ¸å¿ƒæ¶æ„
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="03-models.html" class="nav-link">
                                <span class="nav-icon">ğŸ¤–</span>
                                æ¨¡å‹æ¥å£
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="04-messages.html" class="nav-link">
                                <span class="nav-icon">ğŸ’¬</span>
                                æ¶ˆæ¯ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="05-tools.html" class="nav-link">
                                <span class="nav-icon">ğŸ”§</span>
                                å·¥å…·ç³»ç»Ÿ
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">è¿›é˜¶ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="06-agents.html" class="nav-link">
                                <span class="nav-icon">ğŸ¯</span>
                                Agent åŸºç¡€
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="07-middleware.html" class="nav-link">
                                <span class="nav-icon">âš™ï¸</span>
                                ä¸­é—´ä»¶ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="08-rag.html" class="nav-link">
                                <span class="nav-icon">ğŸ”</span>
                                RAG è¯¦è§£
                                <span class="nav-badge">é‡ç‚¹</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="09-lcel.html" class="nav-link">
                                <span class="nav-icon">ğŸ”—</span>
                                LCEL è¡¨è¾¾å¼
                            </a>
                        </li>
                    </ul>
                </li>

                                <li class="nav-section">
                    <div class="nav-section-title">é«˜çº§åº”ç”¨</div>
                    <ul>
                        <li class="nav-item">
                            <a href="10-runtime.html" class="nav-link">
                                <span class="nav-icon">ğŸ”Œ</span>
                                Runtime ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="11-checkpointer.html" class="nav-link">
                                <span class="nav-icon">ğŸ’¾</span>
                                æŒä¹…åŒ–ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="12-streaming.html" class="nav-link">
                                <span class="nav-icon">ğŸŒŠ</span>
                                æµå¼è¾“å‡º
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="13-human-in-loop.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¤</span>
                                äººå·¥ä»‹å…¥
                            </a>
                        </li>
                        <li class="nav-item active">
                            <a href="14-long-term-memory.html" class="nav-link">
                                <span class="nav-icon">ğŸ—„ï¸</span>
                                é•¿æœŸè®°å¿†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="15-langgraph.html" class="nav-link">
                                <span class="nav-icon">ğŸ“Š</span>
                                LangGraph
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="16-context-engineering.html" class="nav-link">
                                <span class="nav-icon">ğŸ¯</span>
                                ä¸Šä¸‹æ–‡å·¥ç¨‹
                                <span class="nav-badge">é‡ç‚¹</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="17-mcp.html" class="nav-link">
                                <span class="nav-icon">ğŸ”Œ</span>
                                MCP åè®®
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">å®æˆ˜ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="18-customer-service.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¥</span>
                                å®¢æœæœºå™¨äºº
                                <span class="nav-badge">é‡ç‚¹</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="19-best-practices.html" class="nav-link">
                                <span class="nav-icon">âœ¨</span>
                                æœ€ä½³å®è·µ
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">å‚è€ƒç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="20-api-reference.html" class="nav-link">
                                <span class="nav-icon">ğŸ“š</span>
                                API é€ŸæŸ¥è¡¨
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="21-troubleshooting.html" class="nav-link">
                                <span class="nav-icon">ğŸ›</span>
                                æ•…éšœæ’é™¤
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="22-migration.html" class="nav-link">
                                <span class="nav-icon">ğŸ”„</span>
                                è¿ç§»æŒ‡å—
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">æ‰©å±•ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="23-structured-output.html" class="nav-link">
                                <span class="nav-icon">ğŸ“Š</span>
                                ç»“æ„åŒ–è¾“å‡º
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">DeepAgents ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="24-deepagents-quickstart.html" class="nav-link">
                                <span class="nav-icon">ğŸš€</span>
                                å¿«é€Ÿå¼€å§‹
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="25-deepagents-customization.html" class="nav-link">
                                <span class="nav-icon">ğŸ¨</span>
                                å®šåˆ¶åŒ–
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="26-deepagents-harness.html" class="nav-link">
                                <span class="nav-icon">ğŸ›ï¸</span>
                                Harness ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="27-deepagents-backends.html" class="nav-link">
                                <span class="nav-icon">ğŸ”§</span>
                                åç«¯é…ç½®
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="28-deepagents-subagents.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¥</span>
                                å­ä»£ç†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="29-deepagents-hitl.html" class="nav-link">
                                <span class="nav-icon">ğŸ¤</span>
                                äººå·¥ä»‹å…¥
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="30-deepagents-memory.html" class="nav-link">
                                <span class="nav-icon">ğŸ§ </span>
                                é•¿æœŸè®°å¿†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="31-deepagents-middleware.html" class="nav-link">
                                <span class="nav-icon">âš™ï¸</span>
                                ä¸­é—´ä»¶
                            </a>
                        </li>
                    </ul>
                </li>


                                <li class="nav-section">
                    <div class="nav-section-title">Multi-Agent ç¯‡</div>
                    <ul>
                        <li class="nav-item">
                            <a href="32-multi-agent-index.html" class="nav-link">
                                <span class="nav-icon">ğŸŒ</span>
                                æ¦‚è¿°
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="33-multi-agent-subagents.html" class="nav-link">
                                <span class="nav-icon">ğŸ‘¥</span>
                                å­ä»£ç†
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="34-multi-agent-handoffs.html" class="nav-link">
                                <span class="nav-icon">ğŸ”„</span>
                                äº¤æ¥æœºåˆ¶
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="35-multi-agent-skills.html" class="nav-link">
                                <span class="nav-icon">ğŸ¯</span>
                                æŠ€èƒ½ç³»ç»Ÿ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="36-multi-agent-router.html" class="nav-link">
                                <span class="nav-icon">ğŸ§­</span>
                                è·¯ç”±æœºåˆ¶
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="37-multi-agent-workflow.html" class="nav-link">
                                <span class="nav-icon">ğŸ”€</span>
                                è‡ªå®šä¹‰å·¥ä½œæµ
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <div class="content-wrapper">
                <!-- é¢åŒ…å±‘å¯¼èˆª -->
                <nav class="breadcrumb">
                    <span class="breadcrumb-item">
                        <a href="index.html" class="breadcrumb-link">ä¸»é¡µ</a>
                    </span>
                    <span class="breadcrumb-item">
                        é«˜çº§åº”ç”¨
                    </span>
                    <span class="breadcrumb-item">
                        é•¿æœŸè®°å¿†
                    </span>
                </nav>

                <!-- é¡µé¢æ ‡é¢˜ -->
                <header class="page-header">
                    <h1 class="page-title">ğŸ—„ï¸ Long-term Memoryï¼ˆé•¿æœŸè®°å¿†ï¼‰</h1>
                    <p class="page-subtitle">
                        æŒæ¡ LangChain 1.0 çš„ Store å­˜å‚¨ç³»ç»Ÿï¼Œå®ç°è·¨ä¼šè¯çš„æŒä¹…åŒ–è®°å¿†ï¼Œ
                        æ„å»ºèƒ½å¤Ÿè®°ä½ç”¨æˆ·åå¥½ã€å†å²äº¤äº’å’Œä¸ªæ€§åŒ–ä¿¡æ¯çš„æ™ºèƒ½ AI Agentã€‚
                    </p>
                </header>

                <!-- é•¿æœŸè®°å¿†ç®€ä»‹ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ“š ä»€ä¹ˆæ˜¯é•¿æœŸè®°å¿†ï¼Ÿ</h2>
                    <p>
                        <strong>Long-term Memoryï¼ˆé•¿æœŸè®°å¿†ï¼‰</strong>æ˜¯ AI Agent è·¨ä¼šè¯ä¿å­˜å’Œæ£€ç´¢ä¿¡æ¯çš„èƒ½åŠ›ã€‚
                        ä¸çŸ­æœŸè®°å¿†ï¼ˆCheckpointerï¼‰ä¸åŒï¼Œé•¿æœŸè®°å¿†ä¸“æ³¨äºå­˜å‚¨<strong>ç»“æ„åŒ–çš„æŒä¹…æ•°æ®</strong>ï¼Œ
                        å¦‚ç”¨æˆ·åå¥½ã€å†å²è¡Œä¸ºã€çŸ¥è¯†åº“ç­‰ã€‚
                    </p>

                    <div class="info-box note">
                        <div class="info-box-title">ğŸ’¡ é•¿æœŸè®°å¿† vs çŸ­æœŸè®°å¿†</div>
                        <table style="margin-top: 0.5rem;">
                            <thead>
                                <tr>
                                    <th>ç‰¹æ€§</th>
                                    <th>çŸ­æœŸè®°å¿†ï¼ˆCheckpointerï¼‰</th>
                                    <th>é•¿æœŸè®°å¿†ï¼ˆStoreï¼‰</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>ç”¨é€”</strong></td>
                                    <td>å¯¹è¯å†å²ã€ä¼šè¯çŠ¶æ€</td>
                                    <td>ç”¨æˆ·åå¥½ã€çŸ¥è¯†åº“ã€æŒä¹…æ•°æ®</td>
                                </tr>
                                <tr>
                                    <td><strong>æ•°æ®ç»“æ„</strong></td>
                                    <td>æ¶ˆæ¯åˆ—è¡¨ã€çŠ¶æ€å­—å…¸</td>
                                    <td>JSON æ–‡æ¡£</td>
                                </tr>
                                <tr>
                                    <td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td>
                                    <td>å•æ¬¡ä¼šè¯æˆ–ç›¸å…³ä¼šè¯</td>
                                    <td>è·¨ä¼šè¯ã€é•¿æœŸä¿å­˜</td>
                                </tr>
                                <tr>
                                    <td><strong>æ£€ç´¢æ–¹å¼</strong></td>
                                    <td>æŒ‰ thread_id åŠ è½½</td>
                                    <td>æŒ‰ namespace + key æˆ–æœç´¢</td>
                                </tr>
                                <tr>
                                    <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
                                    <td>å¤šè½®å¯¹è¯ã€ä¸Šä¸‹æ–‡ç†è§£</td>
                                    <td>ä¸ªæ€§åŒ–ã€ç”¨æˆ·ç”»åƒã€åŠ¨æ€çŸ¥è¯†</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3 class="subsection-title">å…¸å‹åº”ç”¨åœºæ™¯</h3>
                    <ul>
                        <li><strong>ç”¨æˆ·åå¥½</strong>ï¼šè¯­è¨€ã€ä¸»é¢˜ã€é€šçŸ¥è®¾ç½®</li>
                        <li><strong>ç”¨æˆ·ç”»åƒ</strong>ï¼šå…´è¶£ã€è¡Œä¸ºå†å²ã€è®¢é˜…ä¿¡æ¯</li>
                        <li><strong>åŠ¨æ€çŸ¥è¯†åº“</strong>ï¼šä¸æ–­æ›´æ–°çš„ä¸šåŠ¡çŸ¥è¯†ã€FAQ</li>
                        <li><strong>è·¨ä¼šè¯ä¸Šä¸‹æ–‡</strong>ï¼šç”¨æˆ·ä¹‹å‰çš„é—®é¢˜ã€æœªå®Œæˆçš„ä»»åŠ¡</li>
                        <li><strong>ä¸ªæ€§åŒ–æ¨è</strong>ï¼šåŸºäºå†å²äº¤äº’çš„æ™ºèƒ½å»ºè®®</li>
                    </ul>
                </section>

                <!-- Store æ¶æ„ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ—ï¸ Store å­˜å‚¨æ¶æ„</h2>

                    <div class="mermaid-wrapper">
                        <div class="mermaid">
graph TB
    A[Agent è°ƒç”¨] --> B{éœ€è¦è®¿é—®é•¿æœŸè®°å¿†ï¼Ÿ}
    B -->|æ˜¯| C[å·¥å…·é€šè¿‡ ToolRuntime è®¿é—®]

    C --> D[Store.get/put/search]

    D --> E{æ“ä½œç±»å‹}

    E -->|get| F[æŒ‰ Namespace + Key è¯»å–]
    E -->|put| G[æŒ‰ Namespace + Key å†™å…¥]
    E -->|search| H[è·¨ Namespace æœç´¢]
    E -->|delete| I[åˆ é™¤ç‰¹å®šè®°å¿†]

    F --> J[è¿”å› StoreValue å¯¹è±¡]
    G --> K[æ›´æ–°å­˜å‚¨]
    H --> L[è¿”å›åŒ¹é…ç»“æœåˆ—è¡¨]
    I --> K

    J --> M[å·¥å…·è¿”å›ç»“æœ]
    K --> M
    L --> M

    M --> N[Agent ç»§ç»­æ‰§è¡Œ]

    subgraph "Store å­˜å‚¨å±‚"
        O[InMemoryStore]
        P[PostgresStore]
        Q[è‡ªå®šä¹‰ Store]
    end

    D -.ä½¿ç”¨.-> O
    D -.ä½¿ç”¨.-> P
    D -.ä½¿ç”¨.-> Q

    style D fill:#3b82f6,color:#fff
    style J fill:#10b981,color:#fff
    style K fill:#f59e0b,color:#fff
    style L fill:#8b5cf6,color:#fff
                        </div>
                    </div>

                    <h3 class="subsection-title">æ ¸å¿ƒæ¦‚å¿µ</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>æ¦‚å¿µ</th>
                                <th>è¯´æ˜</th>
                                <th>ç¤ºä¾‹</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Namespace</strong></td>
                                <td>å±‚çº§åŒ–å‘½åç©ºé—´ï¼ˆå…ƒç»„ï¼‰</td>
                                <td><code>("users",)</code>, <code>("users", "preferences")</code></td>
                            </tr>
                            <tr>
                                <td><strong>Key</strong></td>
                                <td>å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆå­—ç¬¦ä¸²ï¼‰</td>
                                <td><code>"user_123"</code>, <code>"en-us"</code></td>
                            </tr>
                            <tr>
                                <td><strong>Value</strong></td>
                                <td>JSON å¯åºåˆ—åŒ–çš„æ•°æ®</td>
                                <td><code>{"name": "å¼ ä¸‰", "language": "zh-CN"}</code></td>
                            </tr>
                            <tr>
                                <td><strong>StoreValue</strong></td>
                                <td>å­˜å‚¨å¯¹è±¡ï¼ŒåŒ…å« value å’Œ metadata</td>
                                <td><code>StoreValue(value={...}, metadata={...})</code></td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <!-- InMemoryStore åŸºç¡€ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ§ª InMemoryStore - å¼€å‘æµ‹è¯•</h2>
                    <p>
                        <code>InMemoryStore</code> æ˜¯å†…å­˜å­˜å‚¨å®ç°ï¼Œé€‚åˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒã€‚
                        ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨æ•°æ®åº“æ”¯æŒçš„ Storeï¼ˆå¦‚ PostgresStoreï¼‰ã€‚
                    </p>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty basic">ğŸŸ¢ åŸºç¡€</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
InMemoryStore åŸºç¡€ä½¿ç”¨
åŠŸèƒ½ï¼šåˆ›å»ºå†…å­˜å­˜å‚¨å¹¶æ‰§è¡ŒåŸºæœ¬æ“ä½œ
"""
from langgraph.store.memory import InMemoryStore

# å®šä¹‰åµŒå…¥å‡½æ•°ï¼ˆç”¨äºå‘é‡æœç´¢ï¼‰
def embed(texts: list[str]) -> list[list[float]]:
    """ç®€å•çš„åµŒå…¥å‡½æ•°ï¼ˆç”Ÿäº§ç¯å¢ƒä½¿ç”¨çœŸå®æ¨¡å‹ï¼‰"""
    return [[1.0, 2.0, 3.0] for _ in texts]

# åˆ›å»º Store
store = InMemoryStore(
    index={
        "embed": embed,  # åµŒå…¥å‡½æ•°
        "dims": 3        # å‘é‡ç»´åº¦
    }
)

# å­˜å‚¨ç”¨æˆ·ä¿¡æ¯
store.put(
    ("users",),           # Namespaceï¼ˆå…ƒç»„ï¼‰
    "user_123",          # Key
    {                    # Valueï¼ˆJSON å¯åºåˆ—åŒ–ï¼‰
        "name": "å¼ ä¸‰",
        "language": "zh-CN",
        "preferences": {
            "theme": "dark",
            "notifications": True
        }
    }
)

# è¯»å–ç”¨æˆ·ä¿¡æ¯
user_info = store.get(("users",), "user_123")

if user_info:
    print(f"ç”¨æˆ·å: {user_info.value['name']}")
    print(f"è¯­è¨€: {user_info.value['language']}")
    print(f"ä¸»é¢˜: {user_info.value['preferences']['theme']}")
else:
    print("ç”¨æˆ·ä¸å­˜åœ¨")</code></pre>
                    </div>

                    <div class="info-box warning">
                        <div class="info-box-title">âš ï¸ InMemoryStore é™åˆ¶</div>
                        <p>
                            InMemoryStore ä»…å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œåº”ç”¨é‡å¯åæ‰€æœ‰æ•°æ®ä¸¢å¤±ã€‚
                            <strong>ä»…ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨ã€‚</strong>
                        </p>
                    </div>
                </section>

                <!-- æ ¸å¿ƒ API -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ”§ æ ¸å¿ƒ API è¯¦è§£</h2>

                    <h3 class="subsection-title">1. put() - å†™å…¥æ•°æ®</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty basic">ğŸŸ¢ åŸºç¡€</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
put() æ–¹æ³•ï¼šå†™å…¥æˆ–æ›´æ–°æ•°æ®
"""
from langgraph.store.memory import InMemoryStore

store = InMemoryStore()

# å†™å…¥ç”¨æˆ·åå¥½
store.put(
    ("users", "preferences"),  # Namespaceï¼ˆå¯ä»¥æ˜¯å¤šå±‚ï¼‰
    "user_123",               # Key
    {
        "language": "zh-CN",
        "timezone": "Asia/Shanghai",
        "email_notifications": True
    }
)

# å†™å…¥è®¢å•å†å²
store.put(
    ("users", "orders"),
    "user_123",
    {
        "orders": [
            {"id": "ORDER-001", "product": "iPhone 15"},
            {"id": "ORDER-002", "product": "AirPods"}
        ],
        "total_spent": 15000.0
    }
)

print("âœ… æ•°æ®å†™å…¥æˆåŠŸ")</code></pre>
                    </div>

                    <h3 class="subsection-title">2. get() - è¯»å–æ•°æ®</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty basic">ğŸŸ¢ åŸºç¡€</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
get() æ–¹æ³•ï¼šè¯»å–ç‰¹å®š Key çš„æ•°æ®
"""
# è¯»å–ç”¨æˆ·åå¥½
preferences = store.get(("users", "preferences"), "user_123")

if preferences:
    print(f"è¯­è¨€: {preferences.value['language']}")
    print(f"æ—¶åŒº: {preferences.value['timezone']}")
    print(f"é‚®ä»¶é€šçŸ¥: {preferences.value['email_notifications']}")

    # è®¿é—®å…ƒæ•°æ®
    print(f"åˆ›å»ºæ—¶é—´: {preferences.created_at}")
    print(f"æ›´æ–°æ—¶é—´: {preferences.updated_at}")
else:
    print("æœªæ‰¾åˆ°ç”¨æˆ·åå¥½")</code></pre>
                    </div>

                    <h3 class="subsection-title">3. search() - æœç´¢æ•°æ®</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
search() æ–¹æ³•ï¼šè·¨ Namespace æœç´¢æ•°æ®
åŠŸèƒ½ï¼šæ”¯æŒè¿‡æ»¤å’Œå‘é‡ç›¸ä¼¼åº¦æœç´¢
"""
# ç¤ºä¾‹ 1ï¼šä½¿ç”¨è¿‡æ»¤æ¡ä»¶æœç´¢
results = store.search(
    ("users", "preferences"),
    filter={"language": "zh-CN"}  # è¿‡æ»¤æ¡ä»¶
)

print(f"æ‰¾åˆ° {len(results)} ä¸ªä¸­æ–‡ç”¨æˆ·")
for item in results:
    print(f"- ç”¨æˆ· {item.key}: {item.value}")

# ç¤ºä¾‹ 2ï¼šå‘é‡ç›¸ä¼¼åº¦æœç´¢
results = store.search(
    ("knowledge_base",),
    query="å¦‚ä½•é‡ç½®å¯†ç ï¼Ÿ",  # æŸ¥è¯¢å­—ç¬¦ä¸²
    limit=5                  # è¿”å›æœ€ç›¸å…³çš„ 5 ä¸ªç»“æœ
)

for i, item in enumerate(results):
    print(f"\nç»“æœ {i+1}:")
    print(f"  Key: {item.key}")
    print(f"  å†…å®¹: {item.value}")
    # print(f"  ç›¸ä¼¼åº¦: {item.score}")</code></pre>
                    </div>

                    <h3 class="subsection-title">4. delete() - åˆ é™¤æ•°æ®</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty basic">ğŸŸ¢ åŸºç¡€</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
delete() æ–¹æ³•ï¼šåˆ é™¤ç‰¹å®šæ•°æ®
"""
# åˆ é™¤ç”¨æˆ·çš„è®¢å•å†å²
store.delete(("users", "orders"), "user_123")

# éªŒè¯åˆ é™¤
orders = store.get(("users", "orders"), "user_123")
if orders is None:
    print("âœ… è®¢å•å†å²å·²åˆ é™¤")</code></pre>
                    </div>
                </section>

                <!-- ä¸ Agent é›†æˆ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ”— ä¸ Agent Runtime é›†æˆ</h2>
                    <p>
                        é€šè¿‡ <code>ToolRuntime</code>ï¼Œå·¥å…·å¯ä»¥è®¿é—® Store æ¥è¯»å†™é•¿æœŸè®°å¿†ã€‚
                    </p>

                    <h3 class="subsection-title">è¯»å–é•¿æœŸè®°å¿†</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
å·¥å…·ä¸­è¯»å–é•¿æœŸè®°å¿†ç¤ºä¾‹
åŠŸèƒ½ï¼šæ ¹æ®ç”¨æˆ· ID æŸ¥è¯¢ç”¨æˆ·åå¥½
"""
from langchain.tools import tool, ToolRuntime
from langchain.agents import create_agent, AgentState
from langgraph.store.memory import InMemoryStore
from typing_extensions import TypedDict

# å®šä¹‰ä¸Šä¸‹æ–‡ Schema
class Context(TypedDict):
    user_id: str

@tool
def get_user_language(runtime: ToolRuntime[Context]) -> str:
    """è·å–ç”¨æˆ·çš„è¯­è¨€åå¥½"""
    # ä» Runtime è·å– Store
    store = runtime.store

    # ä» Context è·å– user_id
    user_id = runtime.context["user_id"]

    # è¯»å–ç”¨æˆ·åå¥½
    preferences = store.get(("users", "preferences"), user_id)

    if preferences:
        language = preferences.value.get("language", "en-US")
        return f"ç”¨æˆ· {user_id} çš„è¯­è¨€åå¥½æ˜¯: {language}"
    else:
        return f"ç”¨æˆ· {user_id} æ²¡æœ‰è®¾ç½®è¯­è¨€åå¥½"

# åˆ›å»º Store
store = InMemoryStore()

# é¢„å…ˆå­˜å‚¨ä¸€äº›æ•°æ®
store.put(
    ("users", "preferences"),
    "user_123",
    {"language": "zh-CN", "theme": "dark"}
)

# åˆ›å»º Agent
agent = create_agent(
    model="gpt-4o",
    tools=[get_user_language],
    store=store,               # ä¼ é€’ Store
    context_schema=Context     # ä¼ é€’ Context Schema
)

# è°ƒç”¨ Agentï¼ˆæä¾› contextï¼‰
result = agent.invoke(
    {
        "messages": [{"role": "user", "content": "æŸ¥è¯¢æˆ‘çš„è¯­è¨€è®¾ç½®"}]
    },
    {
        "context": {"user_id": "user_123"}
    }
)

print(result["messages"][-1].content)</code></pre>
                    </div>

                    <h3 class="subsection-title">å†™å…¥é•¿æœŸè®°å¿†</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty intermediate">ğŸŸ¡ ä¸­çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
å·¥å…·ä¸­å†™å…¥é•¿æœŸè®°å¿†ç¤ºä¾‹
åŠŸèƒ½ï¼šä¿å­˜ç”¨æˆ·åå¥½è®¾ç½®
"""
from langchain.tools import tool, ToolRuntime
from typing_extensions import TypedDict

class UserPreferences(TypedDict):
    language: str
    theme: str
    notifications: bool

@tool
def save_user_preferences(
    preferences: UserPreferences,
    runtime: ToolRuntime[Context]
) -> str:
    """ä¿å­˜ç”¨æˆ·åå¥½è®¾ç½®"""
    store = runtime.store
    user_id = runtime.context["user_id"]

    # å†™å…¥ Store
    store.put(
        ("users", "preferences"),
        user_id,
        preferences
    )

    return f"æˆåŠŸä¿å­˜ç”¨æˆ· {user_id} çš„åå¥½è®¾ç½®"

@tool
def get_user_preferences(runtime: ToolRuntime[Context]) -> str:
    """è·å–ç”¨æˆ·åå¥½è®¾ç½®"""
    store = runtime.store
    user_id = runtime.context["user_id"]

    preferences = store.get(("users", "preferences"), user_id)

    if preferences:
        prefs = preferences.value
        return f"""
        è¯­è¨€: {prefs.get('language', 'æœªè®¾ç½®')}
        ä¸»é¢˜: {prefs.get('theme', 'æœªè®¾ç½®')}
        é€šçŸ¥: {'å¼€å¯' if prefs.get('notifications') else 'å…³é—­'}
        """
    else:
        return "æœªæ‰¾åˆ°ç”¨æˆ·åå¥½è®¾ç½®"

# åˆ›å»ºæ”¯æŒè¯»å†™çš„ Agent
agent = create_agent(
    model="gpt-4o",
    tools=[save_user_preferences, get_user_preferences],
    store=store,
    context_schema=Context
)

# ä¿å­˜åå¥½
result1 = agent.invoke(
    {
        "messages": [{
            "role": "user",
            "content": "å¸®æˆ‘è®¾ç½®ï¼šè¯­è¨€ä¸­æ–‡ã€æ·±è‰²ä¸»é¢˜ã€å¼€å¯é€šçŸ¥"
        }]
    },
    {"context": {"user_id": "user_456"}}
)

# æŸ¥è¯¢åå¥½
result2 = agent.invoke(
    {
        "messages": [{"role": "user", "content": "æŸ¥è¯¢æˆ‘çš„åå¥½è®¾ç½®"}]
    },
    {"context": {"user_id": "user_456"}}
)

print(result2["messages"][-1].content)</code></pre>
                    </div>
                </section>

                <!-- Namespace è®¾è®¡æ¨¡å¼ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ—‚ï¸ Namespace è®¾è®¡æ¨¡å¼</h2>
                    <p>
                        åˆç†çš„ Namespace è®¾è®¡èƒ½å¤Ÿå®ç°é«˜æ•ˆçš„æ•°æ®ç»„ç»‡å’Œæ£€ç´¢ã€‚
                    </p>

                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty advanced">ğŸ”´ é«˜çº§</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
Namespace è®¾è®¡æ¨¡å¼ç¤ºä¾‹
åŠŸèƒ½ï¼šæ¼”ç¤ºä¸åŒçš„å‘½åç©ºé—´ç»„ç»‡æ–¹å¼
"""
from langgraph.store.memory import InMemoryStore

store = InMemoryStore()

# æ¨¡å¼ 1ï¼šæŒ‰ç”¨æˆ·ç»„ç»‡
store.put(
    ("users", "user_123", "profile"),
    "basic_info",
    {"name": "å¼ ä¸‰", "email": "zhang@example.com"}
)

store.put(
    ("users", "user_123", "preferences"),
    "settings",
    {"language": "zh-CN", "theme": "dark"}
)

# æ¨¡å¼ 2ï¼šæŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡
store.put(
    ("orders", "user_123"),
    "ORDER-001",
    {"product": "iPhone 15", "status": "shipped"}
)

store.put(
    ("orders", "user_123"),
    "ORDER-002",
    {"product": "MacBook Pro", "status": "processing"}
)

# æ¨¡å¼ 3ï¼šæŒ‰æ—¶é—´ç»„ç»‡
from datetime import datetime
today = datetime.now().strftime("%Y-%m-%d")

store.put(
    ("analytics", "daily", today),
    "user_123",
    {"visits": 5, "actions": 12}
)

# æ¨¡å¼ 4ï¼šå¤šç§Ÿæˆ·ç»„ç»‡
store.put(
    ("tenants", "company_A", "users"),
    "user_001",
    {"name": "å‘˜å·¥A", "role": "admin"}
)

store.put(
    ("tenants", "company_B", "users"),
    "user_001",
    {"name": "å‘˜å·¥B", "role": "viewer"}
)

# æŸ¥è¯¢ç¤ºä¾‹ï¼šè·å–ç”¨æˆ·çš„æ‰€æœ‰è®¢å•
orders = store.search(("orders", "user_123"))
print(f"ç”¨æˆ·æœ‰ {len(orders)} ä¸ªè®¢å•")
for order in orders:
    print(f"- {order.key}: {order.value['product']}")</code></pre>
                    </div>

                    <div class="info-box tip">
                        <div class="info-box-title">âœ… Namespace è®¾è®¡å»ºè®®</div>
                        <ul>
                            <li><strong>å±‚çº§æ¸…æ™°</strong>ï¼šä½¿ç”¨å…ƒç»„è¡¨ç¤ºå±‚çº§å…³ç³»ï¼Œå¦‚ <code>("users", user_id, "preferences")</code></li>
                            <li><strong>ä¸€è‡´æ€§</strong>ï¼šä¿æŒç›¸åŒç±»å‹æ•°æ®çš„ Namespace ç»“æ„ä¸€è‡´</li>
                            <li><strong>å¯æ‰©å±•</strong>ï¼šé¢„ç•™æ‰©å±•ç©ºé—´ï¼Œé¿å…é¢‘ç¹é‡æ„</li>
                            <li><strong>éš”ç¦»æ€§</strong>ï¼šä¸åŒç§Ÿæˆ·æˆ–ä¸šåŠ¡ä½¿ç”¨ä¸åŒçš„é¡¶å±‚ Namespace</li>
                            <li><strong>è¯­ä¹‰åŒ–</strong>ï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°ï¼Œæ–¹ä¾¿ç†è§£å’Œç»´æŠ¤</li>
                        </ul>
                    </div>
                </section>

                <!-- å®Œæ•´ç¤ºä¾‹ -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ¯ å®Œæ•´ç¤ºä¾‹ï¼šä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ</h2>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <span class="code-difficulty advanced">ğŸ”´ é«˜çº§ - å®Œæ•´é¡¹ç›®</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python">"""
ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿå®Œæ•´ç¤ºä¾‹
åŠŸèƒ½ï¼šåŸºäºç”¨æˆ·å†å²è¡Œä¸ºå’Œåå¥½ï¼Œæä¾›æ™ºèƒ½æ¨è
"""
from langchain.agents import create_agent
from langchain.tools import tool, ToolRuntime
from langgraph.store.memory import InMemoryStore
from typing_extensions import TypedDict
from datetime import datetime
import json

# ==================== ä¸Šä¸‹æ–‡å®šä¹‰ ====================

class Context(TypedDict):
    user_id: str
    session_id: str

# ==================== åˆå§‹åŒ– Store ====================

store = InMemoryStore()

# é¢„ç½®ä¸€äº›ç”¨æˆ·æ•°æ®
store.put(
    ("users", "user_001", "profile"),
    "basic",
    {
        "name": "å¼ ä¸‰",
        "email": "zhang@example.com",
        "joined_date": "2024-01-15"
    }
)

store.put(
    ("users", "user_001", "preferences"),
    "settings",
    {
        "language": "zh-CN",
        "categories": ["ç”µå­äº§å“", "å›¾ä¹¦", "è¿åŠ¨"],
        "price_range": {"min": 100, "max": 5000}
    }
)

store.put(
    ("users", "user_001", "history"),
    "browsed_products",
    {
        "products": [
            {"id": "P001", "name": "iPhone 15", "category": "ç”µå­äº§å“", "viewed_at": "2024-12-20"},
            {"id": "P002", "name": "Python ç¼–ç¨‹", "category": "å›¾ä¹¦", "viewed_at": "2024-12-21"},
            {"id": "P003", "name": "è·‘æ­¥é‹", "category": "è¿åŠ¨", "viewed_at": "2024-12-22"}
        ]
    }
)

store.put(
    ("users", "user_001", "history"),
    "purchased_products",
    {
        "products": [
            {"id": "P002", "name": "Python ç¼–ç¨‹", "price": 89, "purchased_at": "2024-12-21"}
        ],
        "total_spent": 89
    }
)

# ==================== å·¥å…·å®šä¹‰ ====================

@tool
def get_user_profile(runtime: ToolRuntime[Context]) -> str:
    """è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯"""
    store = runtime.store
    user_id = runtime.context["user_id"]

    profile = store.get(("users", user_id, "profile"), "basic")

    if profile:
        info = profile.value
        return f"""
        ç”¨æˆ·å§“åï¼š{info['name']}
        é‚®ç®±ï¼š{info['email']}
        æ³¨å†Œæ—¶é—´ï¼š{info['joined_date']}
        """
    else:
        return "æœªæ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯"

@tool
def get_user_preferences(runtime: ToolRuntime[Context]) -> str:
    """è·å–ç”¨æˆ·åå¥½è®¾ç½®"""
    store = runtime.store
    user_id = runtime.context["user_id"]

    prefs = store.get(("users", user_id, "preferences"), "settings")

    if prefs:
        data = prefs.value
        return f"""
        åå¥½è¯­è¨€ï¼š{data['language']}
        æ„Ÿå…´è¶£çš„ç±»åˆ«ï¼š{', '.join(data['categories'])}
        ä»·æ ¼èŒƒå›´ï¼š{data['price_range']['min']} - {data['price_range']['max']} å…ƒ
        """
    else:
        return "æœªæ‰¾åˆ°ç”¨æˆ·åå¥½"

@tool
def get_browsing_history(runtime: ToolRuntime[Context]) -> str:
    """æŸ¥è¯¢ç”¨æˆ·æµè§ˆå†å²"""
    store = runtime.store
    user_id = runtime.context["user_id"]

    history = store.get(("users", user_id, "history"), "browsed_products")

    if history:
        products = history.value["products"]
        result = "æœ€è¿‘æµè§ˆçš„å•†å“ï¼š\n"
        for p in products[-5:]:  # æœ€è¿‘5ä¸ª
            result += f"- {p['name']} ({p['category']}) - {p['viewed_at']}\n"
        return result
    else:
        return "æš‚æ— æµè§ˆå†å²"

@tool
def get_purchase_history(runtime: ToolRuntime[Context]) -> str:
    """æŸ¥è¯¢ç”¨æˆ·è´­ä¹°å†å²"""
    store = runtime.store
    user_id = runtime.context["user_id"]

    purchases = store.get(("users", user_id, "history"), "purchased_products")

    if purchases:
        data = purchases.value
        products = data["products"]
        result = f"è´­ä¹°è®°å½•ï¼ˆæ€»æ¶ˆè´¹ï¼šÂ¥{data['total_spent']}ï¼‰ï¼š\n"
        for p in products:
            result += f"- {p['name']} - Â¥{p['price']} - {p['purchased_at']}\n"
        return result
    else:
        return "æš‚æ— è´­ä¹°è®°å½•"

@tool
def record_product_view(
    product_id: str,
    product_name: str,
    category: str,
    runtime: ToolRuntime[Context]
) -> str:
    """è®°å½•ç”¨æˆ·æµè§ˆå•†å“"""
    store = runtime.store
    user_id = runtime.context["user_id"]

    # è·å–ç°æœ‰å†å²
    history = store.get(("users", user_id, "history"), "browsed_products")

    if history:
        products = history.value["products"]
    else:
        products = []

    # æ·»åŠ æ–°è®°å½•
    products.append({
        "id": product_id,
        "name": product_name,
        "category": category,
        "viewed_at": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    })

    # ä¿ç•™æœ€è¿‘ 50 æ¡
    products = products[-50:]

    # æ›´æ–°å­˜å‚¨
    store.put(
        ("users", user_id, "history"),
        "browsed_products",
        {"products": products}
    )

    return f"å·²è®°å½•æµè§ˆï¼š{product_name}"

@tool
def update_user_preferences(
    categories: list[str],
    runtime: ToolRuntime[Context]
) -> str:
    """æ›´æ–°ç”¨æˆ·åå¥½ç±»åˆ«"""
    store = runtime.store
    user_id = runtime.context["user_id"]

    # è·å–ç°æœ‰åå¥½
    prefs = store.get(("users", user_id, "preferences"), "settings")

    if prefs:
        current = prefs.value
        current["categories"] = categories
    else:
        current = {
            "language": "zh-CN",
            "categories": categories,
            "price_range": {"min": 0, "max": 10000}
        }

    # æ›´æ–°å­˜å‚¨
    store.put(
        ("users", user_id, "preferences"),
        "settings",
        current
    )

    return f"å·²æ›´æ–°åå¥½ç±»åˆ«ä¸ºï¼š{', '.join(categories)}"

@tool
def get_personalized_recommendations(runtime: ToolRuntime[Context]) -> str:
    """åŸºäºç”¨æˆ·å†å²ç”Ÿæˆä¸ªæ€§åŒ–æ¨è"""
    store = runtime.store
    user_id = runtime.context["user_id"]

    # è·å–ç”¨æˆ·åå¥½
    prefs = store.get(("users", user_id, "preferences"), "settings")

    # è·å–æµè§ˆå†å²
    history = store.get(("users", user_id, "history"), "browsed_products")

    if not prefs:
        return "æ— æ³•ç”Ÿæˆæ¨èï¼šæœªæ‰¾åˆ°ç”¨æˆ·åå¥½"

    categories = prefs.value.get("categories", [])

    # ç®€åŒ–çš„æ¨èé€»è¾‘ï¼ˆå®é™…åº”ç”¨ä¼šæ›´å¤æ‚ï¼‰
    recommendations = {
        "ç”µå­äº§å“": ["MacBook Pro", "AirPods Pro", "iPad Air"],
        "å›¾ä¹¦": ["æ·±åº¦å­¦ä¹ ", "ç®—æ³•å¯¼è®º", "è®¾è®¡æ¨¡å¼"],
        "è¿åŠ¨": ["ç½‘çƒæ‹", "å¥èº«æ‰‹ç¯", "ç‘œä¼½å«"]
    }

    result = "ğŸ¯ ä¸ºæ‚¨æ¨èï¼š\n\n"
    for category in categories:
        if category in recommendations:
            result += f"ã€{category}ã€‘\n"
            for item in recommendations[category][:2]:  # æ¯ä¸ªç±»åˆ«æ¨è2ä¸ª
                result += f"  â€¢ {item}\n"
            result += "\n"

    return result

# ==================== åˆ›å»º Agent ====================

recommendation_agent = create_agent(
    model="gpt-4o",
    tools=[
        get_user_profile,
        get_user_preferences,
        get_browsing_history,
        get_purchase_history,
        record_product_view,
        update_user_preferences,
        get_personalized_recommendations
    ],
    store=store,
    context_schema=Context,
    system_prompt="""ä½ æ˜¯ä¸ªæ€§åŒ–æ¨èåŠ©æ‰‹ã€‚

èŒè´£ï¼š
1. äº†è§£ç”¨æˆ·çš„åå¥½å’Œå†å²è¡Œä¸º
2. è®°å½•ç”¨æˆ·çš„æµè§ˆè¡Œä¸º
3. åŸºäºç”¨æˆ·æ•°æ®ç”Ÿæˆä¸ªæ€§åŒ–æ¨è
4. å¸®åŠ©ç”¨æˆ·æ›´æ–°åå¥½è®¾ç½®

å·¥ä½œæµç¨‹ï¼š
- æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œä½¿ç”¨ç›¸åº”çš„æŸ¥è¯¢å·¥å…·
- ç”¨æˆ·æµè§ˆå•†å“æ—¶ï¼Œè®°å½•åˆ°å†å²ä¸­
- ç”Ÿæˆæ¨èæ—¶ï¼Œç»¼åˆè€ƒè™‘åå¥½å’Œå†å²
- å§‹ç»ˆä¿æŒå‹å¥½å’Œæœ‰å¸®åŠ©"""
)

# ==================== æµ‹è¯•åœºæ™¯ ====================

def simulate_user_interaction(user_id: str, query: str):
    """æ¨¡æ‹Ÿç”¨æˆ·äº¤äº’"""
    print(f"\n{'='*60}")
    print(f"ç”¨æˆ·: {query}")
    print('='*60)

    result = recommendation_agent.invoke(
        {"messages": [{"role": "user", "content": query}]},
        {"context": {"user_id": user_id, "session_id": "session_001"}}
    )

    answer = result["messages"][-1].content
    print(f"\nğŸ¤– åŠ©æ‰‹:\n{answer}\n")
    return answer

# ==================== æ‰§è¡Œæµ‹è¯• ====================

if __name__ == "__main__":
    user_id = "user_001"

    # åœºæ™¯ 1ï¼šæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
    simulate_user_interaction(
        user_id,
        "æˆ‘çš„ä¸ªäººä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Ÿ"
    )

    # åœºæ™¯ 2ï¼šæŸ¥çœ‹åå¥½å’Œå†å²
    simulate_user_interaction(
        user_id,
        "æˆ‘ä¹‹å‰æµè§ˆè¿‡å“ªäº›å•†å“ï¼Ÿæˆ‘çš„åå¥½æ˜¯ä»€ä¹ˆï¼Ÿ"
    )

    # åœºæ™¯ 3ï¼šè®°å½•æ–°çš„æµè§ˆ
    simulate_user_interaction(
        user_id,
        "æˆ‘æ­£åœ¨æŸ¥çœ‹ MacBook Proï¼ˆç”µå­äº§å“ç±»åˆ«ï¼‰ï¼Œå¸®æˆ‘è®°å½•ä¸€ä¸‹"
    )

    # åœºæ™¯ 4ï¼šè·å–ä¸ªæ€§åŒ–æ¨è
    simulate_user_interaction(
        user_id,
        "æ ¹æ®æˆ‘çš„åå¥½å’Œå†å²ï¼Œç»™æˆ‘ä¸€äº›æ¨èå§"
    )

    # åœºæ™¯ 5ï¼šæ›´æ–°åå¥½
    simulate_user_interaction(
        user_id,
        "æˆ‘æƒ³æŠŠåå¥½ç±»åˆ«æ”¹æˆï¼šç”µå­äº§å“ã€å¥åº·ã€æ—…æ¸¸"
    )

    # åœºæ™¯ 6ï¼šå†æ¬¡è·å–æ¨èï¼ˆåŸºäºæ–°åå¥½ï¼‰
    simulate_user_interaction(
        user_id,
        "ç°åœ¨ç»™æˆ‘æ¨èä¸€äº›å•†å“"
    )

    print("\n" + "="*60)
    print("ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿæµ‹è¯•å®Œæˆï¼")
    print("="*60)</code></pre>
                    </div>
                </section>

                <!-- å¸¸è§é—®é¢˜ -->
                <section class="content-section">
                    <h2 class="section-title">â“ å¸¸è§é—®é¢˜</h2>

                    <h3 class="subsection-subtitle">Q1: é•¿æœŸè®°å¿†å’ŒçŸ­æœŸè®°å¿†å¯ä»¥åŒæ—¶ä½¿ç”¨å—ï¼Ÿ</h3>
                    <p>
                        <strong>å¯ä»¥ï¼Œè€Œä¸”æ¨èè¿™æ ·åšã€‚</strong> Checkpointer ç®¡ç†å¯¹è¯å†å²ï¼ˆçŸ­æœŸï¼‰ï¼Œ
                        Store ç®¡ç†ç”¨æˆ·æ•°æ®å’Œåå¥½ï¼ˆé•¿æœŸï¼‰ã€‚ä¸¤è€…äº’è¡¥ï¼Œå…±åŒå®ç°å®Œæ•´çš„è®°å¿†ç³»ç»Ÿã€‚
                    </p>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python"># åŒæ—¶ä½¿ç”¨ Checkpointer å’Œ Store
from langgraph.checkpoint.memory import InMemorySaver
from langgraph.store.memory import InMemoryStore

agent = create_agent(
    model="gpt-4o",
    tools=[...],
    checkpointer=InMemorySaver(),  # çŸ­æœŸè®°å¿†
    store=InMemoryStore(),         # é•¿æœŸè®°å¿†
    context_schema=Context
)</code></pre>
                    </div>

                    <h3 class="subsection-subtitle">Q2: å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Storeï¼Ÿ</h3>
                    <p>
                        ä½¿ç”¨æ•°æ®åº“æ”¯æŒçš„ Store å®ç°ï¼Œå¦‚ PostgresStoreï¼ˆéœ€è¦é¢å¤–å®‰è£…åŒ…ï¼‰ï¼š
                    </p>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Bash</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-bash"># å®‰è£… PostgreSQL Storeï¼ˆç¤ºä¾‹ï¼Œå®é™…åŒ…åå¯èƒ½ä¸åŒï¼‰
pip install langgraph-store-postgres</code></pre>
                    </div>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python"># ä½¿ç”¨ PostgreSQL Store
from langgraph.store.postgres import PostgresStore

DB_URI = "postgresql://user:pass@localhost:5432/langchain"

with PostgresStore.from_conn_string(DB_URI) as store:
    store.setup()  # åˆ›å»ºè¡¨ç»“æ„

    agent = create_agent(
        model="gpt-4o",
        tools=[...],
        store=store
    )</code></pre>
                    </div>

                    <h3 class="subsection-subtitle">Q3: Store ä¸­çš„æ•°æ®ä»€ä¹ˆæ—¶å€™ä¼šè¿‡æœŸï¼Ÿ</h3>
                    <p>
                        Store é»˜è®¤<strong>ä¸ä¼šè‡ªåŠ¨åˆ é™¤æ•°æ®</strong>ã€‚ä½ éœ€è¦å®ç°è‡ªå·±çš„è¿‡æœŸç­–ç•¥ï¼š
                    </p>
                    <ul>
                        <li>åœ¨å†™å…¥æ—¶æ·»åŠ  <code>expires_at</code> å…ƒæ•°æ®</li>
                        <li>å®šæœŸè¿è¡Œæ¸…ç†ä»»åŠ¡åˆ é™¤è¿‡æœŸæ•°æ®</li>
                        <li>åŸºäºä¸šåŠ¡é€»è¾‘æ‰‹åŠ¨åˆ é™¤ä¸å†éœ€è¦çš„æ•°æ®</li>
                    </ul>

                    <h3 class="subsection-subtitle">Q4: å¦‚ä½•å®ç°è·¨ç”¨æˆ·çš„çŸ¥è¯†å…±äº«ï¼Ÿ</h3>
                    <p>
                        ä½¿ç”¨å…±äº«çš„ Namespace å­˜å‚¨å…¬å…±çŸ¥è¯†ï¼š
                    </p>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python"># ä¸ªäººçŸ¥è¯†
store.put(("users", "user_123", "notes"), "note_001", {...})

# å›¢é˜Ÿå…±äº«çŸ¥è¯†
store.put(("teams", "team_A", "knowledge"), "doc_001", {...})

# å…¨å±€çŸ¥è¯†åº“
store.put(("global", "faq"), "how_to_reset_password", {...})</code></pre>
                    </div>

                    <h3 class="subsection-subtitle">Q5: Store æ”¯æŒäº‹åŠ¡å—ï¼Ÿ</h3>
                    <p>
                        InMemoryStore ä¸æ”¯æŒäº‹åŠ¡ã€‚ç”Ÿäº§çº§ Storeï¼ˆå¦‚ PostgresStoreï¼‰
                        å¯èƒ½æ”¯æŒäº‹åŠ¡ï¼Œå…·ä½“å–å†³äºå®ç°ã€‚å¦‚æœéœ€è¦åŸå­æ“ä½œï¼Œ
                        è€ƒè™‘åœ¨åº”ç”¨å±‚å®ç°è¡¥å¿é€»è¾‘æˆ–ä½¿ç”¨æ”¯æŒäº‹åŠ¡çš„æ•°æ®åº“ã€‚
                    </p>
                </section>

                <!-- æœ€ä½³å®è·µ -->
                <section class="content-section">
                    <h2 class="section-title">âœ¨ æœ€ä½³å®è·µ</h2>

                    <h3 class="subsection-title">1. é€‰æ‹©åˆé€‚çš„å­˜å‚¨æ–¹æ¡ˆ</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ç¯å¢ƒ</th>
                                <th>æ¨è Store</th>
                                <th>ç†ç”±</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>æœ¬åœ°å¼€å‘</td>
                                <td>InMemoryStore</td>
                                <td>å¿«é€Ÿè¿­ä»£ï¼Œæ— éœ€é…ç½®</td>
                            </tr>
                            <tr>
                                <td>æµ‹è¯•ç¯å¢ƒ</td>
                                <td>InMemoryStore æˆ– SQLite</td>
                                <td>è½»é‡çº§ï¼Œæ˜“äºé‡ç½®</td>
                            </tr>
                            <tr>
                                <td>ç”Ÿäº§ç¯å¢ƒ</td>
                                <td>PostgresStore</td>
                                <td>å¯é ã€å¯æ‰©å±•ã€æ”¯æŒå¤‡ä»½</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 class="subsection-title">2. Namespace å‘½åè§„èŒƒ</h3>
                    <ul>
                        <li><strong>ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°</strong>ï¼š<code>("users", "preferences")</code> è€Œé <code>("u", "p")</code></li>
                        <li><strong>ä¿æŒä¸€è‡´æ€§</strong>ï¼šç›¸åŒç±»å‹æ•°æ®ä½¿ç”¨ç›¸åŒç»“æ„</li>
                        <li><strong>é¿å…è¿‡æ·±å±‚çº§</strong>ï¼šé€šå¸¸ 2-4 å±‚è¶³å¤Ÿ</li>
                        <li><strong>è€ƒè™‘æŸ¥è¯¢éœ€æ±‚</strong>ï¼šè®¾è®¡æ—¶è€ƒè™‘å¦‚ä½•æ£€ç´¢æ•°æ®</li>
                    </ul>

                    <h3 class="subsection-title">3. æ•°æ®è®¾è®¡åŸåˆ™</h3>
                    <ul>
                        <li><strong>æœ€å°åŒ–</strong>ï¼šåªå­˜å‚¨å¿…è¦çš„ä¿¡æ¯</li>
                        <li><strong>ç»“æ„åŒ–</strong>ï¼šä½¿ç”¨æ¸…æ™°çš„ JSON ç»“æ„</li>
                        <li><strong>å¯æ‰©å±•</strong>ï¼šé¢„ç•™æ‰©å±•å­—æ®µ</li>
                        <li><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼šè€ƒè™‘æ•°æ® Schema æ¼”è¿›</li>
                        <li><strong>éšç§ä¿æŠ¤</strong>ï¼šä¸å­˜å‚¨æ•æ„Ÿä¿¡æ¯çš„æ˜æ–‡</li>
                    </ul>

                    <h3 class="subsection-title">4. æ€§èƒ½ä¼˜åŒ–</h3>
                    <ul>
                        <li><strong>æ‰¹é‡æ“ä½œ</strong>ï¼šå°½å¯èƒ½æ‰¹é‡è¯»å†™ï¼Œå‡å°‘ I/O</li>
                        <li><strong>ç¼“å­˜ç­–ç•¥</strong>ï¼šå¯¹çƒ­æ•°æ®ä½¿ç”¨åº”ç”¨å±‚ç¼“å­˜</li>
                        <li><strong>ç´¢å¼•ä¼˜åŒ–</strong>ï¼šä¸ºå¸¸ç”¨æŸ¥è¯¢åˆ›å»ºç´¢å¼•</li>
                        <li><strong>æ•°æ®æ¸…ç†</strong>ï¼šå®šæœŸæ¸…ç†è¿‡æœŸæˆ–æ— ç”¨æ•°æ®</li>
                    </ul>

                    <h3 class="subsection-title">5. é”™è¯¯å¤„ç†</h3>
                    <div class="code-block-wrapper">
                        <div class="code-block-header">
                            <span class="code-language">Python</span>
                            <button class="copy-button">å¤åˆ¶ä»£ç </button>
                        </div>
                        <pre><code class="language-python"># å¥å£®çš„æ•°æ®è¯»å–
@tool
def get_user_setting(runtime: ToolRuntime[Context]) -> str:
    """è·å–ç”¨æˆ·è®¾ç½®ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰"""
    try:
        store = runtime.store
        user_id = runtime.context["user_id"]

        settings = store.get(("users", user_id, "settings"), "config")

        if settings:
            return f"è®¾ç½®ï¼š{settings.value}"
        else:
            # è¿”å›é»˜è®¤å€¼
            return "ä½¿ç”¨é»˜è®¤è®¾ç½®"
    except Exception as e:
        # è®°å½•é”™è¯¯å¹¶è¿”å›å‹å¥½æ¶ˆæ¯
        print(f"Error reading settings: {e}")
        return "æ— æ³•è¯»å–è®¾ç½®ï¼Œè¯·ç¨åé‡è¯•"</code></pre>
                    </div>
                </section>

                <!-- å‚è€ƒèµ„æº -->
                <section class="content-section">
                    <h2 class="section-title">ğŸ“– å‚è€ƒèµ„æº</h2>
                    <ul>
                        <li>
                            <a href="https://docs.langchain.com/oss/python/langchain/long-term-memory" target="_blank">
                                LangChain å®˜æ–¹ Long-term Memory æ–‡æ¡£
                            </a>
                        </li>
                        <li>
                            <a href="https://langchain-ai.github.io/langgraph/concepts/persistence/" target="_blank">
                                LangGraph Persistence æ¦‚å¿µ
                            </a>
                        </li>
                        <li>
                            <a href="https://docs.langchain.com/oss/python/langchain/runtime" target="_blank">
                                Runtime å’Œ Context æ–‡æ¡£
                            </a>
                        </li>
                        <li>
                            <a href="https://docs.langchain.com/oss/python/langchain/short-term-memory" target="_blank">
                                Short-term Memoryï¼ˆCheckpointerï¼‰å¯¹æ¯”
                            </a>
                        </li>
                    </ul>
                </section>

                <!-- é¡µé¢å¯¼èˆª -->
                                <nav class="page-navigation">
                    <a href="13-human-in-loop.html" class="nav-button prev">
                        â† ä¸Šä¸€é¡µ:äººå·¥ä»‹å…¥
                    </a>
                    <a href="15-langgraph.html" class="nav-button next">
                        ä¸‹ä¸€é¡µ:LangGraph â†’
                    </a>
                </nav>
            </div>
        </main>
    </div>

    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button class="back-to-top" aria-label="è¿”å›é¡¶éƒ¨">â†‘</button>

    <!-- JavaScript -->
    <script src="assets/js/mermaid-init.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</body>
</html>
